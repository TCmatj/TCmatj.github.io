<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-cn" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Redis入门与原理 &middot; TCmatj的个人博客</title>
  <meta name="title" content="Redis入门与原理 &middot; TCmatj的个人博客" />
  
  <meta name="description" content="浙江理工大学" />
  
  
  
  <link rel="canonical" href="https://TCmatj.github.io/docs/redis/redis/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.85f006de1806b55b2d082d1122deedd8cec6fdc1f7c8a51be975a4496165d6c798f4a3de52545a6a87cc4bc09fc2d6f5201d44ea57acc1ac2b1c42a688c62bee.css"
    integrity="sha512-hfAG3hgGtVstCC0RIt7t2M7G/cH3yKUb6XWkSWFl1seY9KPeUlRaaofMS8Cfwtb1IB1E6leswawrHEKmiMYr7g==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.f5c7687e2a3365a5a366307858918deafa574ab869c626f69dcdd5363e26a725991d0efa1aaaff7ba4b7e2472876189d153d2f9b46a39206caf364407e2aaa77.js"
    integrity="sha512-9cdofiozZaWjZjB4WJGN6vpXSrhpxib2nc3VNj4mpyWZHQ76Gqr/e6S34kcodhidFT0vm0ajkgbK82RAfiqqdw==" data-copy="" data-copied=""></script>
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:url" content="https://TCmatj.github.io/docs/redis/redis/">
  <meta property="og:site_name" content="TCmatj的个人博客">
  <meta property="og:title" content="Redis入门与原理">
  <meta property="og:description" content="Redis入门 # SQL与NoSQL区别 SQL NoSQL 数据结构 结构化 非结">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="og:image" content="https://TCmatj.github.io/docs/redis/redis/featured.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://TCmatj.github.io/docs/redis/redis/featured.png">
  <meta name="twitter:title" content="Redis入门与原理">
  <meta name="twitter:description" content="Redis入门 # SQL与NoSQL区别 SQL NoSQL 数据结构 结构化 非结">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Docs",
    "name": "Redis入门与原理",
    "headline": "Redis入门与原理",
    
    "abstract": "Redis入门 # SQL与NoSQL区别 SQL NoSQL 数据结构 结构化 非结",
    "inLanguage": "zh-cn",
    "url" : "https:\/\/TCmatj.github.io\/docs\/redis\/redis\/",
    "author" : {
      "@type": "Person",
      "name": "TCmatj"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "17459"
  }]
  </script>


  
  
  <meta name="author" content="TCmatj" />
  
  
  
  <link href="https://github.com/TCmatj" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>





















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-PEDMYR1V0K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PEDMYR1V0K');
</script>


  
  
  <meta name="theme-color"/>
  
  
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script>

    const firebaseConfig = {
      apiKey: "AIzaSyDe2xnkus6Wsn0D2GU6RKbkRX9exAYhwio",
      authDomain: "AIzaSyDe2xnkus6Wsn0D2GU6RKbkRX9exAYhwio",
      projectId: "blog-53c93",
      storageBucket: "blog-53c93.appspot.com",
      messagingSenderId: "688956731234",
      appId: "1:688956731234:web:3eae3e633a453e1b17063b",
      measurementId: "G-ZXHSY9W6LL"
    };

    var app = firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
    var auth = firebase.auth();

  </script>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">TCmatj的个人博客</span>

            <img src="/img/blowfish_logo_transparent.png" width="1000" height="1000"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="TCmatj的个人博客" />

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">TCmatj的个人博客</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      Java
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/java/java%E5%9F%BA%E7%A1%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Java基础
          </p>
        </a>
        
        <a href="/docs/java/jvm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            JVM
          </p>
        </a>
        
        <a href="/docs/java/juc/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            JUC
          </p>
        </a>
        
        <a href="/docs/java/stream%E6%B5%81%E4%B8%8Eio%E6%B5%81/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Stream流与IO流
          </p>
        </a>
        
        <a href="/docs/java/springboot/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            SpringBoot
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      Python
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/python/python/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Python入门
          </p>
        </a>
        
        <a href="/docs/python/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            机器学习
          </p>
        </a>
        
        <a href="/docs/python/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            深度学习
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      MySQL
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/mysql/mysql%E8%AF%AD%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            MySQL语法
          </p>
        </a>
        
        <a href="/docs/mysql/mysql%E5%8E%9F%E7%90%86/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            MySQL原理
          </p>
        </a>
        
        <a href="/docs/mysql/mybatis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            MyBatis
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      Redis
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/redis/redis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Redis入门与原理
          </p>
        </a>
        
        <a href="/docs/redis/lua/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Lua脚本
          </p>
        </a>
        
        <a href="/docs/redis/redis%E4%BD%BF%E7%94%A8/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Redis使用
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      工具
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/linux/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Linux
          </p>
        </a>
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/docker/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Docker
          </p>
        </a>
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/maven/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Maven
          </p>
        </a>
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/git/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Git
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      其他
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E7%8A%B6%E6%80%81%E6%9C%BA/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            状态机
          </p>
        </a>
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E7%AE%97%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            算法
          </p>
        </a>
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            网络
          </p>
        </a>
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            设计模式
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
            
  <a href="https://github.com/TCmatj"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <span >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


    </span>
    
    <p class="text-base font-medium" title="">
        
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li>
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Java
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/java%E5%9F%BA%E7%A1%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Java基础
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/jvm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            JVM
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/juc/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            JUC
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/stream%E6%B5%81%E4%B8%8Eio%E6%B5%81/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Stream流与IO流
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/springboot/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            SpringBoot
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Python
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/python/python/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Python入门
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/python/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            机器学习
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/python/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            深度学习
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            MySQL
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/mysql/mysql%E8%AF%AD%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            MySQL语法
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/mysql/mysql%E5%8E%9F%E7%90%86/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            MySQL原理
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/mysql/mybatis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            MyBatis
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Redis
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/redis/redis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Redis入门与原理
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/redis/lua/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Lua脚本
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/redis/redis%E4%BD%BF%E7%94%A8/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Redis使用
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            工具
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/linux/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Linux
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/docker/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Docker
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/maven/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Maven
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/git/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Git
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            其他
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E7%8A%B6%E6%80%81%E6%9C%BA/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            状态机
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E7%AE%97%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            算法
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            网络
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            设计模式
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                    
  <li class="mt-1">
    <a href="https://github.com/TCmatj"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <div >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


        </div>
        
        <p class="text-bg font-bg" title="">
            
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/docs/redis/redis/featured_hu9585e21d0f1da07396cf223dc9cd5462_383852_1200x0_resize_box_3.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >欢迎来到 Blowfish! :tada:</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/docs/"
      >Docs</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/docs/redis/redis/"
      >Redis入门与原理</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      Redis入门与原理
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  



  



  



  





  



<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time><span class="px-2 text-primary-500">&middot;</span><span>17459 字</span><span class="px-2 text-primary-500">&middot;</span><span title="预计阅读">35 分钟</span><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span id="views_docs/Redis/Redis/index.md" class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400" title="views">loading</span>
  <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
<path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg>
  </span>

</span>
</span><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span id="likes_docs/Redis/Redis/index.md"
    class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400"
    title="likes">loading</span>
  <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
  </span>

</span>
</span><span class="px-2 text-primary-500">&middot;</span><span>
    <button id="button_likes"
        class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
        onclick="process_article()">
        <span id="button_likes_heart" style="display:none" class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
  </span>

 </span>
        <span id="button_likes_emtpty_heart" class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M244 84L255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84C243.1 84 244 84.01 244 84L244 84zM255.1 163.9L210.1 117.1C188.4 96.28 157.6 86.4 127.3 91.44C81.55 99.07 48 138.7 48 185.1V190.9C48 219.1 59.71 246.1 80.34 265.3L256 429.3L431.7 265.3C452.3 246.1 464 219.1 464 190.9V185.1C464 138.7 430.4 99.07 384.7 91.44C354.4 86.4 323.6 96.28 301.9 117.1L255.1 163.9z"/></svg>
  </span>

</span>
        <span id="button_likes_text">&nbsp;Like</span>
    </button>
</span><span class="px-2 text-primary-500">&middot;</span>


<script type="text/javascript" src="/js/zen-mode.min.63c8a202661f4a2063fdc2706685d668e8ea3da613da2224e9da527e5876e4f53dcac39ab60732626fb4151feae5d430d0cf44731e5d3c726522fcc1519c1547.js" integrity="sha512-Y8iiAmYfSiBj/cJwZoXWaOjqPaYT2iIk6dpSflh25PU9ysOatgcyYm&#43;0FR/q5dQw0M9Ecx5dPHJlIvzBUZwVRw=="></script>

<span class="mb-[2px]">
    <span id="zen-mode-button"
          class="text-lg hover:text-primary-500"
          title=""
          data-title-i18n-disable=""
          data-title-i18n-enable="">
        <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50px" height="50px">
    <path fill="currentColor" d="M 12.980469 4 C 9.1204688 4 5.9804688 7.14 5.9804688 11 L 6 26 L 9.9804688 26 L 9.9804688 11 C 9.9804688 9.35 11.320469 8 12.980469 8 L 40.019531 8 C 41.679531 8 43.019531 9.35 43.019531 11 L 43.019531 39 C 43.019531 40.65 41.679531 42 40.019531 42 L 29 42 C 29 43.54 28.420938 44.94 27.460938 46 L 40.019531 46 C 43.879531 46 47.019531 42.86 47.019531 39 L 47.019531 11 C 47.019531 7.14 43.879531 4 40.019531 4 L 12.980469 4 z M 7 28 C 4.794 28 3 29.794 3 32 L 3 42 C 3 44.206 4.794 46 7 46 L 23 46 C 25.206 46 27 44.206 27 42 L 27 32 C 27 29.794 25.206 28 23 28 L 7 28 z M 7 32 L 23 32 L 23.001953 42 L 7 42 L 7 32 z"/>
</svg>
  </span>

</span>
    </span>
</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
    
    
      
    
    
      
        
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="TCmatj" src="/img/blowfish_logo_hu184ea2fa12490a2458ca388a16ab730e_227816_192x192_fill_box_center_3.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      作者
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      TCmatj
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">浙江理工大学</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/TCmatj"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一认识redis">一、认识Redis</a>
      <ul>
        <li><a href="#0docker-部署">0.docker 部署</a></li>
        <li><a href="#1数据结构介绍">1.数据结构介绍</a>
          <ul>
            <li><a href="#11-string">1.1 String</a></li>
            <li><a href="#12-链表">1.2 链表</a></li>
            <li><a href="#13-字典">1.3 字典</a></li>
            <li><a href="#14-跳跃表">1.4 跳跃表</a></li>
            <li><a href="#15-整数集合">1.5 整数集合</a></li>
            <li><a href="#16-压缩列表">1.6 压缩列表</a></li>
            <li><a href="#17-对象系统">1.7 对象系统</a></li>
          </ul>
        </li>
        <li><a href="#18-类型检查与命令多态">1.8 类型检查与命令多态</a></li>
        <li><a href="#19-内存回收对象共享对象的空转时长">1.9 内存回收、对象共享、对象的空转时长</a></li>
        <li><a href="#2指令">2.指令</a>
          <ul>
            <li><a href="#1通用命令">1）通用命令</a></li>
            <li><a href="#2string命令">2）String命令</a></li>
            <li><a href="#3key的层级格式">3）Key的层级格式</a></li>
            <li><a href="#4hash类型">4）Hash类型</a></li>
            <li><a href="#5list-类型">5）List 类型</a></li>
            <li><a href="#6set-类型">6）Set 类型</a></li>
            <li><a href="#7sortedset类型">7）SortedSet类型</a></li>
          </ul>
        </li>
        <li><a href="#3-数据库">3. 数据库</a>
          <ul>
            <li><a href="#31--数据结构">3.1  数据结构</a></li>
            <li><a href="#32-过期键的删除">3.2 过期键的删除</a></li>
            <li><a href="#33-持久化和复制功能对过期键的处理">3.3 持久化和复制功能对过期键的处理</a></li>
            <li><a href="#34-数据库通知的实现">3.4 数据库通知的实现</a></li>
          </ul>
        </li>
        <li><a href="#4-rdb持久化">4. RDB持久化</a>
          <ul>
            <li><a href="#41redis内部的rdb机制redisconf">4.1Redis内部的RDB机制（redis.conf）：</a></li>
            <li><a href="#42-rdb文件结构">4.2 RDB文件结构</a></li>
          </ul>
        </li>
        <li><a href="#5-aof持久化">5. AOF持久化</a>
          <ul>
            <li><a href="#51-实现">5.1 实现</a></li>
            <li><a href="#52-载入与还原">5.2 载入与还原</a></li>
            <li><a href="#53-aof重写">5.3 AOF重写</a></li>
          </ul>
        </li>
        <li><a href="#6-事件">6. 事件</a>
          <ul>
            <li><a href="#61-文件事件处理器">6.1 文件事件处理器</a></li>
            <li><a href="#62-时间事件">6.2 时间事件</a></li>
            <li><a href="#63-服务器事件调度">6.3 服务器事件调度</a></li>
          </ul>
        </li>
        <li><a href="#7-复制模式">7. 复制模式</a>
          <ul>
            <li><a href="#71-复制偏移量服务器运行id">7.1 复制偏移量、服务器运行ID</a></li>
            <li><a href="#72-复制积压缓冲区">7.2 复制积压缓冲区</a></li>
            <li><a href="#73-复制的步骤">7.3 复制的步骤</a></li>
          </ul>
        </li>
        <li><a href="#8-sentinel">8. Sentinel</a>
          <ul>
            <li><a href="#81-启动sentinel">8.1 启动Sentinel</a></li>
            <li><a href="#82-获取主服务器信息">8.2 获取主服务器信息</a></li>
            <li><a href="#83-获取从服务器信息">8.3 获取从服务器信息</a></li>
            <li><a href="#84-向主服务器和从服务器发送信息">8.4 向主服务器和从服务器发送信息</a></li>
            <li><a href="#85-接收服务器的频道信息">8.5 接收服务器的频道信息</a></li>
            <li><a href="#86-主观下线">8.6 主观下线</a></li>
            <li><a href="#87-客观下线">8.7 客观下线</a></li>
            <li><a href="#88-选举领头sentinel">8.8 选举领头Sentinel</a></li>
          </ul>
        </li>
        <li><a href="#9-集群">9. 集群</a></li>
      </ul>
    </li>
    <li><a href="#10-发布与订阅">10. 发布与订阅</a>
      <ul>
        <li><a href="#101-订阅">10.1 订阅</a></li>
        <li><a href="#102-发送消息">10.2 发送消息</a></li>
        <li><a href="#103-查看订阅消息">10.3 查看订阅消息</a></li>
      </ul>
    </li>
    <li><a href="#11-慢查询日志监视器">11. 慢查询日志、监视器</a>
      <ul>
        <li>
          <ul>
            <li><a href="#111-慢查询日志">11.1 慢查询日志</a></li>
            <li><a href="#112-监视器">11.2 监视器</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#12-事务">12. 事务</a>
      <ul>
        <li><a href="#121-事务的实现">12.1 事务的实现</a></li>
        <li><a href="#122-事务的acid性质">12.2 事务的ACID性质</a></li>
      </ul>
    </li>
    <li><a href="#13-常见问题">13. 常见问题</a>
      <ul>
        <li><a href="#131-大key">13.1 大Key</a></li>
        <li><a href="#132-缓存三兄弟">13.2 缓存三兄弟</a></li>
        <li><a href="#14-分布式锁">14. 分布式锁</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一认识redis">一、认识Redis</a>
      <ul>
        <li><a href="#0docker-部署">0.docker 部署</a></li>
        <li><a href="#1数据结构介绍">1.数据结构介绍</a>
          <ul>
            <li><a href="#11-string">1.1 String</a></li>
            <li><a href="#12-链表">1.2 链表</a></li>
            <li><a href="#13-字典">1.3 字典</a></li>
            <li><a href="#14-跳跃表">1.4 跳跃表</a></li>
            <li><a href="#15-整数集合">1.5 整数集合</a></li>
            <li><a href="#16-压缩列表">1.6 压缩列表</a></li>
            <li><a href="#17-对象系统">1.7 对象系统</a></li>
          </ul>
        </li>
        <li><a href="#18-类型检查与命令多态">1.8 类型检查与命令多态</a></li>
        <li><a href="#19-内存回收对象共享对象的空转时长">1.9 内存回收、对象共享、对象的空转时长</a></li>
        <li><a href="#2指令">2.指令</a>
          <ul>
            <li><a href="#1通用命令">1）通用命令</a></li>
            <li><a href="#2string命令">2）String命令</a></li>
            <li><a href="#3key的层级格式">3）Key的层级格式</a></li>
            <li><a href="#4hash类型">4）Hash类型</a></li>
            <li><a href="#5list-类型">5）List 类型</a></li>
            <li><a href="#6set-类型">6）Set 类型</a></li>
            <li><a href="#7sortedset类型">7）SortedSet类型</a></li>
          </ul>
        </li>
        <li><a href="#3-数据库">3. 数据库</a>
          <ul>
            <li><a href="#31--数据结构">3.1  数据结构</a></li>
            <li><a href="#32-过期键的删除">3.2 过期键的删除</a></li>
            <li><a href="#33-持久化和复制功能对过期键的处理">3.3 持久化和复制功能对过期键的处理</a></li>
            <li><a href="#34-数据库通知的实现">3.4 数据库通知的实现</a></li>
          </ul>
        </li>
        <li><a href="#4-rdb持久化">4. RDB持久化</a>
          <ul>
            <li><a href="#41redis内部的rdb机制redisconf">4.1Redis内部的RDB机制（redis.conf）：</a></li>
            <li><a href="#42-rdb文件结构">4.2 RDB文件结构</a></li>
          </ul>
        </li>
        <li><a href="#5-aof持久化">5. AOF持久化</a>
          <ul>
            <li><a href="#51-实现">5.1 实现</a></li>
            <li><a href="#52-载入与还原">5.2 载入与还原</a></li>
            <li><a href="#53-aof重写">5.3 AOF重写</a></li>
          </ul>
        </li>
        <li><a href="#6-事件">6. 事件</a>
          <ul>
            <li><a href="#61-文件事件处理器">6.1 文件事件处理器</a></li>
            <li><a href="#62-时间事件">6.2 时间事件</a></li>
            <li><a href="#63-服务器事件调度">6.3 服务器事件调度</a></li>
          </ul>
        </li>
        <li><a href="#7-复制模式">7. 复制模式</a>
          <ul>
            <li><a href="#71-复制偏移量服务器运行id">7.1 复制偏移量、服务器运行ID</a></li>
            <li><a href="#72-复制积压缓冲区">7.2 复制积压缓冲区</a></li>
            <li><a href="#73-复制的步骤">7.3 复制的步骤</a></li>
          </ul>
        </li>
        <li><a href="#8-sentinel">8. Sentinel</a>
          <ul>
            <li><a href="#81-启动sentinel">8.1 启动Sentinel</a></li>
            <li><a href="#82-获取主服务器信息">8.2 获取主服务器信息</a></li>
            <li><a href="#83-获取从服务器信息">8.3 获取从服务器信息</a></li>
            <li><a href="#84-向主服务器和从服务器发送信息">8.4 向主服务器和从服务器发送信息</a></li>
            <li><a href="#85-接收服务器的频道信息">8.5 接收服务器的频道信息</a></li>
            <li><a href="#86-主观下线">8.6 主观下线</a></li>
            <li><a href="#87-客观下线">8.7 客观下线</a></li>
            <li><a href="#88-选举领头sentinel">8.8 选举领头Sentinel</a></li>
          </ul>
        </li>
        <li><a href="#9-集群">9. 集群</a></li>
      </ul>
    </li>
    <li><a href="#10-发布与订阅">10. 发布与订阅</a>
      <ul>
        <li><a href="#101-订阅">10.1 订阅</a></li>
        <li><a href="#102-发送消息">10.2 发送消息</a></li>
        <li><a href="#103-查看订阅消息">10.3 查看订阅消息</a></li>
      </ul>
    </li>
    <li><a href="#11-慢查询日志监视器">11. 慢查询日志、监视器</a>
      <ul>
        <li>
          <ul>
            <li><a href="#111-慢查询日志">11.1 慢查询日志</a></li>
            <li><a href="#112-监视器">11.2 监视器</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#12-事务">12. 事务</a>
      <ul>
        <li><a href="#121-事务的实现">12.1 事务的实现</a></li>
        <li><a href="#122-事务的acid性质">12.2 事务的ACID性质</a></li>
      </ul>
    </li>
    <li><a href="#13-常见问题">13. 常见问题</a>
      <ul>
        <li><a href="#131-大key">13.1 大Key</a></li>
        <li><a href="#132-缓存三兄弟">13.2 缓存三兄弟</a></li>
        <li><a href="#14-分布式锁">14. 分布式锁</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h1 class="relative group">Redis入门 
    <div id="redis%E5%85%A5%E9%97%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#redis%E5%85%A5%E9%97%A8" aria-label="锚点">#</a>
    </span>        
    
</h1>
<table>
<thead>
<tr>
<th style="text-align:center">SQL与NoSQL区别</th>
<th style="text-align:center">SQL</th>
<th>NoSQL</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据结构</td>
<td style="text-align:center">结构化</td>
<td>非结构化</td>
</tr>
<tr>
<td style="text-align:center">数据关联</td>
<td style="text-align:center">关联的</td>
<td>无关联的</td>
</tr>
<tr>
<td style="text-align:center">查询方式</td>
<td style="text-align:center">SQL查询</td>
<td>非SQL</td>
</tr>
<tr>
<td style="text-align:center">事务特性</td>
<td style="text-align:center">ACID</td>
<td>BASE</td>
</tr>
<tr>
<td style="text-align:center">存储方式</td>
<td style="text-align:center">磁盘</td>
<td>内存</td>
</tr>
<tr>
<td style="text-align:center">扩展性</td>
<td style="text-align:center">垂直</td>
<td>水平</td>
</tr>
<tr>
<td style="text-align:center">使用场景</td>
<td style="text-align:center">结构固定、业务对数据安全性一致性要求较高</td>
<td>数据结构不固定、对一致性安全性要求不高、对性能要求</td>
</tr>
</tbody>
</table>


<h2 class="relative group">一、认识Redis 
    <div id="%E4%B8%80%E8%AE%A4%E8%AF%86redis" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E4%B8%80%E8%AE%A4%E8%AF%86redis" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>远程词典服务器，基于内存的键值型 NoSQL 数据库</p>
<p>特征：</p>
<ul>
<li>键值型，支持多种不同数据结构</li>
<li>单线程，每个命令具备原子性</li>
<li>低延迟，速度快（基于内存、IO多路复用、良好的编码[C语言/开源]）</li>
<li>支持数据持久化</li>
<li>支持主从集群、分片集群</li>
<li>支持多语言客户端</li>
</ul>


<h3 class="relative group">0.docker 部署 
    <div id="0docker-%E9%83%A8%E7%BD%B2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#0docker-%E9%83%A8%E7%BD%B2" aria-label="锚点">#</a>
    </span>        
    
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">docker run -p 6379:6379 --name redis -v D:/redis/redis.conf:/etc/redis/redis.conf -v D:/redis/data:/data -d redis redis-server /etc/redis/redis.conf --appendonly yes
</span></span><span class="line"><span class="cl">docker start 582e147				运行容器
</span></span><span class="line"><span class="cl">docker exec -it redis /bin/bash		进入运行的容器
</span></span><span class="line"><span class="cl">redis-cli 							进入Redis控制台
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">docker exec -it redis redis-cli		上面的结合体
</span></span><span class="line"><span class="cl"><span class="k">exit</span>								退出容器/Redis控制台
</span></span></code></pre></div><p><code>redis-cli [-hpa] [commond]</code></p>
<ul>
<li>-h 指定要连接的redis节点的IP地址，默认127.0.0.1</li>
<li>-p 指定节点端口，默认6379</li>
<li>-a 指定访问密码</li>
<li>commond 不指定commond时会进入交互控制台</li>
</ul>


<h3 class="relative group">1.数据结构介绍 
    <div id="1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#1%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>key一般是String类型，value类型：</p>
<ul>
<li>基本类型 String、Hash、List、Set、SortedSet</li>
<li>特殊类型 GEO、BitMap、HyperLog</li>
</ul>


<h4 class="relative group">1.1 String 
    <div id="11-string" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#11-string" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>key是一个简单动态字符串（SDS），value也是一个SDS</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">sds</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>	<span class="c1">// 记录已使用的字节数（不含末尾&#39;\0&#39;，可以保存空格&#39;\0&#39;——二进制安全）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">free</span><span class="p">;</span>	<span class="c1">// 记录未使用的字节数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[];</span>	<span class="c1">// 字节数组，存储字符串
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></div><p>SDS扩容机制（空间预分配）：</p>
<p>目标容量 &lt;1MB			多扩容一倍：len = 目标容量        free = 目标容量</p>
<p>​				&gt;1MB			多扩容 1MB：len = 目标容量       free = 1MB</p>
<p>惰性空间释放：只改变free 和 len，不实际释放空间</p>


<h4 class="relative group">1.2 链表 
    <div id="12-%E9%93%BE%E8%A1%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#12-%E9%93%BE%E8%A1%A8" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>列表键、发布与订阅、慢查询、监视器都使用到了链表</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">listNode</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">listNode</span> <span class="o">*</span><span class="n">prev</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">listNode</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="n">listNode</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">list</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">listNode</span> <span class="o">*</span><span class="n">head</span><span class="p">;</span>	<span class="c1">// 头节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">listNode</span> <span class="o">*</span><span class="n">tail</span><span class="p">;</span>	<span class="c1">// 尾节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">;</span>	<span class="c1">// 节点数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">dup</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span> 				<span class="c1">// 节点值复制函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">free</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">);</span>				<span class="c1">// 节点值释放函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">match</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">key</span><span class="p">)</span>	<span class="c1">// 节点值对比函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="n">list</span><span class="p">;</span>
</span></span></code></pre></div><p>特点：</p>
<p>双端、无环、带长度计数器、多态</p>


<h4 class="relative group">1.3 字典 
    <div id="13-%E5%AD%97%E5%85%B8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#13-%E5%AD%97%E5%85%B8" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>Redis数据库的原理，也是Hash键的底层实现</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">dictht</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">dictEntry</span> <span class="o">**</span><span class="n">table</span><span class="p">;</span>		<span class="c1">// 指向哈希表数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">;</span>		<span class="c1">// 哈希表大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sizemark</span><span class="p">;</span>	<span class="c1">// 哈希表大小掩码，用于计算索引值 = size - 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">used</span><span class="p">;</span>		<span class="c1">// 哈希表已有节点数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="n">dictht</span><span class="p">;</span>	<span class="c1">// 哈希表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">dictEntry</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="o">*</span><span class="n">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">union</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">void</span> <span class="o">*</span><span class="n">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">uint64_t</span> <span class="n">u64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kt">int64_t</span> <span class="n">s64</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="n">v</span><span class="p">;</span>	<span class="c1">// 值可以是一个指针、无符号64位整数或是64位整数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">struct</span> <span class="n">dictEntry</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>	<span class="c1">// 指向下一个哈希表节点，形成链表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="n">dictEntry</span><span class="p">;</span> <span class="c1">// 哈希表节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">dict</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">dictType</span> <span class="o">*</span><span class="n">type</span><span class="p">;</span>		<span class="c1">// 类型特定函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="n">privdata</span><span class="p">;</span>		<span class="c1">// 私有数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dictht</span> <span class="n">ht</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="c1">// 哈希表 一般只使用一个哈希表，只有在rehash时才使用h[1]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">rehashidx</span><span class="p">;</span>		<span class="c1">// rehash的进度，当rehash不在进行时 = -1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="n">dict</span><span class="p">;</span>	<span class="c1">// 字典
</span></span></span></code></pre></div><p>type指向dictType结构的指针，每个dictType结构保存了一簇用于操作特定类型键值对的函数</p>
<p>privdata保存需要传给哪些类型特定函数的可选参数</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-1_hu0506cee76a413ab0f6be2ef4b5cbbac9_89624_330x0_resize_q75_box.jpg 330w,
        /img/Redis-1_hu0506cee76a413ab0f6be2ef4b5cbbac9_89624_660x0_resize_q75_box.jpg 660w,
        /img/Redis-1_hu0506cee76a413ab0f6be2ef4b5cbbac9_89624_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-1_hu0506cee76a413ab0f6be2ef4b5cbbac9_89624_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-1_hu0506cee76a413ab0f6be2ef4b5cbbac9_89624_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p><strong>哈希算法</strong></p>
<p>使用字典设置的哈希函数，计算key的哈希值：hash = dict-&gt;type-&gt;hashFunction(key)</p>
<p>计算索引值：index = hash &amp; dict -&gt;ht[x].sizemask [hash 和哈希表大小掩码 的 与，根据情况 x 可以是 0 或 1]</p>
<p>用作数据库底层实现、哈希键底层实现时，使用MurmurHash算法</p>
<p><strong>解决冲突</strong>：链地址法。把新加入的节点放链表头</p>
<p><strong>rehash</strong></p>
<p>哈希表扩展：</p>
<p>当负载因子 &gt; 1 且不在执行BGSAVE和BGREWRITEAOF时</p>
<p>当负载因子 &gt; 5 且在执行BGSAVE和BGREWRITEAOF时</p>
<p>哈希表收缩： 负载因子 &lt; 0.1</p>
<ol>
<li>
<p>为ht[1]哈希表分配空间（扩展：第一个$\geq$ ht[0].used * 2 的 $2^n$  收缩：第一个$\geq$ ht[0].used 的 $2^n$）</p>
</li>
<li>
<p>将h[0]的所有键值对rehash到ht[1]——<em><strong>渐进式</strong></em></p>
<p>为避免rehash数量过多对性能的影响</p>
<ul>
<li>维护一个索引计数器rehashidx，设置为0，表示rehash正式开始</li>
<li>在rehash期间，每次对字典进行增删改查时，会顺带将ht[0]哈希表在rehashidx索引上的所有键值对rehash到ht[1]，完成后将rehashidx加 1</li>
<li>当ht[0] 都rehash结束后，将rehashidx设置回 -1，表示rehash结束</li>
</ul>
<p>rehash 期间的查询在两张表上进行，先查ht[0]。插入则一律插入ht[1]</p>
</li>
<li>
<p>释放ht[0]，将ht[1]设置为ht[0]，在ht[0]创建空白哈希表</p>
</li>
</ol>


<h4 class="relative group">1.4 跳跃表 
    <div id="14-%E8%B7%B3%E8%B7%83%E8%A1%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#14-%E8%B7%B3%E8%B7%83%E8%A1%A8" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>有序集合键的底层实现、集群节点的内部数据结构</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">zskiplistNode</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">struct</span> <span class="n">zskiplistLevel</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">struct</span> <span class="n">zskiplistNode</span> <span class="o">*</span><span class="n">forword</span><span class="p">;</span>	<span class="c1">// 前进指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">span</span><span class="p">;</span>				<span class="c1">// 跨度	记录两个节点之间的距离
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span> <span class="n">level</span><span class="p">[];</span>							<span class="c1">// 层
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">struct</span> <span class="n">zskiplistNode</span> <span class="o">*</span><span class="n">backward</span><span class="p">;</span>		<span class="c1">// 后退指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">double</span> <span class="n">score</span><span class="p">;</span>	<span class="c1">// 分值									·可以相同
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">robj</span> <span class="o">*</span><span class="n">obj</span><span class="p">;</span>		<span class="c1">// 成员对象 指向一个字符串对象（保存着一个SDS） ·必须唯一
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">zskiplistNode</span><span class="p">;</span>	<span class="c1">// 跳跃表节点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">zskiplist</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">struct</span> <span class="n">zskiplistNode</span> <span class="o">*</span><span class="n">header</span><span class="p">,</span> <span class="o">*</span><span class="n">tail</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">length</span><span class="p">;</span>	<span class="c1">// 表中节点数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">level</span><span class="p">;</span>	<span class="c1">// 最大层数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="n">zskiplist</span><span class="p">;</span>		<span class="c1">// 跳跃表
</span></span></span></code></pre></div><p>跨度用于计算元素的排位次序，将沿途的跨度求和就是节点在跳跃表中的排位</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://pic3.zhimg.com/80/v2-f34bd04366b237fbcc8874616aba2486_1440w.webp" alt="img" />
    
  </figure>
</p>
<p><strong>插入</strong>：随机分配一个层数（1-32）。</p>
<p>
  <figure>
    <img class="my-0 rounded-md" loading="lazy" src="https://pic4.zhimg.com/80/v2-eb26c20c62fb67ca336e72383c03a753_1440w.webp" alt="img" />
    
  </figure>
</p>
<p><strong>查找</strong> ：跳表在原有的有序链表上面增加了多级索引，通过索引来实现快速查找。首先在最高级索引上查找最后一个小于当前查找元素的位置，然后再跳到次高级索引继续查找，直到跳到最底层为止，这时候以及十分接近要查找的元素的位置了(如果查找元素存在的话)。由于根据索引可以一次跳过多个元素，所以跳查找的查找速度也就变快了</p>


<h4 class="relative group">1.5 整数集合 
    <div id="15-%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#15-%E6%95%B4%E6%95%B0%E9%9B%86%E5%90%88" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>集合键的底层实现之一，集合只包含整数、元素不多时使用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">intset</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">uint32_t</span> <span class="n">encoding</span><span class="p">;</span>	<span class="c1">// 编码方式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">uint32_t</span> <span class="n">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int8_t</span> <span class="n">contents</span><span class="p">[]</span>	<span class="c1">// 保存元素的数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span><span class="n">intset</span><span class="p">;</span>
</span></span></code></pre></div><p>contents 中不包含重复项，且按值的大小从小到大有序地排列。数组的类型真正取决于encoding的值</p>
<p><strong>升级</strong>：添加新元素，且新元素类型比数组的都要长时</p>
<ol>
<li>根据新元素类型，扩展数组的空间大小</li>
<li>将所有的元素转为新元素相同的类型</li>
<li>将新元素添加到数组中（要么比现有都大，放到最后；要么比现有都小，放到开头）</li>
</ol>
<p>升级的好处：提升灵活性、节约内存</p>
<p><strong>降级</strong>: 不支持</p>


<h4 class="relative group">1.6 压缩列表 
    <div id="16-%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#16-%E5%8E%8B%E7%BC%A9%E5%88%97%E8%A1%A8" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>列表键、哈希键的底层实现之一。数量较少，且每项都是小整数值或者较短的字符串时使用。</p>
<p><strong>压缩列表</strong>：</p>
<p>zlbytes	uint32_t	占用字节数</p>
<p>zltail		uint32_t	记录表尾节点（最后一个entry）的偏移量</p>
<p>zllen		uint16_t	记录列表包含节点数</p>
<p>entryX	压缩列表的各个节点</p>
<p>zlend		uint8_t	=0xFF 标记压缩列表末尾</p>
<p><strong>压缩列表节点</strong>：</p>
<p>previous_entry_length	记录前一个节点长度，用于计算前一个节点的地址，长度为1（长度在254之下）或5字节</p>
<p>encoding							1、2或5字节长 		最高位为00、01、10的为字节数组  11开头的为整数</p>
<p>content</p>
<p><strong>连锁更新</strong>：插入一个节点为$\geq254$长度时，有可能后一个节点无法记录此长度，从而导致后续节点需要连锁更新为5字节长的previous_entry_length、有可能发生连锁的更新。	删除也可能引发连锁更新。但造成的性能问题的可能很低（长的连锁更新概率小）</p>


<h4 class="relative group">1.7 对象系统 
    <div id="17-%E5%AF%B9%E8%B1%A1%E7%B3%BB%E7%BB%9F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#17-%E5%AF%B9%E8%B1%A1%E7%B3%BB%E7%BB%9F" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>每次创建一个键值对，至少会创建两个对象：一个键对象（总是字符串对象）一个值对象（可以是字符串、列表、哈希、集合或有序集合对象）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">redisObject</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="nl">type</span><span class="p">:</span><span class="mi">4</span><span class="p">;</span>	<span class="c1">// 类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="nl">encoding</span><span class="p">:</span><span class="mi">4</span><span class="p">;</span><span class="c1">// 编码，记录对象使用了什么数据结构
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>			<span class="c1">// 指向底层数据结构的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">refcount</span><span class="p">;</span>		<span class="c1">// 引用计数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">unsigned</span> <span class="nl">lru</span><span class="p">:</span><span class="mi">22</span><span class="p">;</span>	<span class="c1">// 空转时长
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="n">robj</span><span class="p">;</span>
</span></span></code></pre></div><table>
<thead>
<tr>
<th>类型</th>
<th>编码</th>
<th>对象</th>
<th>场景</th>
</tr>
</thead>
<tbody>
<tr>
<td>string</td>
<td>REDIS_ENCODING_INT</td>
<td>整数值实现的字符串对象</td>
<td>保存整数且可以用long表示</td>
</tr>
<tr>
<td></td>
<td>REDIS_ENCODING_EMBSTR</td>
<td>使用embstr编码的SDS实现的字符串对象、只读</td>
<td>保存字符串、字符串长度$\leq32$字节</td>
</tr>
<tr>
<td></td>
<td>REDIS_ENCODING_RAW</td>
<td>使用SDS实现的字符串对象</td>
<td>保存字符串、字符串长度$&gt;32$字节</td>
</tr>
<tr>
<td>list</td>
<td>REDIS_ENCODING_ZIPLIST</td>
<td>压缩列表实现的列表对象</td>
<td></td>
</tr>
<tr>
<td></td>
<td>REDIS_ENCODING_LINKEDLIST</td>
<td>双端列表实现的列表对象</td>
<td></td>
</tr>
<tr>
<td>hash</td>
<td>REDIS_ENCODING_ZIPLIST</td>
<td>压缩列表实现的哈希对象</td>
<td></td>
</tr>
<tr>
<td></td>
<td>REDIS_ENCODING_HT</td>
<td>字典实现的哈希对象</td>
<td></td>
</tr>
<tr>
<td>set</td>
<td>REDIS_ENCODING_INTSET</td>
<td>整数集合实现的集合对象</td>
<td></td>
</tr>
<tr>
<td></td>
<td>REDIS_ENCODING_HT</td>
<td>字典实现的集合对象</td>
<td></td>
</tr>
<tr>
<td>zset</td>
<td>REDIS_ENCODING_ZIPLIST</td>
<td>压缩列表实现的有序集合对象</td>
<td></td>
</tr>
<tr>
<td></td>
<td>REDIS_ENCODING_SKIPLIST</td>
<td>跳跃表和字典实现的有序集合对象</td>
<td></td>
</tr>
</tbody>
</table>


<h5 class="relative group">字符串对象 
    <div id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>embstr编码的SDS将内存分配次数降低为1次，释放内存也是1次。内存连续</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-2_hua219cdeba30295abdd083233bf9fd7a3_44561_330x0_resize_q75_box.jpg 330w,
        /img/Redis-2_hua219cdeba30295abdd083233bf9fd7a3_44561_660x0_resize_q75_box.jpg 660w,
        /img/Redis-2_hua219cdeba30295abdd083233bf9fd7a3_44561_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-2_hua219cdeba30295abdd083233bf9fd7a3_44561_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-2_hua219cdeba30295abdd083233bf9fd7a3_44561_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-3_hu0c744399bbc74802da459b9394d38568_68415_330x0_resize_q75_box.jpg 330w,
        /img/Redis-3_hu0c744399bbc74802da459b9394d38568_68415_660x0_resize_q75_box.jpg 660w,
        /img/Redis-3_hu0c744399bbc74802da459b9394d38568_68415_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-3_hu0c744399bbc74802da459b9394d38568_68415_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-3_hu0c744399bbc74802da459b9394d38568_68415_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>


<h5 class="relative group">列表对象 
    <div id="%E5%88%97%E8%A1%A8%E5%AF%B9%E8%B1%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%88%97%E8%A1%A8%E5%AF%B9%E8%B1%A1" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>保存的字符串长度都小于64字节 &amp;&amp; 元素数量小于512  时使用ziplist编码（压缩列表）。</p>
<p>否则使用双端链表（linkedlist编码）。其底层为若干字符串对象连接而成</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-4_hue3717acc57a2e1e6bf6bb8593fdac29f_64902_330x0_resize_q75_box.jpg 330w,
        /img/Redis-4_hue3717acc57a2e1e6bf6bb8593fdac29f_64902_660x0_resize_q75_box.jpg 660w,
        /img/Redis-4_hue3717acc57a2e1e6bf6bb8593fdac29f_64902_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-4_hue3717acc57a2e1e6bf6bb8593fdac29f_64902_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-4_hue3717acc57a2e1e6bf6bb8593fdac29f_64902_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-5_hu5282214926859c4d4dc4fd007512466c_84764_330x0_resize_q75_box.jpg 330w,
        /img/Redis-5_hu5282214926859c4d4dc4fd007512466c_84764_660x0_resize_q75_box.jpg 660w,
        /img/Redis-5_hu5282214926859c4d4dc4fd007512466c_84764_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-5_hu5282214926859c4d4dc4fd007512466c_84764_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-5_hu5282214926859c4d4dc4fd007512466c_84764_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>


<h5 class="relative group">哈希对象 
    <div id="%E5%93%88%E5%B8%8C%E5%AF%B9%E8%B1%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E5%93%88%E5%B8%8C%E5%AF%B9%E8%B1%A1" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>保存的字符串长度都小于64字节 &amp;&amp; 元素数量小于512  时使用ziplist编码（压缩列表）。</p>
<p>​	此时键值对按顺序排放：每次在表尾插入一个键对象、一个值对象</p>
<p>其他情况：hashtable编码</p>
<p>​	字典的每个键和值都是字符串对象</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-6_hu93a37483bbf66fba640c61afdd6b28f8_30791_330x0_resize_q75_box.jpg 330w,
        /img/Redis-6_hu93a37483bbf66fba640c61afdd6b28f8_30791_660x0_resize_q75_box.jpg 660w,
        /img/Redis-6_hu93a37483bbf66fba640c61afdd6b28f8_30791_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-6_hu93a37483bbf66fba640c61afdd6b28f8_30791_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-6_hu93a37483bbf66fba640c61afdd6b28f8_30791_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-7_huaedea114b12dd8752a3b920a291ad7c4_40423_330x0_resize_q75_box.jpg 330w,
        /img/Redis-7_huaedea114b12dd8752a3b920a291ad7c4_40423_660x0_resize_q75_box.jpg 660w,
        /img/Redis-7_huaedea114b12dd8752a3b920a291ad7c4_40423_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-7_huaedea114b12dd8752a3b920a291ad7c4_40423_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-7_huaedea114b12dd8752a3b920a291ad7c4_40423_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-8_hudbb8fab5f507a2b708b70449a69e687d_57466_330x0_resize_q75_box.jpg 330w,
        /img/Redis-8_hudbb8fab5f507a2b708b70449a69e687d_57466_660x0_resize_q75_box.jpg 660w,
        /img/Redis-8_hudbb8fab5f507a2b708b70449a69e687d_57466_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-8_hudbb8fab5f507a2b708b70449a69e687d_57466_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-8_hudbb8fab5f507a2b708b70449a69e687d_57466_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>


<h5 class="relative group">集合对象 
    <div id="%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>元素都是整数 &amp;&amp; 数量小于512  	使用intset编码（整数集合）</p>
<p>hashtable编码：键都是字符串对象（包含一个集合元素），值都为NULL</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-9_hu288a1c8df7cb3239eb6ba6874a9bcf1e_91069_330x0_resize_q75_box.jpg 330w,
        /img/Redis-9_hu288a1c8df7cb3239eb6ba6874a9bcf1e_91069_660x0_resize_q75_box.jpg 660w,
        /img/Redis-9_hu288a1c8df7cb3239eb6ba6874a9bcf1e_91069_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-9_hu288a1c8df7cb3239eb6ba6874a9bcf1e_91069_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-9_hu288a1c8df7cb3239eb6ba6874a9bcf1e_91069_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>


<h5 class="relative group">有序集合对象 
    <div id="%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E5%AF%B9%E8%B1%A1" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>保存的成员长度都小于64字节 &amp;&amp; 元素数量小于128  时使用ziplist编码（压缩列表）。</p>
<p>​	每个集合元素使用两个压缩列表节点：一个保存成员、一个保存分值</p>
<p>skipllist编码：使用zset结构作为底层实现</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">zset</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">zskiplist</span> <span class="o">*</span><span class="n">zsl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">dict</span> <span class="o">*</span><span class="n">dict</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">zset</span><span class="p">;</span>
</span></span></code></pre></div><p>zsl跳跃表按分值保存了所有元素</p>
<p>dict字典为集合创建一个从成员到分值的映射</p>
<p>这两个结构通过指针共享相同元素的成员和分值，同时使用不会浪费额外的内存</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-10_hu11f3de49be40bdda87f5c0e164eaf061_28184_330x0_resize_q75_box.jpg 330w,
        /img/Redis-10_hu11f3de49be40bdda87f5c0e164eaf061_28184_660x0_resize_q75_box.jpg 660w,
        /img/Redis-10_hu11f3de49be40bdda87f5c0e164eaf061_28184_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-10_hu11f3de49be40bdda87f5c0e164eaf061_28184_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-10_hu11f3de49be40bdda87f5c0e164eaf061_28184_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-11_hu3ec1513976ada5c5c5a0a9d1a1c794df_38460_330x0_resize_q75_box.jpg 330w,
        /img/Redis-11_hu3ec1513976ada5c5c5a0a9d1a1c794df_38460_660x0_resize_q75_box.jpg 660w,
        /img/Redis-11_hu3ec1513976ada5c5c5a0a9d1a1c794df_38460_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-11_hu3ec1513976ada5c5c5a0a9d1a1c794df_38460_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-11_hu3ec1513976ada5c5c5a0a9d1a1c794df_38460_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-12_huab96c88281068bdcb33c16f1055c4fc7_28449_330x0_resize_q75_box.jpg 330w,
        /img/Redis-12_huab96c88281068bdcb33c16f1055c4fc7_28449_660x0_resize_q75_box.jpg 660w,
        /img/Redis-12_huab96c88281068bdcb33c16f1055c4fc7_28449_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-12_huab96c88281068bdcb33c16f1055c4fc7_28449_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-12_huab96c88281068bdcb33c16f1055c4fc7_28449_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-13_hu10b38eac3ac5f8d20c04692e45f7b458_99438_330x0_resize_q75_box.jpg 330w,
        /img/Redis-13_hu10b38eac3ac5f8d20c04692e45f7b458_99438_660x0_resize_q75_box.jpg 660w,
        /img/Redis-13_hu10b38eac3ac5f8d20c04692e45f7b458_99438_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-13_hu10b38eac3ac5f8d20c04692e45f7b458_99438_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-13_hu10b38eac3ac5f8d20c04692e45f7b458_99438_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>


<h3 class="relative group">1.8 类型检查与命令多态 
    <div id="18-%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E4%B8%8E%E5%91%BD%E4%BB%A4%E5%A4%9A%E6%80%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#18-%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5%E4%B8%8E%E5%91%BD%E4%BB%A4%E5%A4%9A%E6%80%81" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><strong>类型检查</strong> 对需执行的命令，先检查键的值对象类型（对象结构的type属性）是否为目标命令的对象</p>
<p><strong>命令多态</strong> 对象的底层结构不唯一，因此命令是多态的。在检查完类型后，会检查值对象的编码是哪一种编码，再调用具体的函数</p>


<h3 class="relative group">1.9 内存回收、对象共享、对象的空转时长 
    <div id="19-%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6%E5%AF%B9%E8%B1%A1%E5%85%B1%E4%BA%AB%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%A9%BA%E8%BD%AC%E6%97%B6%E9%95%BF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#19-%E5%86%85%E5%AD%98%E5%9B%9E%E6%94%B6%E5%AF%B9%E8%B1%A1%E5%85%B1%E4%BA%AB%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%A9%BA%E8%BD%AC%E6%97%B6%E9%95%BF" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>引用计数：每个对象的引用计数信息在redisObject的refcount属性中保存</p>
<p>对象共享：将键的值指针指向一个现有的对象，将被共享的值对象引用计数增1。</p>
<p>​				在初始化Redis服务器时，会创建一万个字符串对象（0-9999的整数值）备用</p>
<p>空转时长：redisObject的最后一个属性 lru，记录最后一次被命令程序访问的时间。</p>
<p>​				若服务器开启了maxmemory选项，且回收内存的算法为volatile-lru或allkeys-lru，当内存占用超限时，空转时间高的键优先被服务器释放</p>


<h3 class="relative group">2.指令 
    <div id="2%E6%8C%87%E4%BB%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#2%E6%8C%87%E4%BB%A4" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><a href="https://redis.io/commands" target="_blank">官方文档</a> 、<code>help</code>、大小写不敏感</p>


<h4 class="relative group">1）通用命令 
    <div id="1%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#1%E9%80%9A%E7%94%A8%E5%91%BD%E4%BB%A4" aria-label="锚点">#</a>
    </span>        
    
</h4>
<ul>
<li>
<p><code>KEYS pattern</code> 查看符合模板的所有key，不建议在生产环境上使用[O(N)，太慢了]</p>
<blockquote>
<p>？		模糊匹配单个字符</p>
<p>*		匹配多个字符</p>
<p>[ae]     其中之一</p>
<p>[^a]     排除a</p>
<p>[a-b]   其中之一</p>
</blockquote>
</li>
<li>
<p><code>DEL key [key ...]</code> 删除指定的key O(1)</p>
</li>
<li>
<p><code>EXISTS key [key ...]</code> 指定key存在的数目 O(1)</p>
</li>
<li>
<p><code>EXPIRE key seconds [NX | XX | GT | LT] </code>  O(1)</p>
<blockquote>
<p>NX 无到期时间才设置</p>
<p>XX 有到期时间才设置</p>
<p>GT 新时间大于旧时间才设置</p>
<p>LT 旧时间大于新时间才设置</p>
</blockquote>
</li>
<li>
<p><code>TTL key</code> 返回有效期（秒）O(1)</p>
<blockquote>
<p>-2 键不存在</p>
<p>-1 永久</p>
</blockquote>
</li>
</ul>


<h4 class="relative group">2）String命令 
    <div id="2string%E5%91%BD%E4%BB%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#2string%E5%91%BD%E4%BB%A4" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>字符串格式分三类，最大空间不能超过512M：</p>
<ol>
<li>string 普通字符串</li>
<li>int 整数类型，可以自增自减</li>
<li>float 浮点类型，可以自增自减</li>
</ol>
<p>本质都是字节数组形式存储，只是编码形式不同</p>
<ul>
<li>
<p><code>SET key value [NX | XX] [GET] [EX seconds | PX milliseconds | EXAT unix-time-seconds | PXAT unix-time-milliseconds | KEEPTTL]</code>添加或修改 O(1)</p>
<blockquote>
<p>EX 秒——设置指定的过期时间，以秒为单位</p>
<p>PX 毫秒 &ndash; 设置指定的过期时间，以毫秒为单位</p>
<p>EXAT timestamp-seconds &ndash; 设置密钥过期的指定 Unix 时间，以秒为单位</p>
<p>PXAT timestamp-milliseconds &ndash; 设置密钥过期的指定 Unix 时间，以毫秒为单位</p>
<p>NX &ndash; 仅当key尚不存在时才设置该key</p>
<p>XX &ndash; 仅当key已存在时才设置该key</p>
<p>KEEPTTL——保留与key相关的生存时间</p>
<p>GET &ndash; 返回存储在 key 处的旧字符串，如果 key 不存在则返回 nil</p>
<p>​       														   如果 key 存储的值不是字符串，则会返回错误并中止 SET</p>
</blockquote>
</li>
<li>
<p><code>GET key</code> 获取键对应的值，不存在则返回nil O(1)</p>
</li>
<li>
<p><code>MSET key value [key value ...]</code> 批量添加键值对 O(1)</p>
</li>
<li>
<p><code>MGET key [key ...]</code> 批量获取键对应的值，不存在用nil填充 O(1)</p>
</li>
<li>
<p><code>INCR key</code> 将键中存储的数字加一，此操作仅限于 64 位有符号整数。返回增加后的值 O(1)</p>
<blockquote>
<p>如果key不存在，则在执行操作之前将其设置为0</p>
<p>如果键包含错误类型的值或包含无法表示为整数的字符串，则会返回错误</p>
</blockquote>
</li>
<li>
<p><code>INCRBY key increment</code> 按增量增加存储在 key 中的数字 O(1)</p>
</li>
<li>
<p><code>INCRBYFLOAT key increment</code> 将存储在 key 处的浮点数的字符串增加指定的增量  O(1)</p>
<blockquote>
<p>如果该键不存在，则在执行操作之前将其设置为 0</p>
<p>键包含错误类型的值（不是字符串）或当前键内容或指定增量不可解析为双精度浮点数时报错</p>
<p>无论计算的实际内部精度如何，输出的精度固定为小数点后 17 位</p>
<p>可以使用 2.0e2 这类表示</p>
</blockquote>
</li>
<li>
<p><code>SETNX key value</code> 若 key 不存在，则将键设置为字符串值。在这种情况下，它等效于SET  O(1)</p>
<p>​                                  当 key 已有时，不执行任何操作。 SETNX 是“SET if Not eXists”的缩写</p>
</li>
<li>
<p><code>SETEX key seconds value</code> 将 key 设置为 value，并将 key 设置为在给定秒数后超时 O(1)</p>
<blockquote>
<p>等效于 SET key value EX seconds</p>
</blockquote>
</li>
</ul>


<h4 class="relative group">3）Key的层级格式 
    <div id="3key%E7%9A%84%E5%B1%82%E7%BA%A7%E6%A0%BC%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#3key%E7%9A%84%E5%B1%82%E7%BA%A7%E6%A0%BC%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>允许使用冒号隔开形成层级结构（并非固定）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> heima:user:1 <span class="s1">&#39;{&#34;id&#34;:1, &#34;name&#34;:&#34;TC&#34;, &#34;age&#34;:21}&#39;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> heima:user:2 <span class="s1">&#39;{&#34;id&#34;:2, &#34;name&#34;:&#34;TCmatj&#34;, &#34;age&#34;:23}&#39;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> heima:product:1 <span class="s1">&#39;{&#34;id&#34;:1, &#34;name&#34;:&#34;ipad&#34;, &#34;price&#34;:6150}&#39;</span>
</span></span><span class="line"><span class="cl">127.0.0.1:6379&gt; <span class="nb">set</span> heima:product:2 <span class="s1">&#39;{&#34;id&#34;:2, &#34;name&#34;:&#34;pc&#34;, &#34;price&#34;:9600}&#39;</span>
</span></span></code></pre></div>

<h4 class="relative group">4）Hash类型 
    <div id="4hash%E7%B1%BB%E5%9E%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#4hash%E7%B1%BB%E5%9E%8B" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>也叫散列，value是一个无序字典，类似于Java中HashMap结构</p>
<p>Hash结构可以将对象中的每个字段独立存储，可以针对单个字段做CRUD</p>
<ul>
<li>
<p><code>HSET key field value [field value ...]</code></p>
</li>
<li>
<p><code>HGET key field</code></p>
</li>
<li>
<p><code>HMSET key field value [field value ...]</code></p>
</li>
<li>
<p><code>HMGET key field [field ...]</code></p>
</li>
<li>
<p><code>HGETALL key</code> 字段和值列表</p>
</li>
<li>
<p><code>HKEYS key</code> 字段列表</p>
</li>
<li>
<p><code>HVALS</code> 值列表</p>
</li>
<li>
<p><code>HINCRBY key field increment</code> key不存在会新建，字段不存在会设为0</p>
</li>
<li>
<p><code>HSETNX key field value</code> 仅当字段不存在时，才将存储在键处的哈希中的字段设置为值。如果字段已经存在，则此操作无效。</p>
<p>​                                                 如果key不存在，则会创建一个包含哈希值的key。</p>
</li>
</ul>


<h4 class="relative group">5）List 类型 
    <div id="5list-%E7%B1%BB%E5%9E%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#5list-%E7%B1%BB%E5%9E%8B" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>可以看做双向链表，既可以正向检索也支持反向检索</p>
<ul>
<li>
<p><code>LPUSH key element [element ...]</code>  将所有值插入存储在 key 的列表的头部	O(1)</p>
<p>​																	如果 key 不存在，创建为空列表。</p>
<p>​																	当 key 保存的值不是列表时，会返回错误，否则返回列表长度</p>
</li>
<li>
<p><code>LPOP key [count]</code> 删除并返回存储在 key 处的列表的前count个元素  O(1)</p>
</li>
<li>
<p><code>RPUSH key element [element ...]</code> 将所有值插入存储在 key 的列表的尾部	O(1)</p>
</li>
<li>
<p><code>RPOP key [count]</code> 删除并返回存储在 key 处的列表的后count个元素  O(1)</p>
</li>
<li>
<p><code>LRANGE key start stop</code> 返回存储在 key 处的列表的指定元素。偏移量 start 和 stop 是从零开始的索引 O(S + N)</p>
</li>
<li>
<p><code>BLPOP key [key ...] timeout</code> BLPOP 是阻止列表弹出原语。它是 LPOP 的阻塞版本，因为当没有可以从任何给定列表中弹出的元素时，它会阻塞连接。从第一个非空列表的头部弹出一个元素，并按照给出的顺序检查给定的键。阻塞到 timeout 时才放行，0表示无限期阻塞</p>
</li>
<li>
<p><code>BRPOP key [key ...] timeout</code> RPOP 是阻止列表弹出原语。它是RPOP 的阻塞版本，因为当没有可以从任何给定列表中弹出的元素时，它会阻塞连接。从第一个非空列表的尾部弹出一个元素，并按照给出的顺序检查给定的键</p>
</li>
</ul>


<h4 class="relative group">6）Set 类型 
    <div id="6set-%E7%B1%BB%E5%9E%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#6set-%E7%B1%BB%E5%9E%8B" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>与HashSet类似</p>
<p>无序、不重复、查找快、支持交并补</p>
<ul>
<li><code>SADD key member [member ...]</code> 添加，已存在的会被忽略  O(1)</li>
<li><code>SREM key member [member ...]</code> 删除，不存在的会被忽略  O(1)</li>
<li><code>SCARD key</code> 返回存储在 key 处的集合的集合基数（元素数量） O(1)</li>
<li><code>SISMEMBER key member</code> 如果 member 是存储在 key 处的集合的成员，则返回1，否则返回0   <strong>O(1)</strong></li>
<li><code>SMEMBERS key</code> 返回存储在 key 处的设置值的所有成员  <strong>O(1)</strong></li>
<li><code>SINTER key [key ...]</code> 返回由所有给定集合的<strong>交集</strong>产生的集合的成员 <strong>O(N*M)</strong> 最坏情况，N 是最小集合的基数，M 是集合的数量</li>
<li><code>SDIFF key [key ...]</code> 返回由第一个集合和所有连续集合之间的<strong>差</strong>异产生的<strong>集</strong>合的成员 <strong>O(N)</strong></li>
<li><code>SUNION key [key ...]</code> 返回由所有给定集合<strong>并集</strong>产生的集合的成员  <strong>O(N)</strong></li>
</ul>


<h4 class="relative group">7）SortedSet类型 
    <div id="7sortedset%E7%B1%BB%E5%9E%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#7sortedset%E7%B1%BB%E5%9E%8B" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>可排序的Set集合，与Java的TreeSet类似，底层差异很大。SortedSet中的每个元素都有一个score属性，可以基于它进行排序，底层实现是一个跳表+hash表。Java TreeSet：红黑树</p>
<p>可排序、不重复、查询速度快</p>
<ul>
<li>
<p><code>ZADD  key [NX | XX] [GT | LT] [CH] [INCR] score member [score member ...]</code> O(log(N))</p>
<blockquote>
<p>将具有指定分数的所有指定成员添加到存储在 key 处的排序集中。可以指定多个分数/成员对</p>
<p>如果指定的成员已经是排序集的成员，则更新分数并将元素重新插入到正确的位置以确保正确的排序</p>
<p>分数值应该是双精度浮点数的字符串表示形式。 +inf 和 -inf 值也是有效值</p>
<p>XX：只更新已经存在的元素。不要添加新元素</p>
<p>NX：仅添加新元素。不要更新已经存在的元素</p>
<p>LT：如果新分数小于当前分数，则仅更新现有元素。该标志不会阻止添加新元素</p>
<p>GT：仅当新分数大于当前分数时才更新现有元素。该标志不会阻止添加新元素</p>
<p>CH：将返回值从新增元素的数量修改为已更改元素的总数，通常ZADD的返回值<strong>只统计添加的新元素的数量</strong></p>
<p>INCR：指定此选项时，ZADD 的作用类似于 ZINCRBY。在此模式下只能指定一对分数元素</p>
<p><strong>GT、LT 和 NX</strong> 选项是互斥的</p>
</blockquote>
</li>
<li>
<p><code>ZREM key member [member ...]</code> 从存储在 key 处的排序集中删除指定的成员。不存在的成员将被忽略 O(M*log(N))</p>
</li>
<li>
<p><code>ZSCORE key member</code> 返回 key 处排序集中成员的分数 O(1)</p>
</li>
<li>
<p><code>ZRANK key member [WITHSCORE]</code>  返回存储在 key 处的排序集中成员的<strong>排名</strong>，分数从低到高排序。排名（或索引）从 0 开始</p>
<p><code>ZREVRANK key member [WITHSCORE]</code>	分数高到低排序      <code>WITHSCORE</code> ：携带分数	 O(log(N))</p>
</li>
<li>
<p><code>ZCARD key</code> 返回存储在 key 处的排序集的排序集基数（元素数量）O(1)</p>
</li>
<li>
<p><code>ZCOUNT key min max</code> 返回排序集中 key 上得分介于 min 和 max 之间的元素数量    O(log(N)) N 是排序集中的元素数量</p>
</li>
<li>
<p><code>ZINCRBY key increment member</code> 按增量增加存储在 key 处的排序集中成员的分数    O(log(N))，其中 N 是排序集中的元素数量</p>
<p>​															返回成员的新分数</p>
</li>
<li>
<p><code>ZRANGE key start stop [BYSCORE | BYLEX] [REV] [LIMIT offset count] [WITHSCORES]</code></p>
<blockquote>
<p>O(log(N)+M)  N 是排序集中的元素数量，M 是返回的元素数量</p>
<p>返回存储在 <key> 的排序集中指定范围的元素。</p>
<p>可以执行不同类型的范围查询：按索引（排名）、按分数或按字典顺序</p>
</blockquote>
</li>
<li>
<p><code>ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code>  O(log(N)+M)</p>
<blockquote>
<p>返回排序集中 key 上得分在 min 和 max 之间的所有元素（包括得分等于 min 或 max 的元素）。这些元素被认为是从低分到高分排序的，具有相同分数的元素按字典顺序返回</p>
<p>可以使用括号代表开区间 <code>(</code> 、<code>)</code></p>
</blockquote>
</li>
<li>
<p><code> ZUNION numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE &lt;SUM | MIN | MAX&gt;] [WITHSCORES]</code></p>
<blockquote>
<p>O(N)+O(M*log(M))，其中 N 是输入排序集大小的总和，M 是结果排序集中的元素数量</p>
<p>求并集，与 ZUNIONSTORE 类似，但不是存储结果排序集，而是将其返回给客户端</p>
</blockquote>
</li>
<li>
<p><code>ZDIFF numkeys key [key ...] [WITHSCORES]</code></p>
<blockquote>
<p>O(L + (N-K)log(N)) 最坏情况，其中 L 是所有集合中的元素总数，N 是第一个集合的大小，K 是结果集的大小</p>
<p>求交集，与 ZDIFFSTORE 类似，但不是存储结果排序集，而是将其返回给客户端</p>
</blockquote>
</li>
<li>
<p><code>ZINTER numkeys key [key ...] [WEIGHTS weight [weight ...]] [AGGREGATE &lt;SUM | MIN | MAX&gt;] [WITHSCORES]</code></p>
<blockquote>
<p>O(N*K)+O(M*log(M)) 最坏情况，其中 N 是最小输入排序集，K 是输入排序集的数量，M 是结果排序集中的元素数量</p>
<p>求并集，与 ZINTERSTORE 类似，但不是存储结果排序集，而是将其返回给客户端</p>
</blockquote>
</li>
</ul>


<h3 class="relative group">3. 数据库 
    <div id="3-%E6%95%B0%E6%8D%AE%E5%BA%93" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">3.1  数据结构 
    <div id="31--%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#31--%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">redisServer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">redisDb</span> <span class="o">*</span><span class="n">db</span><span class="p">;</span>	<span class="c1">// 保存所有数据库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">dbnum</span><span class="p">;</span>		<span class="c1">// 服务器的数据库数量（默认16）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">struct</span> <span class="n">saveparam</span> <span class="o">*</span><span class="n">saveparams</span><span class="p">;</span>	<span class="c1">// 保存条件的数组（bgsave）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">long</span> <span class="kt">long</span> <span class="n">dirty</span><span class="p">;</span><span class="c1">// 修改计数器，上次save/bgsave后对数据库的修改次数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">time_t</span> <span class="n">lastsave</span><span class="p">;</span><span class="c1">// 上次执行保存的时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="n">list</span> <span class="o">*</span><span class="n">clients</span><span class="p">;</span>				<span class="c1">// 保存所有客户端状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">redisClient</span> <span class="o">*</span><span class="n">lua_client</span><span class="p">;</span>	<span class="c1">// lua脚本创建的客户端会被关联到这里，lua客户端只有服务器关闭才会被关闭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    							<span class="c1">// AOF创建的伪客户端在载入完成后关闭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="o">*</span><span class="n">masterhost</span><span class="p">;</span>			<span class="c1">// 主服务器地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">masterport</span><span class="p">;</span>				<span class="c1">// 主服务器端口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dict</span> <span class="o">*</span><span class="n">pubsub_channels</span><span class="p">;</span>		<span class="c1">// 所有频道的订阅关系
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">list</span> <span class="o">*</span><span class="n">pubsub_patterns</span><span class="p">;</span>		<span class="c1">// 所有模式的订阅关系
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>	<span class="c1">// 服务器状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">redisClient</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">redisDb</span> <span class="o">*</span><span class="n">db</span><span class="p">;</span>	<span class="c1">// 记录客户端正使用的数据库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> 	<span class="n">fd</span><span class="p">;</span>		<span class="c1">// 记录正在使用的套接字描述符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">robj</span>	<span class="o">*</span><span class="n">name</span><span class="p">;</span>	<span class="c1">// 客户端名称，默认为NULL
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span>		<span class="n">flags</span><span class="p">;</span>	<span class="c1">// 标记客户端的角色和目前的状态（多个二进制或）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sds</span> 	<span class="n">querybuf</span><span class="p">;</span><span class="c1">// 输入缓冲区，最大不超过1GB，否则关闭客户端
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">robj</span>	<span class="o">**</span><span class="n">argv</span><span class="p">;</span>	<span class="c1">// 数组，每项都是字符串对象，是对querybuf的解析
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    				<span class="c1">// argv[0] 存储指令，之后的为参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span>		<span class="n">argc</span><span class="p">;</span>	<span class="c1">// 记录argv数组的长度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">struct</span> <span class="n">redisCommand</span> <span class="o">*</span><span class="n">cmd</span><span class="p">;</span>	<span class="c1">// 指向argv[0]所对应的redisCommand结构
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="c1">// 固定缓冲区 保存长度较小的回复
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">REDIS_REPLY_CHUNK_BYTES</span><span class="p">];</span>	<span class="c1">// 固定缓冲区REDIS_REPLY_CHUNK_BYTES默认16*1024（16KB）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span>  <span class="n">bufpos</span><span class="p">;</span>	<span class="c1">// 记录buf目前已使用的字节数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 可变大小缓冲区
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">list</span>	<span class="o">*</span><span class="n">reply</span><span class="p">;</span>	<span class="c1">// 使用链表连接多个字符串对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">authenticated</span><span class="p">;</span>	<span class="c1">// 记录客户端是否通过身份验证 =0时，除了AUTH命令都会被拒绝
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="kt">time_t</span> <span class="n">ctime</span><span class="p">;</span>	<span class="c1">// 创建时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">time_t</span> <span class="n">lastinteraction</span><span class="p">;</span>	<span class="c1">// 与服务器最后一次互动时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">time_t</span> <span class="n">obuf_soft_limit_reached_time</span><span class="p">;</span>	<span class="c1">// 缓冲区第一次到达软性限制的时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    										<span class="c1">// 输出缓冲区超过软性限制过久会被关闭客户端，超过硬性限制会被立即关闭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="n">redisClient</span><span class="p">;</span>	<span class="c1">// 客户端状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">redisDb</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dict</span> <span class="o">*</span><span class="n">dict</span><span class="p">;</span>	<span class="c1">// 数据库键空间，保存数据库中所有的键值对
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dict</span> <span class="o">*</span><span class="n">expires</span>	<span class="c1">// 过期字典，保存键的过期时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">redisDb</span><span class="p">;</span>
</span></span></code></pre></div><p>读写键空间需要维护：</p>
<ul>
<li>更新服务器的键空间命中次数和miss次数</li>
<li>更新键的LRU时间</li>
<li>若已过期，需要删除过期键</li>
<li>被监视的键，需要标记为脏</li>
<li>每次修改键后，需对脏键计数器 +1</li>
<li>若开启了数据库通知功能，在对键修改后，按配置发送相应的数据库通知</li>
</ul>
<p>过期字典的键为指针，指向某个键对象。值为long long 类型的过期时间（毫秒精度的UNIX时间戳）</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-14_hucb669c16f371cdb3d8e3bed28bf2150a_113302_330x0_resize_q75_box.jpg 330w,
        /img/Redis-14_hucb669c16f371cdb3d8e3bed28bf2150a_113302_660x0_resize_q75_box.jpg 660w,
        /img/Redis-14_hucb669c16f371cdb3d8e3bed28bf2150a_113302_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-14_hucb669c16f371cdb3d8e3bed28bf2150a_113302_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-14_hucb669c16f371cdb3d8e3bed28bf2150a_113302_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>


<h4 class="relative group">3.2 过期键的删除 
    <div id="32-%E8%BF%87%E6%9C%9F%E9%94%AE%E7%9A%84%E5%88%A0%E9%99%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#32-%E8%BF%87%E6%9C%9F%E9%94%AE%E7%9A%84%E5%88%A0%E9%99%A4" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>采用惰性删除和定期删除的策略</p>
<ul>
<li>每次读写都需要对输入键进行过期检查，若已经过期，则将其删除</li>
<li>在规定时间内，分多次遍历服务器中的各个数据库，每次都取出一定数量的随机键进行过期键删除。current_db记录检查到数据库的进度。每个数据库最多检查过期键数量为20，若达到时间上限就跳过剩下的键，下一次检查下一个数据库。</li>
</ul>


<h4 class="relative group">3.3 持久化和复制功能对过期键的处理 
    <div id="33-%E6%8C%81%E4%B9%85%E5%8C%96%E5%92%8C%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD%E5%AF%B9%E8%BF%87%E6%9C%9F%E9%94%AE%E7%9A%84%E5%A4%84%E7%90%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#33-%E6%8C%81%E4%B9%85%E5%8C%96%E5%92%8C%E5%A4%8D%E5%88%B6%E5%8A%9F%E8%83%BD%E5%AF%B9%E8%BF%87%E6%9C%9F%E9%94%AE%E7%9A%84%E5%A4%84%E7%90%86" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p><strong>RDB</strong>：生成时不保存已经过期的键</p>
<p>​			载入时，主服务器不载入过期键，从服务器都载入。主服务器通过数据同步也会将从服务器的过期键删除</p>
<p><strong>AOF</strong>：写入时，若键已过期，但未被删除，不会有任何影响。被删除后，会向AOF文件追加一条删除命令</p>
<pre tabindex="0"><code>GET 已过期的 A 键时，服务器执行：
1) 删除 A 键
2) 追加一条删除命令到AOF文件
3) 向执行GET命令的客户端返回空回复
</code></pre><p>​		重写AOF时，已过期的键不会保存到重写后的AOF文件中（忽略掉这个键）</p>
<p><strong>复制</strong>：</p>
<ol>
<li>主服务器删除过期键后，向所有从服务器发送一条删除命令</li>
<li>从服务器在执行客户端命令时，即使碰到过期键也不会删除它，像未过期一样处理</li>
<li>只有接收到主服务器的删除命令后才会进行删除</li>
</ol>


<h4 class="relative group">3.4 数据库通知的实现 
    <div id="34-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AE%9E%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#34-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%80%9A%E7%9F%A5%E7%9A%84%E5%AE%9E%E7%8E%B0" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>需要发送通知的命令会调用notifyKeyspaceEvent函数发送通知</p>
<ol>
<li>若给定的通知类型不是服务器允许的类型，不做任何动作</li>
<li>检测是否允许发送键空间通知（某个键执行了什么命令）</li>
<li>检测是否允许发送键事件通知（某个命令被什么键执行了）</li>
</ol>


<h3 class="relative group">4. RDB持久化 
    <div id="4-rdb%E6%8C%81%E4%B9%85%E5%8C%96" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#4-rdb%E6%8C%81%E4%B9%85%E5%8C%96" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><code>save</code> 由Redis主进程执行RDB，会阻塞所有命令</p>
<p><code>bgsave</code> 子进程执行RDB，避免主进程收到影响，默认为当前目录</p>
<ul>
<li><code>save</code>、<code>bgsave</code>会被拒绝，防止竞争执行<code>rdbSave函数</code></li>
<li><code>bgrewriteaof</code>（也是交给子进程）会被拒绝，出于性能考虑</li>
</ul>


<h4 class="relative group">4.1Redis内部的RDB机制（redis.conf）： 
    <div id="41redis%E5%86%85%E9%83%A8%E7%9A%84rdb%E6%9C%BA%E5%88%B6redisconf" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#41redis%E5%86%85%E9%83%A8%E7%9A%84rdb%E6%9C%BA%E5%88%B6redisconf" aria-label="锚点">#</a>
    </span>        
    
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 900秒内，如果至少有 1 个key被修改，则执行bgsave，如果是save &#34;&#34; 表示禁用RDB</span>
</span></span><span class="line"><span class="cl">save <span class="m">900</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">save <span class="m">300</span> <span class="m">10</span>
</span></span><span class="line"><span class="cl">save <span class="m">60</span> <span class="m">10000</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="err">上面三个语句会生成三个</span><span class="n">saveparam</span><span class="err">：</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">saveparam</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">time_t</span> <span class="n">seconds</span><span class="p">;</span>	<span class="c1">// 秒数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">changes</span><span class="p">;</span>	<span class="c1">// 修改数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>	
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># 是否压缩，建议不开启（会消耗cpu）</span>
</span></span><span class="line"><span class="cl">rdbcompression yes
</span></span><span class="line"><span class="cl"><span class="c1"># RDB文件名称</span>
</span></span><span class="line"><span class="cl">dbfilename dump.rdb
</span></span><span class="line"><span class="cl"><span class="c1"># 文件保存路径目录</span>
</span></span><span class="line"><span class="cl">dir ./
</span></span></code></pre></div><p>载入是服务器启动时自动执行的，若开启了AOF持久化，则会优先使用AOF文件还原数据库</p>
<p><strong>serverCron</strong>函数默认<strong>100毫秒</strong>执行一次，其中一项工作就是检查save选项设置的条件是否已经满足[遍历所有条件]，满足就执行bgsave命令</p>


<h4 class="relative group">4.2 RDB文件结构 
    <div id="42-rdb%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#42-rdb%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>REDIS、db_sersion、databases、EOF、check_sum</p>
<ul>
<li>REDIS 		   5字节            保存着REDIS五个字符，检查文件是否是RDB文件</li>
<li>db_version   4字节             字符串表示的整数，0006 表示第六版</li>
<li>databases   0或任意个数据库</li>
<li>EOF               1字节              标志RDB文件内容结束</li>
<li>check_sum   8字节              无符号整数，校验和，检查文件是否出错或损坏</li>
</ul>


<h5 class="relative group">databases部分 
    <div id="databases%E9%83%A8%E5%88%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#databases%E9%83%A8%E5%88%86" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>每个非空数据库可以表示为：SELECTDB、db_number、key_value_pairs</p>
<ul>
<li>SELECTDB    1字节    标记下面的是数据库号码</li>
<li>db_number   1\2\5字节  数据库号码</li>
<li>key_value_pairs   所有键值对</li>
</ul>


<h5 class="relative group">key_value_pairs部分 
    <div id="key_value_pairs%E9%83%A8%E5%88%86" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#key_value_pairs%E9%83%A8%E5%88%86" aria-label="锚点">#</a>
    </span>        
    
</h5>
<p>不带过期时间：TYPE、key、value</p>
<p>带过期时间：EXPIRETIME_MS、ms、TYPE、key、value</p>
<ul>
<li>EXPIRETIME_MS   1 字节    告知接下来为毫秒为单位的过期时间</li>
<li>ms                          8 字节    UNIX时间戳，过期的时间</li>
</ul>


<h3 class="relative group">5. AOF持久化 
    <div id="5-aof%E6%8C%81%E4%B9%85%E5%8C%96" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#5-aof%E6%8C%81%E4%B9%85%E5%8C%96" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>保存服务器所执行的写命令形成AOF文件</p>


<h4 class="relative group">5.1 实现 
    <div id="51-%E5%AE%9E%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#51-%E5%AE%9E%E7%8E%B0" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>命令追加、文件写入、文件同步</p>
<ul>
<li>
<p>AOF被打开时，服务器执行一个写命令之后，会将其协议格式的命令追加到 redisServer 的 aof_buf 缓冲区末尾</p>
</li>
<li>
<p>每个服务器事件循环结束之前，会调用flushAppendOnlyFile文件，考虑是否需要将缓冲区的内容写入和保存到AOF文件中</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">eventLoop</span><span class="p">():</span> <span class="c1"># Redis 服务器进程</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">processFileEvents</span><span class="p">()</span>	<span class="c1"># 处理文件事件，接收命令请求、发送命令回复</span>
</span></span><span class="line"><span class="cl">        <span class="n">processTimeEvents</span><span class="p">()</span>	<span class="c1"># 处理事件事件，如定时函数</span>
</span></span><span class="line"><span class="cl">        <span class="n">flushAppendOnlyFile</span><span class="p">()</span>	<span class="c1"># 考虑是否需要将缓冲区的内容写入和保存到AOF文件中</span>
</span></span></code></pre></div><p>根据<strong>appendfsync</strong>配置不同：</p>
<ul>
<li><strong>always</strong>     将缓冲区所有内容写入并同步到AOF文件</li>
<li><strong>everysec</strong>  <strong>默认</strong>。将缓冲区所有内容写入AOF文件，若上次同步时间超过一秒，则再次进行AOF同步（由一个线程专门负责）</li>
<li><strong>no</strong>             将缓冲区所有内容写入AOF文件，但不同步。何时同步由操作系统决定</li>
</ul>
</li>
</ul>


<h4 class="relative group">5.2 载入与还原 
    <div id="52-%E8%BD%BD%E5%85%A5%E4%B8%8E%E8%BF%98%E5%8E%9F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#52-%E8%BD%BD%E5%85%A5%E4%B8%8E%E8%BF%98%E5%8E%9F" aria-label="锚点">#</a>
    </span>        
    
</h4>
<ol>
<li>创建一个不带网络连接的伪客户端</li>
<li>从AOF文件中分析并读取出一条写命令</li>
<li>使用伪客户端执行这条命令</li>
<li>循环上述2-3，直到处理完毕</li>
</ol>


<h4 class="relative group">5.3 AOF重写 
    <div id="53-aof%E9%87%8D%E5%86%99" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#53-aof%E9%87%8D%E5%86%99" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>创建一个新的AOF文件替代现有的AOF文件，新的文件不会包含任何浪费空间的冗余命令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"> <span class="k">def</span> <span class="nf">AOF重写</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">     <span class="n">创建新AOF文件</span>
</span></span><span class="line"><span class="cl">     <span class="k">for</span> <span class="n">遍历数据库</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">     	<span class="n">忽略空数据库</span>
</span></span><span class="line"><span class="cl">        <span class="n">写入SELECT命令</span><span class="err">，</span><span class="n">指定数据库号码</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">遍历所有数据库中的键</span><span class="err">：</span>
</span></span><span class="line"><span class="cl">            <span class="n">忽略已过期键</span>
</span></span><span class="line"><span class="cl">            <span class="n">按键的类型重写</span>
</span></span><span class="line"><span class="cl">            <span class="n">若带有过期时间</span><span class="err">，</span><span class="n">重写过期时间</span>
</span></span><span class="line"><span class="cl">    <span class="n">写入完毕</span><span class="err">，</span><span class="n">关闭文件</span>
</span></span></code></pre></div><p>AOF后台重写：</p>
<p>使用子进程重写。但有可能打造成数据不一致问题。</p>
<p>Redis服务器设置了一个<strong>AOF重写缓冲区</strong>，创建子进程后，当执行了一条写命令后，会同时给AOF缓冲区和<strong>AOF重写缓冲区</strong>发送.</p>
<p>子进程完成AOF重写工作之后，向父进程发送一个信号，父进程调用信号处理函数（会阻塞服务器）：</p>
<ul>
<li>将AOF重写缓冲区的所有内容写入新AOF文件</li>
<li>对新AOF文件改名，原子地覆盖现有AOF文件</li>
</ul>


<h3 class="relative group">6. 事件 
    <div id="6-%E4%BA%8B%E4%BB%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#6-%E4%BA%8B%E4%BB%B6" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">6.1 文件事件处理器 
    <div id="61-%E6%96%87%E4%BB%B6%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#61-%E6%96%87%E4%BB%B6%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%99%A8" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-15_hu4e705e6e5765f192184010372c2ec445_86926_330x0_resize_q75_box.jpg 330w,
        /img/Redis-15_hu4e705e6e5765f192184010372c2ec445_86926_660x0_resize_q75_box.jpg 660w,
        /img/Redis-15_hu4e705e6e5765f192184010372c2ec445_86926_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-15_hu4e705e6e5765f192184010372c2ec445_86926_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-15_hu4e705e6e5765f192184010372c2ec445_86926_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>通过<strong>队列</strong>传送套接字、依次处理事件</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-16_hu8b70eba53b209a32be39fb84e0099438_59764_330x0_resize_q75_box.jpg 330w,
        /img/Redis-16_hu8b70eba53b209a32be39fb84e0099438_59764_660x0_resize_q75_box.jpg 660w,
        /img/Redis-16_hu8b70eba53b209a32be39fb84e0099438_59764_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-16_hu8b70eba53b209a32be39fb84e0099438_59764_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-16_hu8b70eba53b209a32be39fb84e0099438_59764_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>套接字可读（客户端对套接字执行write/close操作）或有新的可应答套接字出现时，套接字产生AE_READABLE事件</p>
<p>套接字可写（客户端对套接字执行read操作），套接字产生AE_WRITEABLE事件</p>
<p>可读又可写时，服务器会<strong>先读</strong>套接字，<strong>再写</strong>套接字</p>


<h4 class="relative group">6.2 时间事件 
    <div id="62-%E6%97%B6%E9%97%B4%E4%BA%8B%E4%BB%B6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#62-%E6%97%B6%E9%97%B4%E4%BA%8B%E4%BB%B6" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>定时事件和周期性事件，一个时间事件由id、when、timeProc组成</p>
<p>服务器将所有时间事件<strong>放在一个无序链表</strong>中，每当时间事件执行器运行时，遍历整个链表，查找所有已到达的时间事件，并调用相关的事件处理器。正常模式下，只有serverCron一个时间事件，在benchmark模式下只有两个时间事件。</p>
<p><strong>serverCron事件</strong> 默认100ms[可以修改hz选项调整每秒执行次数]：</p>
<ol>
<li>更新各类统计信息，如时间，内存占用、数据库占用</li>
<li>清理过期键值对</li>
<li>关闭和清理连接失效的客户端</li>
<li>尝试进行持久化操作</li>
<li>若为主服务器，对从服务器进行定期同步</li>
<li>若处于集群模式，对集群进行定期同步和连接测试</li>
</ol>


<h4 class="relative group">6.3 服务器事件调度 
    <div id="63-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#63-%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BA%8B%E4%BB%B6%E8%B0%83%E5%BA%A6" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-17_hu1cb05a16b549ad33dc3cc79cfae45973_74374_330x0_resize_q75_box.jpg 330w,
        /img/Redis-17_hu1cb05a16b549ad33dc3cc79cfae45973_74374_660x0_resize_q75_box.jpg 660w,
        /img/Redis-17_hu1cb05a16b549ad33dc3cc79cfae45973_74374_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-17_hu1cb05a16b549ad33dc3cc79cfae45973_74374_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-17_hu1cb05a16b549ad33dc3cc79cfae45973_74374_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
<p>时间时间会比设定的到达时间稍晚一些</p>


<h3 class="relative group">7. 复制模式 
    <div id="7-%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#7-%E5%A4%8D%E5%88%B6%E6%A8%A1%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SLAVEOF &lt;master_ip&gt; &lt;master_port&gt;
</span></span></code></pre></div><p>从服务器向主服务器发送PSYNC指令进行<strong>初次同步（完整重同步）</strong>，主服务器创建RDB文件发给从服务器，载入后主服务器发送缓冲区的写命令给从服务器</p>
<p><strong>部分重同步</strong>：断线后重连（再次发送 <code>PSYNC</code> ）后，主服务器将断线期间的写命令发给从服务器</p>


<h4 class="relative group">7.1 复制偏移量、服务器运行ID 
    <div id="71-%E5%A4%8D%E5%88%B6%E5%81%8F%E7%A7%BB%E9%87%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8Cid" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#71-%E5%A4%8D%E5%88%B6%E5%81%8F%E7%A7%BB%E9%87%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E8%A1%8Cid" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>主从服务器都维持一个复制偏移量</p>
<ul>
<li>主服务器每次向从服务器传播N字节数据时，自增N</li>
<li>从服务器接收N字节时，自增N</li>
</ul>
<p>主服务器启动时生成一个40个十六进制字符组成的ID，用于重连时判断是否是原先的主服务器。若不是原来的主服务器则执行<strong>完整重同步</strong></p>


<h4 class="relative group">7.2 复制积压缓冲区 
    <div id="72-%E5%A4%8D%E5%88%B6%E7%A7%AF%E5%8E%8B%E7%BC%93%E5%86%B2%E5%8C%BA" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#72-%E5%A4%8D%E5%88%B6%E7%A7%AF%E5%8E%8B%E7%BC%93%E5%86%B2%E5%8C%BA" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>队列、默认大小1MB、记录了最近传播的写命令，每个字节都记录了复制偏移量</p>
<p>断线后，从服务器发送 <code>PSYNC</code>（携带复制偏移量）。主服务器根据这个偏移量是否还在复制积压缓冲区中决定执行<strong>部分重同步</strong>或<strong>完整重同步</strong></p>
<p>按需调整大小：为安全设置为 <strong>2 * 平均断线重连时间 * 平均每秒参数的写命令数据量</strong></p>


<h4 class="relative group">7.3 复制的步骤 
    <div id="73-%E5%A4%8D%E5%88%B6%E7%9A%84%E6%AD%A5%E9%AA%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#73-%E5%A4%8D%E5%88%B6%E7%9A%84%E6%AD%A5%E9%AA%A4" aria-label="锚点">#</a>
    </span>        
    
</h4>
<ol>
<li>
<p>从服务器   设置主服务器的地址和端口</p>
</li>
<li>
<p>从服务器  创建连向主服务器的套接字</p>
<p>主服务器  为该套接字创建相应客户端</p>
</li>
<li>
<p>从服务器  向主服务器发送 <code>PING</code></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-18_hu151efea70415df1edfc09c798658d860_206593_330x0_resize_q75_box.jpg 330w,
        /img/Redis-18_hu151efea70415df1edfc09c798658d860_206593_660x0_resize_q75_box.jpg 660w,
        /img/Redis-18_hu151efea70415df1edfc09c798658d860_206593_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-18_hu151efea70415df1edfc09c798658d860_206593_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-18_hu151efea70415df1edfc09c798658d860_206593_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
</li>
<li>
<p>从服务器  向主服务器验证身份   <code>AUTH  xxxx</code></p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/Redis-19_hu976e55271a57caf16cba8ae9adf326e2_73538_330x0_resize_q75_box.jpg 330w,
        /img/Redis-19_hu976e55271a57caf16cba8ae9adf326e2_73538_660x0_resize_q75_box.jpg 660w,
        /img/Redis-19_hu976e55271a57caf16cba8ae9adf326e2_73538_1024x0_resize_q75_box.jpg 1024w,
        /img/Redis-19_hu976e55271a57caf16cba8ae9adf326e2_73538_1320x0_resize_q75_box.jpg 2x"
        src="/img/Redis-19_hu976e55271a57caf16cba8ae9adf326e2_73538_660x0_resize_q75_box.jpg"
        alt=""
      />
      
    </figure>
</p>
</li>
<li>
<p>从服务器  发送端口信息</p>
<p>主服务器   将端口信息记录到套接字对应客户端的 slave_listening_port 属性</p>
</li>
<li>
<p>从服务器  发送 <code>PSYNC</code> 命令，执行同步操作，执行之后主服务器也成为从服务器的客户端</p>
</li>
<li>
<p>主从服务器进入命令传播阶段</p>
<p>默认向主服务器每秒发送一次<strong>心跳检测</strong>：<code>REPLCONF ACK &lt;从服务器复制偏移量&gt;</code></p>
<ol>
<li>
<p>检测网络连接状态</p>
</li>
<li>
<p>辅助实现 min-slaves 选项</p>
<p>配置min-salves-to-write 3</p>
<p>​		min-salves-max-lag 10</p>
<p>在从服务器数量少于3 或从服务器延迟都大于10秒时，主服务器拒绝执行写命令</p>
</li>
<li>
<p>检测命令丢失</p>
<p>复制偏移量不一致，会补发缺失数据</p>
</li>
</ol>
</li>
</ol>


<h3 class="relative group">8. Sentinel 
    <div id="8-sentinel" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#8-sentinel" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>Sentinel（哨兵），一种特殊状态下的Redis服务器。是Redis的高可用性解决方案。可以监视任意多个<code>主服务器</code>及其之下的<code>从服务器</code>。<code>主服务器</code>下线时，自动将下线<code>主服务器</code>的某个<code>从服务器</code>升级为<code>主服务器</code></p>


<h4 class="relative group">8.1 启动Sentinel 
    <div id="81-%E5%90%AF%E5%8A%A8sentinel" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#81-%E5%90%AF%E5%8A%A8sentinel" aria-label="锚点">#</a>
    </span>        
    
</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">redis-sentinel /path/to/your/sentinel.conf
</span></span><span class="line"><span class="cl">或
</span></span><span class="line"><span class="cl">redis-server /path/to/your/sentinel.conf --sentinel
</span></span></code></pre></div><ol>
<li>
<p>初始化服务器</p>
<p>不会载入RDB、AOF文件。使用端口号配置名称不同、命令列表不同</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">sentinelState</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">uint64_t</span> <span class="n">current_epoch</span><span class="p">;</span>		<span class="c1">// 当前纪元，用于实现故障转移
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dict</span> <span class="o">*</span><span class="n">masters</span><span class="p">;</span>				<span class="c1">// 保存所有被监视的主服务器，key 名称 value 指向实例的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">tilt</span><span class="p">;</span>					<span class="c1">// 是否进入了TILT模式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">running_scripts</span><span class="p">;</span>		<span class="c1">// 目前在运行的脚本数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">mstime_t</span> <span class="n">tilt_start_time</span><span class="p">;</span>	<span class="c1">// 进入TILT模式的时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">mstime_t</span> <span class="n">previous_time</span><span class="p">;</span>		<span class="c1">// 最后一次执行时间处理器的时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">list</span> <span class="o">*</span><span class="n">scripts_queue</span><span class="p">;</span>		<span class="c1">// 队列，包含所有需要执行的用户脚本
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">sentinel</span><span class="p">;</span>
</span></span></code></pre></div></li>
<li>
<p>将<code>普通Redis服务器</code>使用的代码替换为Sentinel专用代码</p>
</li>
<li>
<p>初始化Sentinel状态</p>
</li>
<li>
<p>根据给定配置文件，初始化Sentinel的监视<code>主服务器</code>列表</p>
</li>
<li>
<p>创建连向主服务器的网络连接</p>
<ul>
<li>命令连接——专门用于向<code>主服务器</code>发送命令，接收命令回复</li>
<li>订阅连接——订阅<code>主服务器</code>的 <code>_sentinel_:hello</code> 频道</li>
</ul>
</li>
</ol>


<h4 class="relative group">8.2 获取主服务器信息 
    <div id="82-%E8%8E%B7%E5%8F%96%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#82-%E8%8E%B7%E5%8F%96%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p><strong>十秒</strong>发送一次INFO命令。获取信息后对实例结构更新</p>
<ul>
<li><code>主服务器</code>本身信息：服务器运行run_id（每次启动不同）、角色 role</li>
<li><code>主服务器</code>的所有从服务器信息</li>
</ul>


<h4 class="relative group">8.3 获取从服务器信息 
    <div id="83-%E8%8E%B7%E5%8F%96%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#83-%E8%8E%B7%E5%8F%96%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>发现<code>主服务器</code>有新的<code>从服务器</code>后，除了为新<code>从服务器</code>创建结构外，还会创建连接到<code>从服务器</code>的命令连接、订阅连接</p>
<p>也是<strong>十秒</strong>发送一次INFO命令</p>


<h4 class="relative group">8.4 向主服务器和从服务器发送信息 
    <div id="84-%E5%90%91%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#84-%E5%90%91%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%8F%91%E9%80%81%E4%BF%A1%E6%81%AF" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p><strong>两秒</strong>一次，向hello频道发送信息</p>


<h4 class="relative group">8.5 接收服务器的频道信息 
    <div id="85-%E6%8E%A5%E6%94%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%A2%91%E9%81%93%E4%BF%A1%E6%81%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#85-%E6%8E%A5%E6%94%B6%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%A2%91%E9%81%93%E4%BF%A1%E6%81%AF" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>所有的Sentienl都可以接收信息，接收后检查是否是Sentienl自己发送的，若是，则丢弃</p>
<p>若不是，根据数据对相应主服务器的实例结构更新。发现有新的Sentinel时，创建连向其他Sentinel的命令连接。</p>
<p>Sentienl在连接服务器时需要<code>订阅连接</code>发现其他的Sentinel，而<code>Sentinel之间</code>只需要<code>命令连接</code>通信就行了</p>


<h4 class="relative group">8.6 主观下线 
    <div id="86-%E4%B8%BB%E8%A7%82%E4%B8%8B%E7%BA%BF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#86-%E4%B8%BB%E8%A7%82%E4%B8%8B%E7%BA%BF" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p><strong>一秒一次</strong> Sentinel向所有实例（服务器和Sentinel）发送PING。</p>
<ul>
<li>有效回复：+PONG、-LOADING、-MASTERDOWN</li>
<li>无效回复：其他回复或超时（Sentinel配置文件的 <code>down-after-milliseconds</code>，每个Sentinel可以不同）</li>
</ul>
<p>若实例在超时时间内，连续向Sentinel返回无效回复，那么Sentinel会修改这个实例的结构，flags属性打开<code>SRI_S_DOWN</code>标识，标记为主观下线</p>


<h4 class="relative group">8.7 客观下线 
    <div id="87-%E5%AE%A2%E8%A7%82%E4%B8%8B%E7%BA%BF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#87-%E5%AE%A2%E8%A7%82%E4%B8%8B%E7%BA%BF" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>判定一个主服务器为主观下线后，会向其他Sentinel进行询问，当有<code>足够数量的主观下线判断</code>后，会执行故障转移操作。</p>
<p>配置 <code>sentinel monitor master 127.0.0.1 6379 2</code> 中的 2 表示主观下线超过2则为<strong>客观下线</strong>（每个Sentinel可以不同）</p>


<h4 class="relative group">8.8 选举领头Sentinel 
    <div id="88-%E9%80%89%E4%B8%BE%E9%A2%86%E5%A4%B4sentinel" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#88-%E9%80%89%E4%B8%BE%E9%A2%86%E5%A4%B4sentinel" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>客观下线后，监视这个主服务器的Sentinel会选举一个领头Sentinel进行故障转移操作。</p>
<p>主服务器下线时长超过设定的下线时长上限后，对主服务器执行<strong>故障转移操作</strong>：</p>
<ol>
<li>挑选一个<code>从服务器</code>升级</li>
<li>向所有<code>原从服务器</code>发送复制命令，让他们成为<code>新主服务器</code>的<code>从服务器</code>。所有<code>从服务器</code>都开始复制<code>新主服务器</code>时，故障转移操作执行完毕</li>
<li><code>已下线的主服务器</code>重新上线时，设置为<code>从服务器</code></li>
</ol>
<p>期间向从服务器发送<code>INFO</code>的频率改为<strong>每秒一次</strong></p>


<h3 class="relative group">9. 集群 
    <div id="9-%E9%9B%86%E7%BE%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#9-%E9%9B%86%E7%BE%A4" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>节点通过握手来将其他节点添加到自己所处的集群中</p>
<p>集群的16384个槽可以分配给集群的各个节点，每个节点都记录哪些槽指派给自己，哪些被指派给其他节点</p>
<p>节点接收到请求时，先检查要处理的键是否由自己负责</p>
<ul>
<li>不是：返回MOVED错误，指引客户端转向正在负责相关槽的节点</li>
<li>是：自己处理</li>
</ul>
<p>重新分片：将某个槽的所有键值对由一个节点转移到另一个节点</p>
<p>若节点A正在迁移槽i到节点B，当A没在自己的数据库找到命令指定键时，返回ASK错误，指引客户端到节点B继续查找</p>
<p>主从复制类似上面的非集群的主从复制</p>
<p>集群通过发送/接收消息进行通信（MEET、PING、PONG、PUBLISH、FALL）</p>


<h2 class="relative group">10. 发布与订阅 
    <div id="10-%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#10-%E5%8F%91%E5%B8%83%E4%B8%8E%E8%AE%A2%E9%98%85" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">10.1 订阅 
    <div id="101-%E8%AE%A2%E9%98%85" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#101-%E8%AE%A2%E9%98%85" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><code>SUBSCRIBE</code> 命令可以让客户端订阅一个或多个频道：每当其他客户端向频道发送消息，频道的所有订阅者都会收到</p>
<p><code>PSUBSCRIBE</code> 命令可以订阅一个或多个模式：模式会匹配频道（类似正则表达式）订阅了模式的客户端会收到匹配的频道信息</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">redisServer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dict</span> <span class="o">*</span><span class="n">pubsub_channels</span><span class="p">;</span>		<span class="c1">// 所有频道的订阅关系，key为频道名称，value指向所有客户端的链表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">list</span> <span class="o">*</span><span class="n">pubsub_patterns</span><span class="p">;</span>		<span class="c1">// 所有模式的订阅关系，指向pubsubPattern链表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>	<span class="c1">// 服务器状态
</span></span></span></code></pre></div><p>订阅频道</p>
<ul>
<li>若频道已存在，添加客户端到链表末尾</li>
<li>若不存在，为频道创建一个键，再将客户端添加到链表</li>
</ul>
<p><code>UNSUBSCRIBE</code> 退订频道</p>
<ul>
<li>查找频道对应的客户端链表，删除退订客户端信息、</li>
<li>若删除后成为空链表，则删除频道对应的键</li>
</ul>
<p>订阅模式——新建 pubsubPattern 结构，添加到链表尾</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">pubsubPattern</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">redisClient</span> <span class="o">*</span><span class="n">client</span><span class="p">;</span>		<span class="c1">// 指向客户端
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">robj</span> <span class="o">*</span><span class="n">pattern</span><span class="p">;</span>				<span class="c1">// 被订阅的模式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p><code>PUNSUBSCRIBE</code> 退订模式</p>
<p>查链表，删除目标客户端订阅的目标模式</p>


<h3 class="relative group">10.2 发送消息 
    <div id="102-%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#102-%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>客户端执行：<code>PUBLISH &lt;channel&gt; &lt;message&gt;</code>，服务器执行：</p>
<ul>
<li>将message消息发送给channel频道的所有订阅者（遍历频道键的链表）</li>
<li>若有一个或多个pattern模式与channel频道匹配，将消息发送给pattern模式的订阅者</li>
</ul>


<h3 class="relative group">10.3 查看订阅消息 
    <div id="103-%E6%9F%A5%E7%9C%8B%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#103-%E6%9F%A5%E7%9C%8B%E8%AE%A2%E9%98%85%E6%B6%88%E6%81%AF" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><code>PUBSUB CHANNELS [pattern]</code> 返回服务器当前被订阅的频道，pattern可选</p>
<p><code>PUBSUB NUMSUB [channel-1 channel-2 ...]</code> 返回频道的订阅者数量(链表长度)</p>
<p><code>PUBSUB NUMPAT</code> 返回服务器当前被订阅的模式数量</p>


<h2 class="relative group">11. 慢查询日志、监视器 
    <div id="11-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E7%9B%91%E8%A7%86%E5%99%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#11-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E7%9B%91%E8%A7%86%E5%99%A8" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h4 class="relative group">11.1 慢查询日志 
    <div id="111-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#111-%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>用于记录执行时间超过给定时长【slowlog-log-slower-than选项，指定执行时间的最长时间(单位微秒)】的命令请求</p>
<p>【slowlog-max-len选项，指定服务器最多保存多少条慢查询日志】</p>
<p><code>SLOWLOG GET</code> 查看慢查询日志</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">struct</span> <span class="n">redisServer</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">long</span> <span class="kt">long</span> <span class="n">slowlog_entry_id</span><span class="p">;</span>		<span class="c1">// 下一条慢查询日志的id，初始为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">list</span> <span class="o">*</span><span class="n">slowlog</span><span class="p">;</span>					<span class="c1">// 保存所有的慢查询日志的链表，保存slowlogEntry结构
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    								<span class="c1">// 打印和删除就是通过这个链表实现
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">long</span> <span class="kt">long</span> <span class="n">slowlog_log_slower_than</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">slowlog_max_len</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">redisClient</span> <span class="o">*</span><span class="n">monitors</span><span class="p">;</span>			<span class="c1">// 指向所有监视器	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>	<span class="c1">// 服务器状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">slowlogEntry</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">long</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>		
</span></span><span class="line"><span class="cl">    <span class="kt">time_t</span> <span class="n">time</span><span class="p">;</span>		<span class="c1">// 命令执行时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">long</span> <span class="kt">long</span> <span class="n">duration</span><span class="p">;</span>	<span class="c1">// 消耗时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">robj</span> <span class="o">**</span><span class="n">argv</span><span class="p">;</span>		<span class="c1">// 命令与命令参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">argc</span><span class="p">;</span>			<span class="c1">// 命令与命令参数的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">slowlogEntry</span><span class="p">;</span>
</span></span></code></pre></div><p>每次执行命令的前后，程序都会记录当前时间的UNIX时间戳，执行后，会检查是否需要创建新的慢查询日志</p>


<h4 class="relative group">11.2 监视器 
    <div id="112-%E7%9B%91%E8%A7%86%E5%99%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#112-%E7%9B%91%E8%A7%86%E5%99%A8" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>客户端发送 <code>MONITOR</code> 命令，可以使之成为一个监视器（添加到monitors链表尾），实时接收并打印出服务器当前处理的命令请求相关信息</p>
<p>每当客户端向服务器发送一条命令请求时，服务器都会向所有监视器发送这条命令的请求信息</p>


<h2 class="relative group">12. 事务 
    <div id="12-%E4%BA%8B%E5%8A%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#12-%E4%BA%8B%E5%8A%A1" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p><code>MULTI</code>、<code>EXEC</code>、<code>WATCH</code> 在执行MULTI之后提交一系列命令，再使用EXEC命令执行事务</p>


<h3 class="relative group">12.1 事务的实现 
    <div id="121-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#121-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><strong>开始</strong>：MULTI命令将执行该命令的客户端从非事务状态切换为事务状态，通过flags属性中打开 REDIS_MULTI 标识完成</p>
<p><strong>命令入队</strong>：若处于客户端事务状态，其发送的EXEC、DISCARD、WATCH、MULTI命令会立即执行。不是这些命令，则将命令放入事务队列。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">redisClient</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">multiState</span> <span class="n">mstate</span><span class="p">;</span>	<span class="c1">// 事务状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">redisClient</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">multiState</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">multiCmd</span> <span class="o">*</span><span class="n">commands</span><span class="p">;</span>	<span class="c1">// 事务队列
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>			<span class="c1">// 已入队命令计数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">multiState</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">multiCmd</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">robj</span> <span class="o">**</span><span class="n">argv</span><span class="p">;</span>		<span class="c1">// 参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">argc</span><span class="p">;</span>			<span class="c1">// 参数数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">struct</span> <span class="n">redisCommand</span> <span class="o">*</span><span class="n">cmd</span><span class="p">;</span>	<span class="c1">// 命令指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">multiCmd</span><span class="p">;</span>
</span></span></code></pre></div><p><strong>执行事务</strong>：EXEC命令，先判断客户端的事务安全性，若安全，服务器会遍历这个客户端的事务队列，执行队列中保存的所有命令，最后将执行命令所得的所有结果全部返回。否则拒绝执行客户端提交的事务</p>
<p><strong>WATCH</strong>：乐观锁，可以再EXEC之前，监视任意数量的数据库键，在EXEC执行时，检查被监视的键是否至少有一个已经被修改过，若是，则服务器拒绝执行事务，向客户端返回代表事务执行失败的空回复。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C" data-lang="C"><span class="line"><span class="cl"><span class="k">typedef</span> <span class="k">struct</span> <span class="n">redisDb</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">dict</span> <span class="o">*</span><span class="n">watched_keys</span><span class="p">;</span>	<span class="c1">// 正在被WARTCH命令监视的键，值是一个链表（记录所有监视相应数据的客户端）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="n">redisDb</span><span class="p">;</span>
</span></span></code></pre></div><p><strong>监视机制的触发</strong>：所有对数据库进行修改的命令，在执行后都需要对上述字典进行检查【是否有客户端正在监视的键被修改，若有，会将监视该键的客户端的REDIS_DIRTY_CAS标识打开，表示该客户端事务安全性已被破坏】</p>


<h3 class="relative group">12.2 事务的ACID性质 
    <div id="122-%E4%BA%8B%E5%8A%A1%E7%9A%84acid%E6%80%A7%E8%B4%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#122-%E4%BA%8B%E5%8A%A1%E7%9A%84acid%E6%80%A7%E8%B4%A8" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）</p>
<p><strong>原子性</strong>：事务要么整体完成，要么一个都不执行。Redis不支持事务回滚，作者认为执行的错误都是编程错误产生，很少在生产环境中。</p>
<p><strong>一致性</strong>：事务在执行前，数据库是一致的，那么在事务执行之后，无论是否执行成功，数据库也应该是一致的。<strong>一致</strong>是指数据符合数据库本身的定义和要求，没有包含非法或无效的错误数据。</p>
<p>Redis保证数据一致性：</p>
<ol>
<li>
<p>入队错误</p>
<p>一个事务在命令入队时，出现命令不存在或命令格式不对等情况时，Redis将拒绝执行这个事务</p>
</li>
<li>
<p>执行错误</p>
<p>事务在执行过程中的错误（最有可能的是对键的类型不符合指令形式的错误，如事务中包含：）</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">SET msg <span class="s2">&#34;hello&#34;</span>
</span></span><span class="line"><span class="cl">RPUSH msg <span class="s2">&#34;good bye&#34;</span> <span class="s2">&#34;bye bye&#34;</span>
</span></span></code></pre></div><p>出错的命令不会对数据库进行修改，也不会影响一致性</p>
</li>
<li>
<p>服务器停机</p>
<ul>
<li>无持久化的内存模式：重启后服务器为空，数据是一致的</li>
<li>RDB模式：服务器会根据RDB文件恢复数据，还原到一致的状态。若没有可用的RDB文件，重启后数据库是空白的。</li>
<li>AOF模式：与RDB一致</li>
</ul>
</li>
</ol>
<p><strong>隔离性</strong>：数据库中多个事务并发地执行，各个事务之间也不会互相影响，且在并发状态下执行的事务和串行状态下执行的事务产生的结果完全相同。Redis是单线程执行事务，且服务器保证在执行事务期间不会对事务进行中断。因此Redis事务总是串行的。</p>
<p><strong>持久性</strong>：当一个事务执行完毕时，执行这个事务所得的结果已经保存到永久性存储介质里了，即使服务器在事务执行后停机，事务所得的结果也不会丢失。</p>
<p>​	由Redis所使用的持久化模式决定：</p>
<ol>
<li>无持久化的内存模式：事务不具有持久性</li>
<li>RDB模式：不具备持久性</li>
<li>AOF模式，且appendsync的选项值为always【执行命令后同步】：<strong>具备持久性</strong></li>
<li>AOF模式，且appendsync的选项值为everysec【每秒同步一次】：不具备持久性</li>
<li>AOF模式，且appendsync的选项值为no【交由操作系统决定何时将命令数据同步】：不具备持久性</li>
<li>不论Redis在什么模式，在事务的最后加上<code>SAVE命令</code>可以<strong>保证事务的持久性</strong></li>
</ol>


<h2 class="relative group">13. 常见问题 
    <div id="13-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#13-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">13.1 大Key 
    <div id="131-%E5%A4%A7key" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#131-%E5%A4%A7key" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>String 类型，&gt;10kb</p>
<p>hash、list、set、zset 元素数量超过 5k/1w/.</p>
<p><strong>检测</strong>：</p>
<ul>
<li>redis-cli &ndash;bigkeys   该命令是redis自带，但是只能找出五种数据类型里最大的key。建议在从节点使用，一般不使用</li>
</ul>
<p><a href="https://help.aliyun.com/zh/redis/user-guide/identify-and-handle-large-keys-and-hotkeys" target="_blank">https://help.aliyun.com/zh/redis/user-guide/identify-and-handle-large-keys-and-hotkeys</a></p>
<p><strong>python删除</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">pip install redis
</span></span></code></pre></div><p>把所有key拿到：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">redis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pool</span><span class="o">=</span><span class="n">redis</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">host</span><span class="o">=</span><span class="s1">&#39;redis_hostname&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_connections</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="n">connection_pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cursor_number</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;count&#34;</span><span class="p">,</span> <span class="mi">200000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">cursor_number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 结束一次完整的遍历</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">cursor_number</span><span class="p">,</span> <span class="n">keys</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">execute_command</span><span class="p">(</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="n">cursor_number</span><span class="p">,</span> <span class="s2">&#34;count&#34;</span><span class="p">,</span> <span class="mi">200000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># do something with keys</span>
</span></span></code></pre></div><p>假设key保存到了文件中：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">redis</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pool</span><span class="o">=</span><span class="n">redis</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;redis_hostname&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">max_connections</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="n">connection_pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">SUCCESS_DELETED</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/data/rediskeys&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">kf</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 最多读取 1 MB 内容</span>
</span></span><span class="line"><span class="cl">        <span class="n">lines</span> <span class="o">=</span> <span class="n">kf</span><span class="o">.</span><span class="n">readlines</span><span class="p">(</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">lines</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># 获取 lines 中以 &#34;UGC:TASKKEY&#34; 开头的行，并去除每行的首尾空格和换行符</span>
</span></span><span class="line"><span class="cl">            <span class="n">taskkey_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&#34;UGC:TASKKEY&#34;</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">SUCCESS_DELETED</span> <span class="o">+=</span> <span class="n">r</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="o">*</span><span class="n">taskkey_list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="n">SUCCESS_DELETED</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">SUCCESS_DELETED</span>
</span></span></code></pre></div><p><strong>指令删除</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">redis-cli --scan --pattern <span class="s2">&#34;ops-coffee-*&#34;</span> <span class="p">|</span> xargs -L 2000 redis-cli del
</span></span></code></pre></div><p>扫描匹配以 &ldquo;ops-coffee-&rdquo; 开头的键，并将它们作为参数传递给 redis-cli del 命令来删除这些键</p>
<p>每次删除 2000 个键，直到所有匹配的键都被删除</p>


<h3 class="relative group">13.2 缓存三兄弟 
    <div id="132-%E7%BC%93%E5%AD%98%E4%B8%89%E5%85%84%E5%BC%9F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#132-%E7%BC%93%E5%AD%98%E4%B8%89%E5%85%84%E5%BC%9F" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><strong>缓存穿透</strong>：</p>
<p><strong>不断查询数据库中都没有的数据</strong>，导致每次请求都会到数据库，压垮数据库</p>
<p>解决：布隆过滤器</p>
<p>当一个元素被加入集合时，通过k个散列函数将元素映射为一个位数组中的k个点，置为1</p>
<p>检索时，若这些点有任何一个是0，则被检元素一定不存在。否则很可能存在</p>
<p><strong>缓存击穿</strong>：</p>
<p>一个<strong>热点key在失效</strong>的同时，大量的请求过来，从而会全部到达数据库，压垮数据库</p>
<ul>
<li>设置热点数据永不过期</li>
<li>定时更新热点key过期时间</li>
<li>互斥锁、<strong>分布式锁</strong>：在请求MySQL数据库时上互斥锁，将获取的数据缓存后释放锁</li>
</ul>
<p><strong>缓存雪崩</strong>：</p>
<p>缓存的数据<strong>大面积同时失效</strong>，或者Redis宕机，从而会导致大量请求直接到数据库，压垮数据库</p>
<ul>
<li>设置有效期时增加随机值</li>
<li>数据预热：对于即将来临的大量请求，将数据提前缓存在Redis中，并设置不同的过期时间</li>
</ul>


<h3 class="relative group">14. 分布式锁 
    <div id="14-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#14-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>分布式锁的作用：</p>
<p>在分布式环境下，服务被部署多台，为了使每台服务的进程、线程使用共同的锁，我们把锁放在第三方存储（比如redis、Memcache、数据库），这样每台服务器都可以访问到，确保同一个资源同一时刻只有一个进程、线程能够访问到。</p>
<p>分布式锁的要求：</p>
<ul>
<li>分布式锁的加锁和释放锁的过程设计多个操作，需要保证这些锁操作的原子性</li>
<li>分布式锁是被存储在redis或数据库等第三方内，如果第三方发生了故障，那服务在请求的时候就无法进行锁操作了，在实现分布式锁时，需考虑第三方的可靠性</li>
</ul>
<p>分布式锁设计考虑的点：</p>
<ul>
<li>互斥性：在分布式系统环境下，分布式锁应该保证一个资源或一个方法在同一时间只能被一个线程、进程操作</li>
<li>具备锁失效机制来防止死锁，即使进程或线程长时间持有锁而没有释放，也能保证后续其他线程、进程可以获得锁</li>
<li>可重入性，进程未释放锁时，可多次访问临界资源</li>
</ul>
<p>目前流行的分布式锁实现：</p>
<ol>
<li>基于数据库实现分布式锁</li>
</ol>
<ul>
<li>原理
<blockquote>
<p>创建一张锁表，然后通过操作该表中的数据实现
当要锁住某个资源时，就在该表添加一条记录，释放锁时删除该记录。数据库对共享资源做唯一性约束，如果有多个请求被同时提交到数据库，数据库也会保证只有一个请求可以成功</p>
</blockquote>
</li>
<li>使用场景
<blockquote>
<p>因为数据库需要落在硬盘上，频繁读取数据库会导致IO开销大，因此这种分布式适合于并发量低，对性能要求低的场景</p>
</blockquote>
</li>
<li>缺点
<blockquote>
<p>单点故障，一旦数据库不可用，整个分布式锁将无法提供锁能力
死锁，数据库锁没有失效时间，未获得锁的进程只能一直等待已获得锁的线程主动释放锁，如果已获得锁的进程挂掉或解锁失败，会导致锁记录一直存在数据库中，其他进程无法获得锁</p>
</blockquote>
</li>
</ul>
<ol start="2">
<li>基于redis（单个redis节点）实现分布式锁</li>
</ol>
<ul>
<li>原理
<blockquote>
<p>使用键值对来保存锁变量，根据键值来进行加锁和释放锁操作</p>
</blockquote>
</li>
<li>加锁与释放锁命令
<ul>
<li>加锁命令：setnx key value
<blockquote>
<p>Redis通常可以使用setnx来实现分布式锁，key和value就是基于缓存的分布式锁的两个属性，其中key表示锁id，value表示当前时间再加上锁的有效时间，即使某个进程获得锁后没有主动释放锁，超过有效时间也会释放锁
redis通过队列来维持进程访问共享资源的先后顺序，reids锁主要基于setnx函数实现分布式锁，当进程通过setnx函数返回1时表示已经获得锁，排在后面的进程只能等待前面的进程主动释放锁或者等到时间超时才能获得锁</p>
</blockquote>
</li>
<li>释放锁：del key</li>
<li>setnx函数的返回值有0和1
<blockquote>
<p>返回1表示获取锁成功，setnx将key对应的value设置为当前时间加锁的有效时间
返回0表示其他进程或线程已获得了锁，进程不能进入临界区，该进程或线程可不断尝试setnx操作以获得锁</p>
</blockquote>
</li>
<li>使用Lua脚本改进加锁和释放锁
<blockquote>
<p>加锁：set lock_key unique_value NX PX 10000
释放锁：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-lua" data-lang="lua"><span class="line"><span class="cl"><span class="o">//</span> <span class="err">释放锁</span> <span class="err">比较</span><span class="n">unique_value是否相等</span><span class="err">，避免误释放</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="err">表示</span><span class="n">lock_key</span><span class="err">，</span><span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="err">是当前客户端的唯一标识</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="err">在执行</span><span class="n">Lua脚本时作为参数传入</span>
</span></span><span class="line"><span class="cl"><span class="kr">if</span> <span class="n">redis.call</span><span class="p">(</span><span class="s2">&#34;get&#34;</span><span class="p">,</span> <span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="kr">then</span>
</span></span><span class="line"><span class="cl">    <span class="kr">return</span> <span class="n">redis.call</span><span class="p">(</span><span class="s2">&#34;del&#34;</span><span class="p">,</span><span class="n">KEYS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="kr">else</span>
</span></span><span class="line"><span class="cl">    <span class="kr">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="kr">end</span>
</span></span></code></pre></div></li>
</ul>
</li>
<li>风险
<ol>
<li>需要给锁加上有效时间，这样防止死锁发生</li>
<li>需要区分不同线程或进程的操作，防止a线程的锁被b线程释放掉。设置一个唯一标识，只有当前所变量值和自己唯一标识相等才能释放锁</li>
</ol>
</li>
<li>优势
<ol>
<li>性能较好，数据被存放在内存中，也避免了频繁的IO操作</li>
<li>可以设置有效时间来控制锁的释放</li>
<li>可以跨集群部署，防止单点故障</li>
</ol>
</li>
<li>缺点
<ol>
<li>有些进程或线程本身业务需要时间可能很长，通过设置有效时间并不能准确把握时间</li>
</ol>
</li>
</ul>
<ol start="3">
<li>基于redis（多个redis节点）实现高可靠分布式锁</li>
</ol>
<ul>
<li>使用分布式锁算法 Redlock</li>
<li>基本思路
<ol>
<li>让客户端和多个独立的redis实例一次请求加锁，如果客户端和半数以上的实例成功的完成加锁操作，就认为客户端成功地获得了分布式锁，否则加锁失败</li>
<li>假设有N个独立的redis实例，Redlock 算法的加锁/释放锁步骤
<ol>
<li>客户端获取当前时间</li>
<li>客户端按顺序依次向N个redis实例执行加锁操作
<ol>
<li>和单实例上执行加锁操作一样，使用SET命令带上NX，EX/PX选项，以及带上客户端的唯一标识</li>
<li>如果客户端在和一个redis实例请求加锁时一直超时没有成功，那么该客户端会和下一个redis实例继续请求加锁。注意，加锁操作的超时时间需要远远小于锁的有效时间，一般设几十毫秒</li>
</ol>
</li>
<li>一旦客户端完成了和所有redis实例的加锁操作，客户端就要计算整个加锁过程的总耗时
1. 客户端只有在满足以下两个条件时才认为加锁成功
2. 客户端从超半数的redis实例上成功获取到了锁
3. 客户端获取锁的总耗时没有超过锁的有效时间</li>
<li>满足以上两个条件后重新计算锁的有效时间，计算的结果是锁的最初有效时间减去客户端为获取锁的总耗时，如果锁的有效时间已经来不及完成共享数据的操作，可以释放锁，以免出现还没有完成数据操作，锁就过期的情况</li>
<li>如果2、3没有满足，那么客户端向所有redis节点发起释放锁的操作，释放锁的操作和在单实例上释放锁的操作一样，只要执行释放锁的Lua脚本即可</li>
</ol>
</li>
</ol>
</li>
</ul>

        </div>
        
        

        
        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://TCmatj.github.io/docs/redis/redis/&amp;title=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title="分享到 LinkedIn"
      aria-label="分享到 LinkedIn"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=https://TCmatj.github.io/docs/redis/redis/&amp;text=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title="分享到 Twitter"
      aria-label="分享到 Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://bsky.app/intent/compose?text=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86&#43;https://TCmatj.github.io/docs/redis/redis/"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,232.562c-21.183,-41.196 -78.868,-117.97 -132.503,-155.834c-51.378,-36.272 -70.978,-29.987 -83.828,-24.181c-14.872,6.72 -17.577,29.554 -17.577,42.988c0,13.433 7.365,110.138 12.169,126.281c15.873,53.336 72.376,71.358 124.413,65.574c2.66,-0.395 5.357,-0.759 8.089,-1.097c-2.68,0.429 -5.379,0.796 -8.089,1.097c-76.259,11.294 -143.984,39.085 -55.158,137.972c97.708,101.165 133.908,-21.692 152.484,-83.983c18.576,62.291 39.972,180.718 150.734,83.983c83.174,-83.983 22.851,-126.674 -53.408,-137.969c-2.71,-0.302 -5.409,-0.667 -8.089,-1.096c2.732,0.337 5.429,0.702 8.089,1.096c52.037,5.785 108.54,-12.239 124.413,-65.574c4.804,-16.142 12.169,-112.847 12.169,-126.281c-0,-13.434 -2.705,-36.267 -17.577,-42.988c-12.85,-5.806 -32.45,-12.09 -83.829,24.181c-53.634,37.864 -111.319,114.635 -132.502,155.831Z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://reddit.com/submit/?url=https://TCmatj.github.io/docs/redis/redis/&amp;resubmit=true&amp;title=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title="提交到 Reddit"
      aria-label="提交到 Reddit"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://api.whatsapp.com/send?text=https://TCmatj.github.io/docs/redis/redis/&amp;resubmit=true&amp;title=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://t.me/share/url?url=https://TCmatj.github.io/docs/redis/redis/&amp;resubmit=true&amp;title=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://pinterest.com/pin/create/bookmarklet/?url=https://TCmatj.github.io/docs/redis/redis/&amp;description=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title="钉到 Pinterest"
      aria-label="钉到 Pinterest"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.facebook.com/sharer/sharer.php?u=https://TCmatj.github.io/docs/redis/redis/&amp;quote=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title="分享到 Facebook"
      aria-label="分享到 Facebook"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=https://TCmatj.github.io/docs/redis/redis/&amp;subject=Redis%e5%85%a5%e9%97%a8%e4%b8%8e%e5%8e%9f%e7%90%86"
      title="通过电子邮件发送"
      aria-label="通过电子邮件发送"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_docs\/Redis\/Redis\/index.md"
        var oid_likes = "likes_docs\/Redis\/Redis\/index.md"
      </script>
      
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/docs/redis/redis%E4%BD%BF%E7%94%A8/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Redis使用</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/docs/python/python/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Python入门</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="返回顶部" title="返回顶部">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="">
            
            标签
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      TCmatj
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> 强力驱动
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
  <a rel="me" href="https://masto.ai/@blowfish"></a>
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://TCmatj.github.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="搜索"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="关闭 (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
  data-id="nunocoracao" data-description="Support me on Buy me a coffee!" data-message=""
  data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

</html>
