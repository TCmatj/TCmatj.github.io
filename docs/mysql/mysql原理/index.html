<!DOCTYPE html>
<html lang="zh-cn" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-cn" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>MySQL原理 &middot; TCmatj的个人博客</title>
  <meta name="title" content="MySQL原理 &middot; TCmatj的个人博客" />
  
  <meta name="description" content="浙江理工大学" />
  
  
  
  <link rel="canonical" href="https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/" />
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/css/main.bundle.min.85f006de1806b55b2d082d1122deedd8cec6fdc1f7c8a51be975a4496165d6c798f4a3de52545a6a87cc4bc09fc2d6f5201d44ea57acc1ac2b1c42a688c62bee.css"
    integrity="sha512-hfAG3hgGtVstCC0RIt7t2M7G/cH3yKUb6XWkSWFl1seY9KPeUlRaaofMS8Cfwtb1IB1E6leswawrHEKmiMYr7g==" />
  
  
  <script type="text/javascript" src="/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.f5c7687e2a3365a5a366307858918deafa574ab869c626f69dcdd5363e26a725991d0efa1aaaff7ba4b7e2472876189d153d2f9b46a39206caf364407e2aaa77.js"
    integrity="sha512-9cdofiozZaWjZjB4WJGN6vpXSrhpxib2nc3VNj4mpyWZHQ76Gqr/e6S34kcodhidFT0vm0ajkgbK82RAfiqqdw==" data-copy="" data-copied=""></script>
  
  
  <script src="/js/zoom.min.js"></script>
  
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
  <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:url" content="https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/">
  <meta property="og:site_name" content="TCmatj的个人博客">
  <meta property="og:title" content="MySQL原理">
  <meta property="og:description" content="1. 索引 # 1.1 索引选择 # 1.1.1 哈希 # 使用哈希算法实现的索引虽然可以做">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="og:image" content="https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/featured.png">

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/featured.png">
  <meta name="twitter:title" content="MySQL原理">
  <meta name="twitter:description" content="1. 索引 # 1.1 索引选择 # 1.1.1 哈希 # 使用哈希算法实现的索引虽然可以做">

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Docs",
    "name": "MySQL原理",
    "headline": "MySQL原理",
    
    "abstract": "1. 索引 # 1.1 索引选择 # 1.1.1 哈希 # 使用哈希算法实现的索引虽然可以做",
    "inLanguage": "zh-cn",
    "url" : "https:\/\/TCmatj.github.io\/docs\/mysql\/mysql%E5%8E%9F%E7%90%86\/",
    "author" : {
      "@type": "Person",
      "name": "TCmatj"
    },
    
    
    
    
    
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "16129"
  }]
  </script>


  
  
  <meta name="author" content="TCmatj" />
  
  
  
  <link href="https://github.com/TCmatj" rel="me" />
  
  
  
  

<script src="/lib/jquery/jquery.slim.min.js" integrity=""></script>





















  
  

<script async src="https://www.googletagmanager.com/gtag/js?id=G-PEDMYR1V0K"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-PEDMYR1V0K');
</script>


  
  
  <meta name="theme-color"/>
  
  
  
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script>

    const firebaseConfig = {
      apiKey: "AIzaSyDe2xnkus6Wsn0D2GU6RKbkRX9exAYhwio",
      authDomain: "AIzaSyDe2xnkus6Wsn0D2GU6RKbkRX9exAYhwio",
      projectId: "blog-53c93",
      storageBucket: "blog-53c93.appspot.com",
      messagingSenderId: "688956731234",
      appId: "1:688956731234:web:3eae3e633a453e1b17063b",
      measurementId: "G-ZXHSY9W6LL"
    };

    var app = firebase.initializeApp(firebaseConfig);
    var db = firebase.firestore();
    var auth = firebase.auth();

  </script>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32 scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>跳过正文</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/" class="flex">
            <span class="sr-only">TCmatj的个人博客</span>

            <img src="/img/blowfish_logo_transparent.png" width="1000" height="1000"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="TCmatj的个人博客" />

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            
            <a href="/" class="text-base font-medium text-gray-500 hover:text-gray-900">TCmatj的个人博客</a>
            

        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      Java
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/java/java%E5%9F%BA%E7%A1%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Java基础
          </p>
        </a>
        
        <a href="/docs/java/jvm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            JVM
          </p>
        </a>
        
        <a href="/docs/java/juc/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            JUC
          </p>
        </a>
        
        <a href="/docs/java/stream%E6%B5%81%E4%B8%8Eio%E6%B5%81/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Stream流与IO流
          </p>
        </a>
        
        <a href="/docs/java/springboot/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            SpringBoot
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      Python
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/python/python/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Python入门
          </p>
        </a>
        
        <a href="/docs/python/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            机器学习
          </p>
        </a>
        
        <a href="/docs/python/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            深度学习
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      MySQL
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/mysql/mysql%E8%AF%AD%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            MySQL语法
          </p>
        </a>
        
        <a href="/docs/mysql/mysql%E5%8E%9F%E7%90%86/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            MySQL原理
          </p>
        </a>
        
        <a href="/docs/mysql/mybatis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            MyBatis
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      Redis
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/redis/redis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Redis入门与原理
          </p>
        </a>
        
        <a href="/docs/redis/lua/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Lua脚本
          </p>
        </a>
        
        <a href="/docs/redis/redis%E4%BD%BF%E7%94%A8/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Redis使用
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      工具
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/linux/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Linux
          </p>
        </a>
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/docker/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Docker
          </p>
        </a>
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/maven/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Maven
          </p>
        </a>
        
        <a href="/docs/%E5%B7%A5%E5%85%B7/git/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            Git
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title="">
      其他
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E7%8A%B6%E6%80%81%E6%9C%BA/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            状态机
          </p>
        </a>
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E7%AE%97%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            算法
          </p>
        </a>
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            网络
          </p>
        </a>
        
        <a href="/docs/%E5%85%B6%E4%BB%96/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
          
          <p class="text-sm font-sm" title="">
            设计模式
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
            
  <a href="https://github.com/TCmatj"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
    
    <span >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


    </span>
    
    <p class="text-base font-medium" title="">
        
    </p>
</a>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 flex items-center">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400">
                    <div class="flex items-center justify-center dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12 h-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" class="text-base hover:text-primary-600 dark:hover:text-primary-400" style="margin-right:5px">
                <div class="flex items-center justify-center dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li>
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Java
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/java%E5%9F%BA%E7%A1%80/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Java基础
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/jvm/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            JVM
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/juc/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            JUC
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/stream%E6%B5%81%E4%B8%8Eio%E6%B5%81/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Stream流与IO流
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/java/springboot/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            SpringBoot
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Python
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/python/python/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Python入门
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/python/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            机器学习
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/python/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            深度学习
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            MySQL
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/mysql/mysql%E8%AF%AD%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            MySQL语法
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/mysql/mysql%E5%8E%9F%E7%90%86/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            MySQL原理
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/mysql/mybatis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            MyBatis
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            Redis
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/redis/redis/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Redis入门与原理
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/redis/lua/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Lua脚本
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/redis/redis%E4%BD%BF%E7%94%A8/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Redis使用
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            工具
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/linux/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Linux
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/docker/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Docker
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/maven/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Maven
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%B7%A5%E5%85%B7/git/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            Git
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                     
  <li class="mt-1">
    <a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-bg font-bg" title="">
            其他
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E7%8A%B6%E6%80%81%E6%9C%BA/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            状态机
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E7%AE%97%E6%B3%95/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            算法
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E7%BD%91%E7%BB%9C/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            网络
        </p>
    </a>
</li>

<li class="mt-1">
    <a href="/docs/%E5%85%B6%E4%BB%96/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <p class="text-sm font-small" title="">
            设计模式
        </p>
    </a>
</li>

<li class="mb-2"></li>




                    

                    
  <li class="mt-1">
    <a href="https://github.com/TCmatj"  target="_blank"  class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400">
        
        <div >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


        </div>
        
        <p class="text-bg font-bg" title="">
            
        </p>
    </a>
</li>




                    

                </ul>
                
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>



    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/docs/mysql/mysql%E5%8E%9F%E7%90%86/featured_hu05c2784adc2d0587a084521c4afece5a_182163_1200x0_resize_box_3.png);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden">
  
  
    
  
    
  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/"
      >欢迎来到 Blowfish! :tada:</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline ">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/docs/"
      >Docs</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

  
  <li class="inline hidden">
    <a
      class="hover:underline decoration-neutral-300 dark:underline-neutral-600"
      href="/docs/mysql/mysql%E5%8E%9F%E7%90%86/"
      >MySQL原理</a
    ><span class="px-1 text-primary-500">/</span>
  </li>

</ol>


    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      MySQL原理
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      





  
  







  





  



  



  



  



  





  



<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time><span class="px-2 text-primary-500">&middot;</span><span>16129 字</span><span class="px-2 text-primary-500">&middot;</span><span title="预计阅读">33 分钟</span><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span id="views_docs/MySQL/MySQL原理/index.md" class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400" title="views">loading</span>
  <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
<path fill="currentColor" d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg>
  </span>

</span>
</span><span class="px-2 text-primary-500">&middot;</span><span>
  
  
    
    
      
      
        
        
      
      
    
  
  <span id="likes_docs/MySQL/MySQL原理/index.md"
    class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400"
    title="likes">loading</span>
  <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
  </span>

</span>
</span><span class="px-2 text-primary-500">&middot;</span><span>
    <button id="button_likes"
        class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
        onclick="process_article()">
        <span id="button_likes_heart" style="display:none" class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"/></svg>
  </span>

 </span>
        <span id="button_likes_emtpty_heart" class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
<path fill="currentColor" d="M244 84L255.1 96L267.1 84.02C300.6 51.37 347 36.51 392.6 44.1C461.5 55.58 512 115.2 512 185.1V190.9C512 232.4 494.8 272.1 464.4 300.4L283.7 469.1C276.2 476.1 266.3 480 256 480C245.7 480 235.8 476.1 228.3 469.1L47.59 300.4C17.23 272.1 0 232.4 0 190.9V185.1C0 115.2 50.52 55.58 119.4 44.1C164.1 36.51 211.4 51.37 244 84C243.1 84 244 84.01 244 84L244 84zM255.1 163.9L210.1 117.1C188.4 96.28 157.6 86.4 127.3 91.44C81.55 99.07 48 138.7 48 185.1V190.9C48 219.1 59.71 246.1 80.34 265.3L256 429.3L431.7 265.3C452.3 246.1 464 219.1 464 190.9V185.1C464 138.7 430.4 99.07 384.7 91.44C354.4 86.4 323.6 96.28 301.9 117.1L255.1 163.9z"/></svg>
  </span>

</span>
        <span id="button_likes_text">&nbsp;Like</span>
    </button>
</span><span class="px-2 text-primary-500">&middot;</span>


<script type="text/javascript" src="/js/zen-mode.min.63c8a202661f4a2063fdc2706685d668e8ea3da613da2224e9da527e5876e4f53dcac39ab60732626fb4151feae5d430d0cf44731e5d3c726522fcc1519c1547.js" integrity="sha512-Y8iiAmYfSiBj/cJwZoXWaOjqPaYT2iIk6dpSflh25PU9ysOatgcyYm&#43;0FR/q5dQw0M9Ecx5dPHJlIvzBUZwVRw=="></script>

<span class="mb-[2px]">
    <span id="zen-mode-button"
          class="text-lg hover:text-primary-500"
          title=""
          data-title-i18n-disable=""
          data-title-i18n-enable="">
        <span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50px" height="50px">
    <path fill="currentColor" d="M 12.980469 4 C 9.1204688 4 5.9804688 7.14 5.9804688 11 L 6 26 L 9.9804688 26 L 9.9804688 11 C 9.9804688 9.35 11.320469 8 12.980469 8 L 40.019531 8 C 41.679531 8 43.019531 9.35 43.019531 11 L 43.019531 39 C 43.019531 40.65 41.679531 42 40.019531 42 L 29 42 C 29 43.54 28.420938 44.94 27.460938 46 L 40.019531 46 C 43.879531 46 47.019531 42.86 47.019531 39 L 47.019531 11 C 47.019531 7.14 43.879531 4 40.019531 4 L 12.980469 4 z M 7 28 C 4.794 28 3 29.794 3 32 L 3 42 C 3 44.206 4.794 46 7 46 L 23 46 C 25.206 46 27 44.206 27 42 L 27 32 C 27 29.794 25.206 28 23 28 L 7 28 z M 7 32 L 23 32 L 23.001953 42 L 7 42 L 7 32 z"/>
</svg>
  </span>

</span>
    </span>
</span>
  

  
  
</div>


<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
</div>




<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  
  
  
  
  
  
  
</div>



    </div>

    
    
    
    
    

    

    
      
      
        
        
<div class="flex author">
  
    
    
      
    
    
      
        
      
      <img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width="96" height="96"
      alt="TCmatj" src="/img/blowfish_logo_hu184ea2fa12490a2458ca388a16ab730e_227816_192x192_fill_box_center_3.png" />
    
  
  <div class="place-self-center">
    
    <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
      作者
    </div>
    <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
      TCmatj
    </div>
    
    
    <div class="text-sm text-neutral-700 dark:text-neutral-400">浙江理工大学</div>
    
    <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/TCmatj"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
  </div>

</div>
  </div>
</div>

      

      

      
      <div class="mb-5"></div>
      

    

  </header>
  
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
    
     <div
      class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]">

         <details open id="TOCView"
  class="toc-right mt-0 overflow-y-scroll overscroll-contain scrollbar-thin scrollbar-track-neutral-200 scrollbar-thumb-neutral-400 dark:scrollbar-track-neutral-800 dark:scrollbar-thumb-neutral-600 rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-索引">1. 索引</a>
      <ul>
        <li><a href="#11-索引选择">1.1 索引选择</a>
          <ul>
            <li><a href="#111-哈希">1.1.1 哈希</a></li>
            <li><a href="#112-二叉查找树">1.1.2 二叉查找树</a></li>
            <li><a href="#113-红黑树">1.1.3 红黑树</a></li>
            <li><a href="#114-avl树">1.1.4 AVL树</a></li>
            <li><a href="#115-b树">1.1.5 B树</a></li>
            <li><a href="#116-b树">1.1.6 B+树</a></li>
          </ul>
        </li>
        <li><a href="#12-innodb与myisam实现">1.2 InnoDB与Myisam实现</a></li>
        <li><a href="#13-索引失效">1.3 索引失效</a>
          <ul>
            <li><a href="#131-隐式类型转换造成索引失效">1.3.1 隐式类型转换造成索引失效</a></li>
            <li><a href="#132-模糊查询只有左前缀使用索引">1.3.2 模糊查询只有左前缀使用索引</a></li>
            <li><a href="#133-反向条件不走索引-----not-inis-not-null">1.3.3 反向条件不走索引 <code>!=</code> 、 <code>&lt;&gt;</code> 、 <code>NOT IN</code>、<code>IS NOT NULL</code></a></li>
            <li><a href="#134-对条件计算使用函数或者算数表达式不走索引">1.3.4 对条件计算(使用函数或者算数表达式)不走索引</a></li>
            <li><a href="#135-or-只有两边都有索引才走索引">1.3.5 <code>or</code> 只有两边都有索引才走索引</a></li>
            <li><a href="#136-若不是按最左列开始查找无法使用索引">1.3.6 若不是按最左列开始查找，无法使用索引</a></li>
            <li><a href="#137-跳过索引的某列则只能使用之前的索引列">1.3.7 跳过索引的某列，则只能使用之前的索引列</a></li>
            <li><a href="#138-某列有范围查找则之后的列无法使用索引查找">1.3.8 某列有范围查找，则之后的列无法使用索引查找</a></li>
          </ul>
        </li>
        <li><a href="#14-索引适用">1.4 索引适用</a>
          <ul>
            <li><a href="#141-全键值键值范围键前缀查找">1.4.1 全键值、键值范围、键前缀查找</a></li>
            <li><a href="#142-匹配最左前缀只使用索引的第一列">1.4.2 匹配最左前缀（只使用索引的第一列）</a></li>
            <li><a href="#143-匹配列前缀匹配某列的开头部分也只使用索引的第一列">1.4.3 匹配列前缀（匹配某列的开头部分，也只使用索引的第一列）</a></li>
          </ul>
        </li>
        <li><a href="#15-高性能索引">1.5 高性能索引</a>
          <ul>
            <li><a href="#151-前缀索引索引选择选">1.5.1 前缀索引、索引选择选</a></li>
            <li><a href="#152-多列索引">1.5.2 多列索引</a></li>
            <li><a href="#153-聚簇索引">1.5.3 聚簇索引</a></li>
            <li><a href="#154-覆盖索引">1.5.4 覆盖索引</a></li>
            <li><a href="#155-索引扫描排序">1.5.5 索引扫描排序</a></li>
            <li><a href="#156-冗余索引">1.5.6 冗余索引</a></li>
            <li><a href="#157-重复索引未使用的索引建议删除">1.5.7 重复索引、未使用的索引——建议删除</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#2-日志">2. 日志</a>
      <ul>
        <li><a href="#21-redo-log">2.1 redo log</a></li>
        <li><a href="#22-binlog">2.2 binlog</a></li>
        <li><a href="#23-两阶段提交">2.3 两阶段提交</a></li>
        <li><a href="#24-undo-log">2.4 undo log</a></li>
      </ul>
    </li>
    <li><a href="#3-多版本并发控制mvcc">3. 多版本并发控制（MVCC）</a>
      <ul>
        <li><a href="#31-隐藏字段undo-log">3.1 隐藏字段、undo log</a></li>
        <li><a href="#32-readview">3.2 ReadView</a></li>
        <li><a href="#33-数据可见性">3.3 数据可见性</a></li>
        <li><a href="#34-mvcc只能在读取已提交和可重复读两个级别使用">3.4 MVCC只能在<code>读取已提交</code>和<code>可重复读</code>两个级别使用</a></li>
        <li><a href="#35-mvccnext-key-lock-防止幻读">3.5 MVCC➕Next-key-lock 防止幻读</a></li>
      </ul>
    </li>
    <li><a href="#4-事务隔离级别">4. 事务隔离级别</a></li>
    <li><a href="#tips">tips</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#1-内存数据对象">1. 内存数据对象</a></li>
        <li><a href="#2-checkpoint-技术">2. Checkpoint 技术</a></li>
        <li><a href="#3-主线程工作">3. 主线程工作</a></li>
        <li><a href="#4关键特性">4.关键特性</a>
          <ul>
            <li><a href="#41-插入缓冲">4.1 插入缓冲</a></li>
            <li><a href="#42-修改缓冲">4.2 修改缓冲</a></li>
            <li><a href="#43-双写">4.3 双写</a></li>
            <li><a href="#44-自适应哈希索引">4.4 自适应哈希索引</a></li>
            <li><a href="#45-异步io">4.5 异步IO</a></li>
            <li><a href="#46-刷新临接页">4.6 刷新临接页</a></li>
          </ul>
        </li>
        <li><a href="#5-启动关闭和恢复">5. 启动、关闭和恢复</a></li>
        <li><a href="#6-表">6. 表</a>
          <ul>
            <li><a href="#61-逻辑存储结构">6.1 逻辑存储结构</a></li>
            <li><a href="#62-行记录格式">6.2 行记录格式</a></li>
            <li><a href="#63-数据页结构">6.3 数据页结构</a></li>
            <li><a href="#64-约束">6.4 约束</a></li>
          </ul>
        </li>
        <li><a href="#7-索引">7. 索引</a>
          <ul>
            <li><a href="#71-mrr优化-56开始">7.1 MRR优化 5.6开始</a></li>
            <li><a href="#72-icp优化-56开始">7.2 ICP优化 5.6开始</a></li>
            <li><a href="#73-全文检索">7.3 全文检索</a></li>
          </ul>
        </li>
        <li><a href="#8-锁">8. 锁</a>
          <ul>
            <li><a href="#81-一致性非锁定读">8.1 一致性非锁定读</a></li>
            <li><a href="#82-一致性锁定读">8.2 一致性锁定读</a></li>
            <li><a href="#83-自增与锁">8.3 自增与锁</a></li>
            <li><a href="#84-锁算法">8.4 锁算法</a></li>
            <li><a href="#85-阻塞">8.5 阻塞</a></li>
            <li><a href="#86-死锁">8.6 死锁</a></li>
            <li><a href="#87-锁升级没有锁升级">8.7 锁升级「没有锁升级」</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>
<details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    目录
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-索引">1. 索引</a>
      <ul>
        <li><a href="#11-索引选择">1.1 索引选择</a>
          <ul>
            <li><a href="#111-哈希">1.1.1 哈希</a></li>
            <li><a href="#112-二叉查找树">1.1.2 二叉查找树</a></li>
            <li><a href="#113-红黑树">1.1.3 红黑树</a></li>
            <li><a href="#114-avl树">1.1.4 AVL树</a></li>
            <li><a href="#115-b树">1.1.5 B树</a></li>
            <li><a href="#116-b树">1.1.6 B+树</a></li>
          </ul>
        </li>
        <li><a href="#12-innodb与myisam实现">1.2 InnoDB与Myisam实现</a></li>
        <li><a href="#13-索引失效">1.3 索引失效</a>
          <ul>
            <li><a href="#131-隐式类型转换造成索引失效">1.3.1 隐式类型转换造成索引失效</a></li>
            <li><a href="#132-模糊查询只有左前缀使用索引">1.3.2 模糊查询只有左前缀使用索引</a></li>
            <li><a href="#133-反向条件不走索引-----not-inis-not-null">1.3.3 反向条件不走索引 <code>!=</code> 、 <code>&lt;&gt;</code> 、 <code>NOT IN</code>、<code>IS NOT NULL</code></a></li>
            <li><a href="#134-对条件计算使用函数或者算数表达式不走索引">1.3.4 对条件计算(使用函数或者算数表达式)不走索引</a></li>
            <li><a href="#135-or-只有两边都有索引才走索引">1.3.5 <code>or</code> 只有两边都有索引才走索引</a></li>
            <li><a href="#136-若不是按最左列开始查找无法使用索引">1.3.6 若不是按最左列开始查找，无法使用索引</a></li>
            <li><a href="#137-跳过索引的某列则只能使用之前的索引列">1.3.7 跳过索引的某列，则只能使用之前的索引列</a></li>
            <li><a href="#138-某列有范围查找则之后的列无法使用索引查找">1.3.8 某列有范围查找，则之后的列无法使用索引查找</a></li>
          </ul>
        </li>
        <li><a href="#14-索引适用">1.4 索引适用</a>
          <ul>
            <li><a href="#141-全键值键值范围键前缀查找">1.4.1 全键值、键值范围、键前缀查找</a></li>
            <li><a href="#142-匹配最左前缀只使用索引的第一列">1.4.2 匹配最左前缀（只使用索引的第一列）</a></li>
            <li><a href="#143-匹配列前缀匹配某列的开头部分也只使用索引的第一列">1.4.3 匹配列前缀（匹配某列的开头部分，也只使用索引的第一列）</a></li>
          </ul>
        </li>
        <li><a href="#15-高性能索引">1.5 高性能索引</a>
          <ul>
            <li><a href="#151-前缀索引索引选择选">1.5.1 前缀索引、索引选择选</a></li>
            <li><a href="#152-多列索引">1.5.2 多列索引</a></li>
            <li><a href="#153-聚簇索引">1.5.3 聚簇索引</a></li>
            <li><a href="#154-覆盖索引">1.5.4 覆盖索引</a></li>
            <li><a href="#155-索引扫描排序">1.5.5 索引扫描排序</a></li>
            <li><a href="#156-冗余索引">1.5.6 冗余索引</a></li>
            <li><a href="#157-重复索引未使用的索引建议删除">1.5.7 重复索引、未使用的索引——建议删除</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#2-日志">2. 日志</a>
      <ul>
        <li><a href="#21-redo-log">2.1 redo log</a></li>
        <li><a href="#22-binlog">2.2 binlog</a></li>
        <li><a href="#23-两阶段提交">2.3 两阶段提交</a></li>
        <li><a href="#24-undo-log">2.4 undo log</a></li>
      </ul>
    </li>
    <li><a href="#3-多版本并发控制mvcc">3. 多版本并发控制（MVCC）</a>
      <ul>
        <li><a href="#31-隐藏字段undo-log">3.1 隐藏字段、undo log</a></li>
        <li><a href="#32-readview">3.2 ReadView</a></li>
        <li><a href="#33-数据可见性">3.3 数据可见性</a></li>
        <li><a href="#34-mvcc只能在读取已提交和可重复读两个级别使用">3.4 MVCC只能在<code>读取已提交</code>和<code>可重复读</code>两个级别使用</a></li>
        <li><a href="#35-mvccnext-key-lock-防止幻读">3.5 MVCC➕Next-key-lock 防止幻读</a></li>
      </ul>
    </li>
    <li><a href="#4-事务隔离级别">4. 事务隔离级别</a></li>
    <li><a href="#tips">tips</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#1-内存数据对象">1. 内存数据对象</a></li>
        <li><a href="#2-checkpoint-技术">2. Checkpoint 技术</a></li>
        <li><a href="#3-主线程工作">3. 主线程工作</a></li>
        <li><a href="#4关键特性">4.关键特性</a>
          <ul>
            <li><a href="#41-插入缓冲">4.1 插入缓冲</a></li>
            <li><a href="#42-修改缓冲">4.2 修改缓冲</a></li>
            <li><a href="#43-双写">4.3 双写</a></li>
            <li><a href="#44-自适应哈希索引">4.4 自适应哈希索引</a></li>
            <li><a href="#45-异步io">4.5 异步IO</a></li>
            <li><a href="#46-刷新临接页">4.6 刷新临接页</a></li>
          </ul>
        </li>
        <li><a href="#5-启动关闭和恢复">5. 启动、关闭和恢复</a></li>
        <li><a href="#6-表">6. 表</a>
          <ul>
            <li><a href="#61-逻辑存储结构">6.1 逻辑存储结构</a></li>
            <li><a href="#62-行记录格式">6.2 行记录格式</a></li>
            <li><a href="#63-数据页结构">6.3 数据页结构</a></li>
            <li><a href="#64-约束">6.4 约束</a></li>
          </ul>
        </li>
        <li><a href="#7-索引">7. 索引</a>
          <ul>
            <li><a href="#71-mrr优化-56开始">7.1 MRR优化 5.6开始</a></li>
            <li><a href="#72-icp优化-56开始">7.2 ICP优化 5.6开始</a></li>
            <li><a href="#73-全文检索">7.3 全文检索</a></li>
          </ul>
        </li>
        <li><a href="#8-锁">8. 锁</a>
          <ul>
            <li><a href="#81-一致性非锁定读">8.1 一致性非锁定读</a></li>
            <li><a href="#82-一致性锁定读">8.2 一致性锁定读</a></li>
            <li><a href="#83-自增与锁">8.3 自增与锁</a></li>
            <li><a href="#84-锁算法">8.4 锁算法</a></li>
            <li><a href="#85-阻塞">8.5 阻塞</a></li>
            <li><a href="#86-死锁">8.6 死锁</a></li>
            <li><a href="#87-锁升级没有锁升级">8.7 锁升级「没有锁升级」</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</details>

<script>

  var margin = 200;
  var marginError = 50;

  (function () {
    var $window = $(window);
    var $toc = $('#TOCView');
    var tocHeight = $toc.height();

    function onResize() {
      var windowAndMarginHeight = $window.height() - margin;
      if(tocHeight >= windowAndMarginHeight) {
        $toc.css("overflow-y", "scroll")
        $toc.css("max-height", (windowAndMarginHeight + marginError) + "px")
      } else {
        $toc.css("overflow-y", "hidden")
        $toc.css("max-height", "9999999px")
      }
    }

    $window.on('resize', onResize);
    $(document).ready(onResize);
  })();



  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = decodeURIComponent(e.attr('id'));
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
          
            $(e).removeClass('active');
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
        
        onScroll();
      });
    }
  })();


</script>
   </div>
      </div>
      

      <div class="min-w-0 min-h-0 max-w-fit">
        
        


        <div class="article-content max-w-prose mb-20">
          

<h2 class="relative group">1. 索引 
    <div id="1-%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#1-%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">1.1 索引选择 
    <div id="11-%E7%B4%A2%E5%BC%95%E9%80%89%E6%8B%A9" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#11-%E7%B4%A2%E5%BC%95%E9%80%89%E6%8B%A9" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">1.1.1 哈希 
    <div id="111-%E5%93%88%E5%B8%8C" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#111-%E5%93%88%E5%B8%8C" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>使用哈希算法实现的索引虽然可以做到快速检索数据，但是没办法做数据高效范围查找，因此哈希索引是不适合作为 Mysql 的底层索引的数据结构。</p>


<h4 class="relative group">1.1.2 二叉查找树 
    <div id="112-%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#112-%E4%BA%8C%E5%8F%89%E6%9F%A5%E6%89%BE%E6%A0%91" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>普通的二叉查找树可以提供范围查找，但有个致命缺点：极端情况下会退化为线性链表，二分查找也会退化为遍历查找，时间复杂退化为 O（N），检索性能急剧下降。在数据库中，数据的自增是一个很常见的形式，如果采取二叉树这种数据结构作为索引，那上面介绍到的不平衡状态导致的线性查找的问题必然出现。</p>


<h4 class="relative group">1.1.3 红黑树 
    <div id="113-%E7%BA%A2%E9%BB%91%E6%A0%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#113-%E7%BA%A2%E9%BB%91%E6%A0%91" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>红黑树拥有不错的平均查找效率，也不存在极端的 O(n)情况，那红黑树作为 Mysql 底层索引实现是否可以呢？当数据是顺序插入时，树的形态一直处于“右倾”的趋势。从根本上上看，红黑树并没有完全解决二叉查找树虽然这个“右倾”趋势远没有二叉查找树退化为线性链表那么夸张</p>


<h4 class="relative group">1.1.4 AVL树 
    <div id="114-avl%E6%A0%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#114-avl%E6%A0%91" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>优点：</p>
<ol>
<li>不错的查找性能（O（logn）），不存在极端的低效查找的情况。</li>
<li>可以实现范围查找、数据排序</li>
</ol>
<p>数据库查询数据的瓶颈在于<strong>磁盘 IO</strong>，如果使用的是 AVL 树，每一个树节点<strong>只存储了一个数据</strong>，一次磁盘 IO 只能取出来一个节点上的数据加载到内存里。所以设计数据库索引时需要首先考虑怎么<strong>尽可能减少磁盘 IO</strong> 的次数。</p>


<h4 class="relative group">1.1.5 B树 
    <div id="115-b%E6%A0%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#115-b%E6%A0%91" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySql-1_huc2fb6374eee90cf8ae10c940364e9ee9_95650_330x0_resize_box_3.png 330w,
        /img/MySql-1_huc2fb6374eee90cf8ae10c940364e9ee9_95650_660x0_resize_box_3.png 660w,
        /img/MySql-1_huc2fb6374eee90cf8ae10c940364e9ee9_95650_1024x0_resize_box_3.png 1024w,
        /img/MySql-1_huc2fb6374eee90cf8ae10c940364e9ee9_95650_1320x0_resize_box_3.png 2x"
        src="/img/MySql-1_huc2fb6374eee90cf8ae10c940364e9ee9_95650_660x0_resize_box_3.png"
        alt=""
      />
      
    </figure>
</p>
<p>优点：</p>
<ol>
<li>优秀检索速度，时间复杂度：B 树的查找性能等于 O（h*logn），其中 h 为树高，n 为每个节点关键词的个数；</li>
<li>尽可能少的磁盘 IO，加快了检索速度；</li>
<li>可以支持范围查找。</li>
</ol>


<h4 class="relative group">1.1.6 B+树 
    <div id="116-b%E6%A0%91" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#116-b%E6%A0%91" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySql-2_hub85eb7325415ea6f651d99aa75025006_70275_330x0_resize_box_3.png 330w,
        /img/MySql-2_hub85eb7325415ea6f651d99aa75025006_70275_660x0_resize_box_3.png 660w,
        /img/MySql-2_hub85eb7325415ea6f651d99aa75025006_70275_1024x0_resize_box_3.png 1024w,
        /img/MySql-2_hub85eb7325415ea6f651d99aa75025006_70275_1320x0_resize_box_3.png 2x"
        src="/img/MySql-2_hub85eb7325415ea6f651d99aa75025006_70275_660x0_resize_box_3.png"
        alt=""
      />
      
    </figure>
</p>
<p>不同：</p>
<p>第一，B 树一个节点里存的是数据，而 B+树存储的是索引（地址），所以 B 树里一个节点存不了很多个数据，但是 B+树一个节点能存很多索引，B+树叶子节点存所有的数据。</p>
<p>第二，B+树的叶子节点使用一个链表串联起来，便于范围查找。</p>
<p>在 MySQL 中 B+ 树的一个节点大小为“<strong>1页</strong>”，也就是<strong>16k</strong>。之所以设置为一页，是因为对于大部分业务，一页就足够了：
首先InnoDB的B+树中，非叶子节点存的是key + 指针；叶子节点存的是数据行。
对于叶子节点，如果一行数据大小为1k，那么一页就能存16条数据；对于非叶子节点，如果key使用的是bigint，则为8字节，指针在mysql中为6字节，一共是14字节，则16k能存放 16 * 1024 / 14 = 1170 个索引指针。于是可以算出，对于一颗<strong>高度为2的B+树</strong>，根节点存储索引指针节点，那么它有1170个叶子节点存储数据，每个叶子节点可以存储16条数据，一共 1170 x 16 = <strong>18720 条数据</strong>。而对于<strong>高度为3的B+树</strong>，就可以存放 1170 x 1170 x 16 = <strong>21902400 条数据（两千多万条数据）</strong>，也就是对于两千多万条的数据，我们只需要高度为3的B+树就可以完成，通过主键查询只需要3次IO操作就能查到对应数据。所以在 InnoDB 中B+树高度一般为3层时，就能满足千万级的数据存储，所以一个节点为1页，也就是16k是比较合理的。</p>


<h3 class="relative group">1.2 InnoDB与Myisam实现 
    <div id="12-innodb%E4%B8%8Emyisam%E5%AE%9E%E7%8E%B0" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#12-innodb%E4%B8%8Emyisam%E5%AE%9E%E7%8E%B0" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>Innodb 创建表后生成的文件有：</p>
<ul>
<li>frm:创建表的语句</li>
<li>idb:表里面的数据+索引文件</li>
</ul>
<p>Myisam 创建表后生成的文件有</p>
<ul>
<li>frm:创建表的语句</li>
<li>MYD:表里面的数据文件（myisam data）</li>
<li>MYI:表里面的索引文件（myisam index）</li>
</ul>
<p>MyISAM 引擎把数据和索引分开了，一人一个文件，这叫做<strong>非聚集索引</strong>方式；</p>
<p>MyISAM 在建表时以主键作为 KEY 来建立主索引 B+树，树的叶子节点存的是对应数据的物理地址:</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySql-3_hu0e023034ca8dc2643f5d5df8bf1ba6de_494189_330x0_resize_box_3.png 330w,
        /img/MySql-3_hu0e023034ca8dc2643f5d5df8bf1ba6de_494189_660x0_resize_box_3.png 660w,
        /img/MySql-3_hu0e023034ca8dc2643f5d5df8bf1ba6de_494189_1024x0_resize_box_3.png 1024w,
        /img/MySql-3_hu0e023034ca8dc2643f5d5df8bf1ba6de_494189_1320x0_resize_box_3.png 2x"
        src="/img/MySql-3_hu0e023034ca8dc2643f5d5df8bf1ba6de_494189_660x0_resize_box_3.png"
        alt=""
      />
      
    </figure>
</p>
<p>Innodb 引擎把<strong>数据和索引放在同一个文件</strong>里了，这叫做<strong>聚集索引</strong>方式。</p>
<p>首先 InnoDB 会<strong>根据主键 ID 作为 KEY 建立索引 B+树</strong>，如左下图所示，而 B+树的叶子节点存储的是主键 ID 对应的数据，比如在执行 <code>select * from user_info where id=15</code> 这个语句时，InnoDB 就会查询这颗主键 ID 索引 B+树，找到对应的 <code>user_name='Bob'</code>。</p>
<p>为表里某个字段加索引时 InnoDB 会怎么建立索引树？比如要给 <code>user_name</code> 这个字段加索引，那么 InnoDB 就会建立 <code>user_name 索引 B+树</code>，节点里存的是 <code>user_name</code> 这个 KEY，叶子节点存储的数据的是<strong>主键 KEY</strong>。注意，叶子存储的是**主键 KEY！**拿到主键 KEY 后，InnoDB 才会去主键索引树里根据刚在 <code>user_name</code> 索引树找到的主键 KEY 查找到对应的数据。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySql-4_huf274397401d5a257c607a6aa9aa6465d_440504_330x0_resize_box_3.png 330w,
        /img/MySql-4_huf274397401d5a257c607a6aa9aa6465d_440504_660x0_resize_box_3.png 660w,
        /img/MySql-4_huf274397401d5a257c607a6aa9aa6465d_440504_1024x0_resize_box_3.png 1024w,
        /img/MySql-4_huf274397401d5a257c607a6aa9aa6465d_440504_1320x0_resize_box_3.png 2x"
        src="/img/MySql-4_huf274397401d5a257c607a6aa9aa6465d_440504_660x0_resize_box_3.png"
        alt=""
      />
      
    </figure>
</p>


<h3 class="relative group">1.3 索引失效 
    <div id="13-%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#13-%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">1.3.1 隐式类型转换造成索引失效 
    <div id="131-%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E9%80%A0%E6%88%90%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#131-%E9%9A%90%E5%BC%8F%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E9%80%A0%E6%88%90%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>当操作符<strong>左右两边的数据类型不一致</strong>时，会发生<strong>隐式转换</strong>。</p>
<p>当 where 查询操作符<strong>左边为数值类型</strong>时发生了隐式转换，那么对效率影响不大，但还是不推荐这么做。</p>
<p>当 where 查询操作符<strong>左边为字符类型</strong>时发生了隐式转换，那么会导致索引失效，造成全表扫描效率极低。</p>
<p>字符串转换为数值类型时，非数字开头的字符串会转化为<code>0</code>，以数字开头的字符串会截取从第一个字符到第一个非数字内容为止的值为转化结果。</p>


<h4 class="relative group">1.3.2 模糊查询只有左前缀使用索引 
    <div id="132-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E5%8F%AA%E6%9C%89%E5%B7%A6%E5%89%8D%E7%BC%80%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#132-%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2%E5%8F%AA%E6%9C%89%E5%B7%A6%E5%89%8D%E7%BC%80%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">1.3.3 反向条件不走索引 <code>!=</code> 、 <code>&lt;&gt;</code> 、 <code>NOT IN</code>、<code>IS NOT NULL</code> 
    <div id="133-%E5%8F%8D%E5%90%91%E6%9D%A1%E4%BB%B6%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95-----not-inis-not-null" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#133-%E5%8F%8D%E5%90%91%E6%9D%A1%E4%BB%B6%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95-----not-inis-not-null" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">1.3.4 对条件计算(使用函数或者算数表达式)不走索引 
    <div id="134-%E5%AF%B9%E6%9D%A1%E4%BB%B6%E8%AE%A1%E7%AE%97%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E6%88%96%E8%80%85%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#134-%E5%AF%B9%E6%9D%A1%E4%BB%B6%E8%AE%A1%E7%AE%97%E4%BD%BF%E7%94%A8%E5%87%BD%E6%95%B0%E6%88%96%E8%80%85%E7%AE%97%E6%95%B0%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%8D%E8%B5%B0%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>使用函数计算不走索引，无论是对字段使用了函数还是值使用了函数都不走索引，解决办法通过应用程序计算好，将计算的结果传递给sql，而不是让数据库去计算</p>


<h4 class="relative group">1.3.5 <code>or</code> 只有两边都有索引才走索引 
    <div id="135-or-%E5%8F%AA%E6%9C%89%E4%B8%A4%E8%BE%B9%E9%83%BD%E6%9C%89%E7%B4%A2%E5%BC%95%E6%89%8D%E8%B5%B0%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#135-or-%E5%8F%AA%E6%9C%89%E4%B8%A4%E8%BE%B9%E9%83%BD%E6%9C%89%E7%B4%A2%E5%BC%95%E6%89%8D%E8%B5%B0%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">1.3.6 若不是按最左列开始查找，无法使用索引 
    <div id="136-%E8%8B%A5%E4%B8%8D%E6%98%AF%E6%8C%89%E6%9C%80%E5%B7%A6%E5%88%97%E5%BC%80%E5%A7%8B%E6%9F%A5%E6%89%BE%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#136-%E8%8B%A5%E4%B8%8D%E6%98%AF%E6%8C%89%E6%9C%80%E5%B7%A6%E5%88%97%E5%BC%80%E5%A7%8B%E6%9F%A5%E6%89%BE%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">1.3.7 跳过索引的某列，则只能使用之前的索引列 
    <div id="137-%E8%B7%B3%E8%BF%87%E7%B4%A2%E5%BC%95%E7%9A%84%E6%9F%90%E5%88%97%E5%88%99%E5%8F%AA%E8%83%BD%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%89%8D%E7%9A%84%E7%B4%A2%E5%BC%95%E5%88%97" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#137-%E8%B7%B3%E8%BF%87%E7%B4%A2%E5%BC%95%E7%9A%84%E6%9F%90%E5%88%97%E5%88%99%E5%8F%AA%E8%83%BD%E4%BD%BF%E7%94%A8%E4%B9%8B%E5%89%8D%E7%9A%84%E7%B4%A2%E5%BC%95%E5%88%97" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">1.3.8 某列有范围查找，则之后的列无法使用索引查找 
    <div id="138-%E6%9F%90%E5%88%97%E6%9C%89%E8%8C%83%E5%9B%B4%E6%9F%A5%E6%89%BE%E5%88%99%E4%B9%8B%E5%90%8E%E7%9A%84%E5%88%97%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E6%9F%A5%E6%89%BE" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#138-%E6%9F%90%E5%88%97%E6%9C%89%E8%8C%83%E5%9B%B4%E6%9F%A5%E6%89%BE%E5%88%99%E4%B9%8B%E5%90%8E%E7%9A%84%E5%88%97%E6%97%A0%E6%B3%95%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E6%9F%A5%E6%89%BE" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h3 class="relative group">1.4 索引适用 
    <div id="14-%E7%B4%A2%E5%BC%95%E9%80%82%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#14-%E7%B4%A2%E5%BC%95%E9%80%82%E7%94%A8" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">1.4.1 全键值、键值范围、键前缀查找 
    <div id="141-%E5%85%A8%E9%94%AE%E5%80%BC%E9%94%AE%E5%80%BC%E8%8C%83%E5%9B%B4%E9%94%AE%E5%89%8D%E7%BC%80%E6%9F%A5%E6%89%BE" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#141-%E5%85%A8%E9%94%AE%E5%80%BC%E9%94%AE%E5%80%BC%E8%8C%83%E5%9B%B4%E9%94%AE%E5%89%8D%E7%BC%80%E6%9F%A5%E6%89%BE" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">1.4.2 匹配最左前缀（只使用索引的第一列） 
    <div id="142-%E5%8C%B9%E9%85%8D%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E5%8F%AA%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E7%9A%84%E7%AC%AC%E4%B8%80%E5%88%97" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#142-%E5%8C%B9%E9%85%8D%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E5%8F%AA%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E7%9A%84%E7%AC%AC%E4%B8%80%E5%88%97" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h4 class="relative group">1.4.3 匹配列前缀（匹配某列的开头部分，也只使用索引的第一列） 
    <div id="143-%E5%8C%B9%E9%85%8D%E5%88%97%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D%E6%9F%90%E5%88%97%E7%9A%84%E5%BC%80%E5%A4%B4%E9%83%A8%E5%88%86%E4%B9%9F%E5%8F%AA%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E7%9A%84%E7%AC%AC%E4%B8%80%E5%88%97" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#143-%E5%8C%B9%E9%85%8D%E5%88%97%E5%89%8D%E7%BC%80%E5%8C%B9%E9%85%8D%E6%9F%90%E5%88%97%E7%9A%84%E5%BC%80%E5%A4%B4%E9%83%A8%E5%88%86%E4%B9%9F%E5%8F%AA%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E7%9A%84%E7%AC%AC%E4%B8%80%E5%88%97" aria-label="锚点">#</a>
    </span>        
    
</h4>


<h3 class="relative group">1.5 高性能索引 
    <div id="15-%E9%AB%98%E6%80%A7%E8%83%BD%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#15-%E9%AB%98%E6%80%A7%E8%83%BD%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">1.5.1 前缀索引、索引选择选 
    <div id="151-%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E7%B4%A2%E5%BC%95%E9%80%89%E6%8B%A9%E9%80%89" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#151-%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95%E7%B4%A2%E5%BC%95%E9%80%89%E6%8B%A9%E9%80%89" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p><strong>前缀索引</strong>只使用字段的前一部分字符进行索引——以求节省空间，但会降低选择选
$$
索引选择选 = \frac{不重复的索引值}{记录总数}
$$
选择性高的索引可以过滤掉更多的行，<strong>唯一索引的选择性 = 1性能最好</strong></p>
<p>计算合适的前缀数目：</p>
<ol>
<li>
<p>计算完整列的选择性	<code>SELECT COUNT(DISTINCT city)/COUNT(*) FROM table</code></p>
</li>
<li>
<p>计算不同前缀长度的选择性</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> 	</span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sel3</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">))</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sel4</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">))</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sel5</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">))</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sel6</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">LEFT</span><span class="p">(</span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">))</span><span class="o">/</span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sel7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">FROM</span><span class="w"> </span><span class="k">table</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>找出选择性提升不大的前缀长度作为前缀索引长度</p>
</li>
<li>
<p>添加前缀索引  <code>ALTER TABLE table ADD KEY(city(7))</code></p>
</li>
</ol>


<h4 class="relative group">1.5.2 多列索引 
    <div id="152-%E5%A4%9A%E5%88%97%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#152-%E5%A4%9A%E5%88%97%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>为每列创建单独的索引：OR、AND的查询会使用 <code>索引合并</code> 策略【<code>EXPLAIN</code> 后在 Extra 可以看到 Using Union】。</p>
<ul>
<li>有时效果不错，但更多时候效果糟糕</li>
<li>通常需要在算法的缓存、排序和合并操作耗费大量CPU和内存资源。且<strong>不会计算到 <code>查询成本cost</code> 中</strong>，使得<strong>查询成本被低估</strong>，导致执行计划可能还不如直接全表扫描</li>
</ul>
<p>为多列创建索引：</p>
<ul>
<li><strong>将选择性高的放到索引最前列</strong></li>
</ul>


<h4 class="relative group">1.5.3 聚簇索引 
    <div id="153-%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#153-%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>
<ul>
<li>
<p>相互关联的数据保存在一起</p>
</li>
<li>
<p>数据访问较之非聚簇索引快，因为索引和数据保存在一个B+树中</p>
</li>
<li>
<p>使用主键查询可以做到<strong>覆盖查询</strong></p>
</li>
<li>
<p><strong>插入速度严重依赖于插入顺序，若不是顺序插入会导致插入时间长、占空间大（页分裂和碎片导致）</strong></p>
<p>尽可能按主键顺序插入数据，尽可能按单调递增的聚簇键顺序插入</p>
</li>
<li>
<p>更新代价高</p>
</li>
<li>
<p>插入数据时可能导致页分裂</p>
</li>
<li>
<p>二级索引访问需要<strong>两次索引查找</strong>，一次查找主键，第二次使用主键查找数据</p>
</li>
</ul>


<h4 class="relative group">1.5.4 覆盖索引 
    <div id="154-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#154-%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>一个索引包含所有需要查询的字段的值【<code>EXPLAIN</code> 后在 Extra 可以看到 Using index】</p>
<ul>
<li>索引条目远小于数据行大小，极大减少数据访问量</li>
<li>对IO密集的范围查找快</li>
</ul>
<p>若有<code>索引 A, B 主键 ID</code> 则需要查询 <code>A, B, ID</code> 时就可以完成索引覆盖</p>


<h4 class="relative group">1.5.5 索引扫描排序 
    <div id="155-%E7%B4%A2%E5%BC%95%E6%89%AB%E6%8F%8F%E6%8E%92%E5%BA%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#155-%E7%B4%A2%E5%BC%95%E6%89%AB%E6%8F%8F%E6%8E%92%E5%BA%8F" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>MySQL两种生成有序的结果：排序操作、按索引扫描【<code>EXPLAIN</code> 后在 <strong>type</strong> 可以看到 index】</p>
<p>当索引顺序和 <code>ORDER BY</code> 子句顺序一致，且列的<strong>排序方向一致</strong>（都倒序或正序）时，使用索引对结果排序</p>
<p>联接多表查询，只有 <code>ORDER BY</code> 子句引用的字段全部在第一张表中，才能使用索引排序。</p>
<p><code>ORDER BY</code> 也需要满足索引的<strong>最左前缀要求</strong>。特殊情况：</p>
<ul>
<li>前导列是常量（不能是范围查询）</li>
</ul>


<h4 class="relative group">1.5.6 冗余索引 
    <div id="156-%E5%86%97%E4%BD%99%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#156-%E5%86%97%E4%BD%99%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>一个索引是另一个索引的前缀索引。如对于索引(A, B)，索引(A) 就是冗余的。索引(A, ID) 也是冗余的，主键已经包含在二级索引中</p>
<p>大多数情况下应尽量扩展已有的索引而不是新建索引。优化最简单的方法就是让索引能覆盖查询。</p>


<h4 class="relative group">1.5.7 重复索引、未使用的索引——建议删除 
    <div id="157-%E9%87%8D%E5%A4%8D%E7%B4%A2%E5%BC%95%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B4%A2%E5%BC%95%E5%BB%BA%E8%AE%AE%E5%88%A0%E9%99%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#157-%E9%87%8D%E5%A4%8D%E7%B4%A2%E5%BC%95%E6%9C%AA%E4%BD%BF%E7%94%A8%E7%9A%84%E7%B4%A2%E5%BC%95%E5%BB%BA%E8%AE%AE%E5%88%A0%E9%99%A4" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>重复定义的索引，如给主键加上唯一约束、普通索引等，不会报错，但么必要</p>
<p>未使用的索引——如只用于限制不重名的唯一索引</p>


<h2 class="relative group">2. 日志 
    <div id="2-%E6%97%A5%E5%BF%97" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#2-%E6%97%A5%E5%BF%97" aria-label="锚点">#</a>
    </span>        
    
</h2>


<h3 class="relative group">2.1 redo log 
    <div id="21-redo-log" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#21-redo-log" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><code>InnoDB</code>存储引擎独有的，它让<code>MySQL</code>拥有了崩溃恢复能力。比如 <code>MySQL</code> 实例挂了或宕机了，重启时，<code>InnoDB</code>存储引擎会使用<code>redo log</code>恢复数据，保证数据的持久性与完整性。</p>
<p>硬盘上存储的 <code>redo log</code> 日志文件不只一个，而是以一个<strong>日志文件组</strong>的形式出现的，每个的<code>redo</code>日志文件大小都是一样的。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySql-5_hu12a615081272ea8a8f282cbdc2f48a13_20208_330x0_resize_box_3.png 330w,
        /img/MySql-5_hu12a615081272ea8a8f282cbdc2f48a13_20208_660x0_resize_box_3.png 660w,
        /img/MySql-5_hu12a615081272ea8a8f282cbdc2f48a13_20208_1024x0_resize_box_3.png 1024w,
        /img/MySql-5_hu12a615081272ea8a8f282cbdc2f48a13_20208_1320x0_resize_box_3.png 2x"
        src="/img/MySql-5_hu12a615081272ea8a8f282cbdc2f48a13_20208_660x0_resize_box_3.png"
        alt=""
      />
      
    </figure>
</p>
<p>InnoDB 将 redo log 刷到磁盘上有几种情况：</p>
<ol>
<li>事务提交：当事务提交时，log buffer 里的 redo log 会被刷新到磁盘（可以通过<code>innodb_flush_log_at_trx_commit</code>参数控制）</li>
<li>log buffer 空间不足时：log buffer 中缓存的 redo log 已经占满了 log buffer 总容量的大约一半左右，就把这些日志刷新到磁盘上</li>
<li>事务日志缓冲区满：InnoDB 使用一个事务日志缓冲区（transaction log buffer）来暂时存储事务的重做日志条目。当缓冲区满时，会触发日志的刷新，将日志写入磁盘</li>
<li>Checkpoint（检查点）：InnoDB 定期会执行检查点操作，将内存中的脏数据（已修改但尚未写入磁盘的数据）刷新到磁盘，并且会将相应的重做日志一同刷新，以确保数据的一致性</li>
<li><strong>后台刷新线程</strong>：InnoDB 启动了一个后台线程，负责周期性（<strong>每隔 1 秒</strong>）地<strong>将脏页刷新到磁盘</strong>，并将相关的<strong>重做日志一同刷新</strong></li>
<li>正常关闭服务器：MySQL 关闭的时候，redo log 都会刷入到磁盘里去</li>
</ol>
<p><code>innodb_flush_log_at_trx_commit</code> 的值有 3 种，也就是共有 3 种刷盘策略：</p>
<ul>
<li><strong>0</strong>：设置为 0 的时候，表示每次事务提交时不进行刷盘操作。这种方式性能最高，但是也最不安全，因为如果 MySQL 挂了或宕机了，可能会丢失最近 1 秒内的事务</li>
<li><strong>1</strong>：<strong>默认值</strong>，表示每次事务提交时都将进行刷盘操作。这种方式性能最低，但是也最安全，因为只要事务提交成功，redo log 记录就一定在磁盘里，不会有任何数据丢失</li>
<li><strong>2</strong>：设置为 2 的时候，表示每次事务提交时都只把 log buffer 里的 redo log 内容写入 page cache（文件系统缓存）。page cache 是专门用来缓存文件的，这里被缓存的文件就是 redo log 文件。这种方式的性能和安全性都介于前两者中间</li>
</ul>


<h3 class="relative group">2.2 binlog 
    <div id="22-binlog" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#22-binlog" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><code>binlog</code> 是逻辑日志，记录内容是语句的原始逻辑，类似于“给 ID=2 这一行的 c 字段加 1”，属于<code>MySQL Server</code> 层。不管用什么存储引擎，只要发生了表数据更新，都会产生 <code>binlog</code> 日志</p>
<p><strong>数据备份、主备、主主、主从</strong>都离不开<code>binlog</code>，需要依靠<code>binlog</code>来同步数据，保证数据一致性</p>
<p><code>binlog</code> 日志有三种格式，可以通过<code>binlog_format</code>参数指定。</p>
<ul>
<li>
<p><strong>statement</strong></p>
<p>记录的内容是<code>SQL</code>语句原文。同步数据时，会执行记录的<code>SQL</code>语句，但是有个问题，<code>update_time=now()</code>这里会获取当前系统时间，直接执行会导致与原库的数据不一致</p>
</li>
<li>
<p><strong>row</strong></p>
<p>不再是简单的<code>SQL</code>语句了，还包含操作的具体数据。通常情况下都是指定为<code>row</code>，这样可以为数据库的恢复与同步带来更好的可靠性</p>
</li>
<li>
<p><strong>mixed</strong></p>
<p>内容是前两者的混合。<code>MySQL</code>会判断这条<code>SQL</code>语句是否可能引起数据不一致，如果是，就用<code>row</code>格式，否则就用<code>statement</code>格式</p>
</li>
</ul>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySql-6_hude145548ba2872be2af883b6268bc10d_31179_330x0_resize_box_3.png 330w,
        /img/MySql-6_hude145548ba2872be2af883b6268bc10d_31179_660x0_resize_box_3.png 660w,
        /img/MySql-6_hude145548ba2872be2af883b6268bc10d_31179_1024x0_resize_box_3.png 1024w,
        /img/MySql-6_hude145548ba2872be2af883b6268bc10d_31179_1320x0_resize_box_3.png 2x"
        src="/img/MySql-6_hude145548ba2872be2af883b6268bc10d_31179_660x0_resize_box_3.png"
        alt=""
      />
      
    </figure>
</p>


<h3 class="relative group">2.3 两阶段提交 
    <div id="23-%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#23-%E4%B8%A4%E9%98%B6%E6%AE%B5%E6%8F%90%E4%BA%A4" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>为了解决两份日志之间的逻辑一致问题，<code>InnoDB</code>存储引擎使用<strong>两阶段提交</strong>方案。</p>
<p>原理很简单，将<code>redo log</code>的写入拆成了两个步骤<code>prepare</code>和<code>commit</code>，这就是<strong>两阶段提交</strong>。</p>
<p>
    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySql-7_hu21b29472040db26b497c0c3abac91e50_123062_330x0_resize_box_3.png 330w,
        /img/MySql-7_hu21b29472040db26b497c0c3abac91e50_123062_660x0_resize_box_3.png 660w,
        /img/MySql-7_hu21b29472040db26b497c0c3abac91e50_123062_1024x0_resize_box_3.png 1024w,
        /img/MySql-7_hu21b29472040db26b497c0c3abac91e50_123062_1320x0_resize_box_3.png 2x"
        src="/img/MySql-7_hu21b29472040db26b497c0c3abac91e50_123062_660x0_resize_box_3.png"
        alt=""
      />
      
    </figure>
</p>
<p>写入<code>binlog</code>时发生异常也不会有影响，因为<code>MySQL</code>根据<code>redo log</code>日志恢复数据时，发现<code>redo log</code>还处于<code>prepare</code>阶段，并且没有对应<code>binlog</code>日志，就会回滚该事务。</p>
<p><code>redo log</code>设置<code>commit</code>阶段发生异常，虽然<code>redo log</code>是处于<code>prepare</code>阶段，但是能通过事务<code>id</code>找到对应的<code>binlog</code>日志，所以<code>MySQL</code>认为是完整的，就会提交事务恢复数据。</p>
<p>例子：</p>
<blockquote>
<p>假设当前ID=2的行，字段c的值是0，再假设执行update语句过程中在写完第一个日志后，第二个日志还没有写完期间发生了crash，会出现什么情况呢？</p>
</blockquote>
<blockquote>
<p>先写redo log后写binlog。假设在redo log写完，binlog还没有写完的时候，MySQL进程异常重启。由于我们前面说过的，redo log写完之后，系统即使崩溃，仍然能够把数据恢复回来，所以恢复后这一行c的值是1。
但是由于binlog没写完就crash了，这时候binlog里面就没有记录这个语句。因此，之后备份日志的时候，存起来的binlog里面就没有这条语句。
然后你会发现，如果需要用这个binlog来恢复临时库的话，由于这个语句的binlog丢失，这个临时库就会少了这一次更新，恢复出来的这一行c的值就是0，与原库的值不同。</p>
</blockquote>
<blockquote>
<p>先写binlog后写redo log。如果在binlog写完之后crash，由于redo log还没写，崩溃恢复以后这个事务无效，所以这一行c的值是0。但是binlog里面已经记录了“把c从0改成1”这个日志。所以，在之后用binlog来恢复的时候就多了一个事务出来，恢复出来的这一行c的值就是1，与原库的值不同。</p>
</blockquote>


<h3 class="relative group">2.4 undo log 
    <div id="24-undo-log" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#24-undo-log" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>要保证事务的原子性，就需要在异常发生时，对已经执行的操作进行<strong>回滚</strong>，在 MySQL 中，恢复机制是通过 <strong>回滚日志（undo log）</strong> 实现的，所有事务进行的修改都会先记录到这个回滚日志中，然后再执行相关的操作。如果执行过程中遇到异常的话，我们直接利用 <strong>回滚日志</strong> 中的信息将数据回滚到修改之前的样子即可！并且，<strong>回滚日志会先于数据持久化到磁盘上</strong>。这样就保证了即使遇到数据库突然宕机等情况，当用户再次启动数据库的时候，数据库还能够通过查询回滚日志来回滚将之前未完成的事务。</p>
<p>另外，<code>MVCC</code> 的实现依赖于：<strong>隐藏字段、Read View、undo log</strong>。在内部实现中，<code>InnoDB</code> 通过数据行的 <code>DB_TRX_ID</code> 和 <code>Read View</code> 来判断数据的可见性，如不可见，则通过数据行的 <code>DB_ROLL_PTR</code> 找到 <code>undo log</code> 中的历史版本。每个事务读到的数据版本可能是不一样的，在同一个事务中，用户只能看到该事务创建 <code>Read View</code> 之前已经提交的修改和该事务本身做的修改</p>


<h2 class="relative group">3. 多版本并发控制（MVCC） 
    <div id="3-%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6mvcc" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#3-%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6mvcc" aria-label="锚点">#</a>
    </span>        
    
</h2>
<p>MVCC 是一种并发控制机制，用于在多个并发事务同时读写数据库时保持数据的一致性和隔离性。它是通过在每个数据行上维护多个版本的数据来实现的。当一个事务要对数据库中的数据进行修改时，MVCC 会为该事务创建一个数据快照，而不是直接修改实际的数据行。</p>
<p>1、读操作（SELECT）：</p>
<p>当一个事务执行读操作时，它会使用快照读取。快照读取是基于事务开始时数据库中的状态创建的，因此事务不会读取其他事务尚未提交的修改。具体工作情况如下：</p>
<ul>
<li>对于读取操作，事务会查找符合条件的数据行，并选择符合其事务开始时间的数据版本进行读取。</li>
<li>如果某个数据行有多个版本，事务会选择不晚于其开始时间的最新版本，确保事务只读取在它开始之前已经存在的数据。</li>
<li>事务读取的是快照数据，因此其他并发事务对数据行的修改不会影响当前事务的读取操作。</li>
</ul>
<p>2、写操作（INSERT、UPDATE、DELETE）：</p>
<p>当一个事务执行写操作时，它会生成一个新的数据版本，并将修改后的数据写入数据库。具体工作情况如下：</p>
<ul>
<li>对于写操作，事务会为要修改的数据行创建一个新的版本，并将修改后的数据写入新版本。</li>
<li>新版本的数据会带有当前事务的版本号，以便其他事务能够正确读取相应版本的数据。</li>
<li>原始版本的数据仍然存在，供其他事务使用快照读取，这保证了其他事务不受当前事务的写操作影响。</li>
</ul>
<p>3、事务提交和回滚：</p>
<ul>
<li>当一个事务提交时，它所做的修改将成为数据库的最新版本，并且对其他事务可见。</li>
<li>当一个事务回滚时，它所做的修改将被撤销，对其他事务不可见。</li>
</ul>
<p>4、版本的回收：</p>
<p>为了防止数据库中的版本无限增长，MVCC 会定期进行版本的回收。回收机制会删除已经不再需要的旧版本数据，从而释放空间。</p>
<p>MVCC 通过创建数据的多个版本和使用快照读取来实现并发控制。读操作使用旧版本数据的快照，写操作创建新版本，并确保原始版本仍然可用。这样，不同的事务可以在一定程度上并发执行，而不会相互干扰，从而提高了数据库的并发性能和数据一致性。</p>


<h3 class="relative group">3.1 隐藏字段、undo log 
    <div id="31-%E9%9A%90%E8%97%8F%E5%AD%97%E6%AE%B5undo-log" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#31-%E9%9A%90%E8%97%8F%E5%AD%97%E6%AE%B5undo-log" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><code>InnoDB</code> 存储引擎为每行数据添加了三个隐藏字段:</p>
<ul>
<li><code>DB_TRX_ID（6字节）</code>：表示<strong>最后一次</strong>插入或更新该行的<strong>事务 id</strong>。此外，<code>delete</code> 操作在内部被视为更新，只不过会在记录头 <code>Record header</code> 中的 <code>deleted_flag</code> 字段将其标记为已删除</li>
<li><code>DB_ROLL_PTR（7字节）</code> <strong>回滚指针</strong>，指向该行的 <code>undo log</code> 。如果该行未被更新，则为空</li>
<li><code>DB_ROW_ID（6字节）</code>：如果没有设置主键且该表没有唯一非空索引时，<code>InnoDB</code> 会使用该 id 来生成聚簇索引</li>
</ul>
<p><strong>在 <code>InnoDB</code> 存储引擎中 <code>undo log</code> 分为两种：<code>insert undo log</code> 和 <code>update undo log</code>：</strong></p>
<ol>
<li>
<p><strong><code>insert undo log</code></strong>：指在 <code>insert</code> 操作中产生的 <code>undo log</code>。因为 <code>insert</code> 操作的记录只对事务本身可见，对其他事务不可见，故该 <code>undo log</code> 可以在事务提交后直接删除。</p>
</li>
<li>
<p><strong><code>update undo log</code></strong>：<code>update</code> 或 <code>delete</code> 操作中产生的 <code>undo log</code>。该 <code>undo log</code>可能需要提供 <code>MVCC</code> 机制，因此不能在事务提交时就进行删除。提交时放入 <code>undo log</code> 链表，等待 <code>purge线程</code> 进行最后的删除。不同事务或者相同事务的对同一记录行的修改，会使该记录行的 <code>undo log</code> 成为一条链表，链首就是最新的记录，链尾就是最早的旧记录。</p>
</li>
</ol>


<h3 class="relative group">3.2 ReadView 
    <div id="32-readview" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#32-readview" aria-label="锚点">#</a>
    </span>        
    
</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="n">class</span> <span class="n">ReadView</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* ... */</span>
</span></span><span class="line"><span class="cl"><span class="nl">private</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="kt">trx_id_t</span> <span class="n">m_low_limit_id</span><span class="p">;</span>      <span class="cm">/* 大于等于这个 ID 的事务均不可见 */</span>
</span></span><span class="line"><span class="cl">  <span class="kt">trx_id_t</span> <span class="n">m_up_limit_id</span><span class="p">;</span>       <span class="cm">/* 小于这个 ID 的事务均可见 */</span>
</span></span><span class="line"><span class="cl">  <span class="kt">trx_id_t</span> <span class="n">m_creator_trx_id</span><span class="p">;</span>    <span class="cm">/* 创建该 Read View 的事务ID */</span>
</span></span><span class="line"><span class="cl">  <span class="kt">trx_id_t</span> <span class="n">m_low_limit_no</span><span class="p">;</span>      <span class="cm">/* 事务 Number, 小于该 Number 的 Undo Logs 均可以被 Purge */</span>
</span></span><span class="line"><span class="cl">  <span class="kt">ids_t</span> <span class="n">m_ids</span><span class="p">;</span>                  <span class="cm">/* 创建 Read View 时的活跃事务列表 */</span>
</span></span><span class="line"><span class="cl">  <span class="n">m_closed</span><span class="p">;</span>                     <span class="cm">/* 标记 Read View 是否 close */</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>

<h3 class="relative group">3.3 数据可见性 
    <div id="33-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%81%E6%80%A7" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#33-%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%81%E6%80%A7" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>在 <code>InnoDB</code> 存储引擎中，创建一个新事务后，执行每个 <code>select</code> 语句前，都会创建一个快照（Read View），<strong>快照中保存了当前数据库系统中正处于活跃（没有 commit）的事务的 ID 号</strong>。其实简单的说保存的是系统中当前不应该被本事务看到的其他事务 ID 列表（即 m_ids）。当用户在这个事务中要读取某个记录行的时候，<code>InnoDB</code> 会将该记录行的 <code>DB_TRX_ID（最后一次更新的事务id）</code> 与 <code>Read View</code> 中的一些变量及当前事务 ID 进行比较，判断是否满足可见性条件：</p>
<ol>
<li>如果记录 DB_TRX_ID &lt; m_up_limit_id，那么表明最新修改该行的事务（DB_TRX_ID）在当前事务创建快照之前就提交了，<strong>可见</strong></li>
<li>如果 DB_TRX_ID &gt;= m_low_limit_id，那么表明最新修改该行的事务（DB_TRX_ID）在当前事务创建快照之后才修改该行，所以该记录行的值对当前事务<strong>不可见</strong>。跳到步骤 6</li>
<li>若 DB_TRX_ID =  m_creator_trx_id，表示是本事务修改，<strong>可见</strong></li>
<li>m_ids 为空，则表明在当前事务创建快照之前，修改该行的事务就已经提交了，<strong>可见</strong></li>
<li>如果 <code>m_up_limit_id &lt;= DB_TRX_ID &lt; m_low_limit_id</code> 表明最新修改该行的事务（DB_TRX_ID）在当前事务创建快照的时候可能处于**“活动状态”或者“已提交状态”**；所以就要对活跃事务列表 m_ids 进行查找（源码中是用的二分查找，因为是有序的）
<ul>
<li>如果在活跃事务列表 <code>m_ids</code> 中能找到 <code>DB_TRX_ID</code>，表明：① 在当前事务<strong>创建快照前</strong>，该记录行的值被“DB_TRX_ID事务”修改了，但没有提交；或者 ② 在当前事务<strong>创建快照后</strong>，该记录行的值被“DB_TRX_ID事务”修改了。这些情况下，这个记录行的值对当前事务都是<strong>不可见</strong>的。跳到步骤 6</li>
<li>在活跃事务列表中<strong>找不到</strong>，则表明“DB_TRX_ID事务”在修改“该记录行的值”后，在“当前事务”<strong>创建快照前就已经提交了，可见</strong></li>
</ul>
</li>
<li>在该记录行的 <code>DB_ROLL_PTR</code> 指针所指向的 <code>undo log</code> 取出快照记录，用快照记录的 DB_TRX_ID 跳到步骤 1 重新开始判断，直到找到满足的快照版本或返回空</li>
</ol>


<h3 class="relative group">3.4 MVCC只能在<code>读取已提交</code>和<code>可重复读</code>两个级别使用 
    <div id="34-mvcc%E5%8F%AA%E8%83%BD%E5%9C%A8%E8%AF%BB%E5%8F%96%E5%B7%B2%E6%8F%90%E4%BA%A4%E5%92%8C%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E4%B8%A4%E4%B8%AA%E7%BA%A7%E5%88%AB%E4%BD%BF%E7%94%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#34-mvcc%E5%8F%AA%E8%83%BD%E5%9C%A8%E8%AF%BB%E5%8F%96%E5%B7%B2%E6%8F%90%E4%BA%A4%E5%92%8C%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB%E4%B8%A4%E4%B8%AA%E7%BA%A7%E5%88%AB%E4%BD%BF%E7%94%A8" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>在事务隔离级别 <code>读取已提交/不可重复读 RC</code> 和 <code>可重复读 RR</code> （InnoDB 存储引擎的默认事务隔离级别）下，<code>InnoDB</code> 存储引擎使用 <code>MVCC</code>（非锁定一致性读），但它们生成 <code>Read View</code> 的时机却不同</p>
<ul>
<li>在 RC 隔离级别下的 <strong><code>每次select</code></strong> 查询前都生成一个<code>Read View</code> (m_ids 列表)——因此造成不可重复读</li>
<li>在 RR 隔离级别下只在事务开始后 <strong><code>第一次select</code></strong> 数据前生成一个<code>Read View</code>（m_ids 列表）</li>
</ul>


<h3 class="relative group">3.5 MVCC➕Next-key-lock 防止幻读 
    <div id="35-mvccnext-key-lock-%E9%98%B2%E6%AD%A2%E5%B9%BB%E8%AF%BB" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#35-mvccnext-key-lock-%E9%98%B2%E6%AD%A2%E5%B9%BB%E8%AF%BB" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p><code>InnoDB</code>存储引擎在 RR 级别下通过 <code>MVCC</code>和 <code>Next-key Lock</code> （间隙锁+记录锁）来解决幻读问题：</p>
<p><strong>1、执行普通 <code>select</code>，此时会以 <code>MVCC</code> 快照读的方式读取数据</strong></p>
<p>在快照读的情况下，RR 隔离级别只会在事务开启后的第一次查询生成 <code>Read View</code> ，并使用至事务提交。所以在生成 <code>Read View</code> 之后其它事务所做的更新、插入记录版本对当前事务并不可见，实现了可重复读和防止快照读下的 “幻读”</p>
<p><strong>2、执行 select&hellip;for update/lock in share mode、insert、update、delete 等当前读</strong></p>
<p>在当前读下，<strong>读取</strong>的都是<strong>最新的数据</strong>，如果其它事务有插入新的记录，并且刚好在当前事务查询范围内，就会产生幻读！<code>InnoDB</code> 使用 <code>Next-key Lock</code> 来防止这种情况。当执行当前读时，会锁定读取到的记录的同时，锁定它们的间隙，防止其它事务在查询范围内插入数据。只要我不让你插入，就不会发生幻读
例子，表 t 中 id = c：</p>
<table>
<thead>
<tr>
<th style="text-align:center">时刻</th>
<th style="text-align:center">事务A</th>
<th style="text-align:center">事务B</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center"></td>
<td style="text-align:center">begin;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">begin;</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center">update t set c = c + 1;</td>
<td style="text-align:center">当前读</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center">commit;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">update t set c = 0 where id = c</td>
<td style="text-align:center"></td>
<td style="text-align:center">当前读，修改行数为0</td>
</tr>
</tbody>
</table>
<p>事务 B 不开启事务也可以，也是当前读引发数据变更后，再次当前读数据没对上导致数据更新异常。</p>


<h2 class="relative group">4. 事务隔离级别 
    <div id="4-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#4-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB" aria-label="锚点">#</a>
    </span>        
    
</h2>
<ul>
<li><strong>READ-UNCOMMITTED(读取未提交)</strong> ：最低的隔离级别，允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读。</li>
<li><strong>READ-COMMITTED(读取已提交)</strong> ：允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生。</li>
<li><strong>REPEATABLE-READ(可重复读)</strong> ：对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。</li>
<li><strong>SERIALIZABLE(可串行化)</strong> ：最高的隔离级别，完全服从 ACID 的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">隔离级别</th>
<th style="text-align:center">脏读</th>
<th style="text-align:center">不可重复读</th>
<th style="text-align:center">幻读</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">READ-UNCOMMITTED</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">READ-COMMITTED</td>
<td style="text-align:center">×</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">REPEATABLE-READ</td>
<td style="text-align:center">×</td>
<td style="text-align:center">×</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">SERIALIZABLE</td>
<td style="text-align:center">×</td>
<td style="text-align:center">×</td>
<td style="text-align:center">×</td>
</tr>
</tbody>
</table>
<p>MySQL InnoDB 存储引擎的默认支持的隔离级别是 <strong>REPEATABLE-READ（可重读）</strong></p>
<p>InnoDB 实现的 REPEATABLE-READ 隔离级别其实是可以解决幻读问题发生的，主要有下面两种情况：</p>
<ul>
<li><strong>快照读</strong>：由 MVCC 机制来保证不出现幻读。</li>
<li><strong>当前读</strong>：使用 Next-Key Lock 进行加锁来保证不出现幻读，Next-Key Lock 是行锁（Record Lock）和间隙锁（Gap Lock）的结合，行锁只能锁住已经存在的行，为了避免插入新行，需要依赖间隙锁。</li>
</ul>


<h2 class="relative group">tips 
    <div id="tips" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#tips" aria-label="锚点">#</a>
    </span>        
    
</h2>
<ol>
<li>删除记录只是标记 B+ 树的节点为可复用，删除页后整个页可以复用</li>
<li>alter table A engine=InnoDB可以重建表，消除空洞「optimize table A 亦可」</li>
</ol>
<ul>
<li>
<p>5.5之前，DDL是使用临时表进行修改</p>
<blockquote>
<ol>
<li>按表 A 定义新建临时表 B，对原来的表 A 加 X 锁。</li>
<li>在表 B 上执行 DDL 操作</li>
<li>将数据拷贝到新表</li>
<li>释放 X 锁，删除表 A</li>
<li>重命名表 B 为表 A</li>
</ol>
</blockquote>
</li>
<li>
<p>5.6之后，引入Online DDL优化流程「主要是利用日志进行重放，允许重建时对原表进行DML」：</p>
<blockquote>
<ol>
<li>建立临时文件，扫描表 A 主键的所有数据页</li>
<li>用数据页中表 A 的记录生成 B+ 树，存储到临时文件</li>
<li>生成临时文件过程中，对 A 的操作都记录在 row log 中</li>
<li>生成完后，将日志文件的操作应用到临时文件</li>
<li>用临时文件替换表 A</li>
</ol>
</blockquote>
</li>
</ul>
<ol start="3">
<li>间隙锁在可重复读隔离级别下才有效，读已提交只有行锁
<ul>
<li>原则1：加锁的基本单位是next-key lock。希望你还记得，next-key lock是前开后闭区间</li>
<li>原则2：查找过程中访问到的对象才会加锁</li>
<li>优化1：索引上的等值查询，给唯一索引加锁的时候，next-key lock退化为行锁</li>
<li>优化2：索引上的等值查询，向右遍历时且最后一个值不满足等值条件的时候，next-key lock退化为间隙锁</li>
<li>一个bug：唯一索引上的范围查询会访问到不满足条件的第一个值为止</li>
</ul>
</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="o">`</span><span class="n">t</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="k">c</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">`</span><span class="n">d</span><span class="o">`</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">KEY</span><span class="w"> </span><span class="o">`</span><span class="k">c</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="o">`</span><span class="k">c</span><span class="o">`</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w"> </span><span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">insert</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">values</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),(</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span><span class="w">
</span></span></span></code></pre></div><table>
<thead>
<tr>
<th style="text-align:center">t</th>
<th style="text-align:center">事务A</th>
<th style="text-align:center">事务B</th>
<th style="text-align:center">事务C</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">begin;update t set d=d+1 where id=7;</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center">insert into t values(8, 8, 8);</td>
<td style="text-align:center"></td>
<td style="text-align:center">阻塞</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">update t set d=d+1 where id=10;</td>
<td style="text-align:center">正常</td>
</tr>
</tbody>
</table>
<blockquote>
<p>唯一索引，访问直到 7 之后的 10。等值查，退化为行锁。向右遍历退化为间隙锁，锁住 (5, 10)。因此事务 B 会被阻塞。事务 C 会被允许执行</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">t</th>
<th style="text-align:center">事务A</th>
<th style="text-align:center">事务B</th>
<th style="text-align:center">事务C</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">begin;select id from t where c=5 lock in share mode;</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center">update t set d=d+1 where id=5;</td>
<td style="text-align:center"></td>
<td style="text-align:center">正常</td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
<td style="text-align:center">insert into t values(7, 7, 7);</td>
<td style="text-align:center">阻塞</td>
</tr>
</tbody>
</table>
<blockquote>
<ul>
<li>A 会给索引 c = 5上读锁，根据原则1，上 <code>(0, 5]</code></li>
<li>由于不是唯一索引，需要向右遍历。根据原则2，访问的都需要上锁，上 <code>(5, 10]</code></li>
<li>根据优化2，等值查询向右遍历，退化为 <code>(5, 10)</code></li>
<li>根据原则2，这里是覆盖索引不需要回表，不访问主键索引，主键索引上不会添加任何锁。因此事务B可以正常执行，而C会被阻塞
若是 for update 会认为接下来要更新数据，因此会给主键索引上满足条件的行上行锁</li>
</ul>
</blockquote>
<ul>
<li>锁是加在索引上的</li>
</ul>
<ol start="4">
<li>
<p>主备延迟</p>
<ul>
<li>备库机器性能比主库性能差</li>
<li>备库压力大———— 一主多从 or 外部系统提供查询能力</li>
<li>大事务</li>
<li>备库并行复制能力</li>
</ul>
</li>
<li>
<p>join</p>
<ul>
<li>若可以使用Index Nested-Loop Join 算法，即可以用上被驱动表上的索引，可以使用</li>
<li>若使用 Block Nested-Loop Join 算法，尽量不要使用</li>
<li>使用小表驱动大表「按各自条件过滤之后参与 join 的各个子段的总数据量小的表」</li>
</ul>
</li>
</ol>


<h1 class="relative group">Innodb 
    <div id="innodb" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#innodb" aria-label="锚点">#</a>
    </span>        
    
</h1>


<h3 class="relative group">1. 内存数据对象 
    <div id="1-%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#1-%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE%E5%AF%B9%E8%B1%A1" aria-label="锚点">#</a>
    </span>        
    
</h3>
<ul>
<li>重做日志缓冲(redo log_buffer)</li>
<li>缓冲池(innodb_buffer_pool) &ndash;&gt; 数据页、索引页、插入缓冲、锁信息、自适应哈希索引、数据字典信息</li>
<li>额外内存池</li>
</ul>
<p>缓冲池管理算法：LRU，Innodb使用的是优化后的LRU</p>
<ul>
<li>新读取的页，放到 LRU 的 midpoint 位置。默认配置下，是5/8位置 (innodb_old_blocks_pct = 37, 37% 差不多3/8)。后面的列表称为 old 列表。</li>
<li>前面的列表是 new 列表，简单理解为 new 列表的页都是最为活跃的热点数据</li>
</ul>
<p>重做日志缓冲刷新到重做日志文件：</p>
<ul>
<li>每秒</li>
<li>每个事务提交</li>
<li>剩余空间小于 1/2 时</li>
<li>大小由 innodb_log_buffer_size 控制，默认 8 MB</li>
</ul>


<h3 class="relative group">2. Checkpoint 技术 
    <div id="2-checkpoint-%E6%8A%80%E6%9C%AF" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#2-checkpoint-%E6%8A%80%E6%9C%AF" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>宕机后，数据库只需要对 Checkpoint 后到重做日志进行恢复</p>
<ul>
<li>缩短数据库恢复时间</li>
<li>缓冲池不够用时，刷新脏页到磁盘</li>
<li>重做日志不可用时，刷新脏页</li>
</ul>
<p>Sharp Checkpoint</p>
<ul>
<li>数据库关闭时，将所有脏页刷新回磁盘</li>
</ul>
<p>Fuzzy Checkpoint</p>
<ul>
<li>主线程检查点每秒或每十秒，异步从脏页列表刷新一定比例的页</li>
<li>脏页数量太多 innodb_max_dirty_pages_pct 控制占比，默认75%</li>
<li>Async/Sync Flush Checkpoint 重做日志不可用的情况，需要强制将一些页刷新回。保证重做日志的循环可用</li>
<li>FLUSH_LRU_LIST Checkpoint 是保证 LRU 列表中需要有一定的空闲页可用。innodb_lru_scan_depth 控制，默认1024</li>
</ul>


<h3 class="relative group">3. 主线程工作 
    <div id="3-%E4%B8%BB%E7%BA%BF%E7%A8%8B%E5%B7%A5%E4%BD%9C" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#3-%E4%B8%BB%E7%BA%BF%E7%A8%8B%E5%B7%A5%E4%BD%9C" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>if InnoDB is idle:</p>
<p>每秒：</p>
<ul>
<li>日志缓冲刷新到磁盘</li>
<li>if(当前一秒内 IO 次数 &lt; 5)  &ndash;&gt; 合并插入缓冲 5% * innodb_io_capacity</li>
<li>if(脏页比例超过配置的最大脏页比例 innodb_max_dirty_pages_pct)  &ndash;&gt;  刷新 innodb_io_capacity 个脏页到磁盘</li>
<li>if(开启自适应刷新) 通过redo log的生成速度决定最合适的刷新脏页数量</li>
<li>if(没有用户活动【数据库空闲、关闭】) &ndash;&gt; 切换到 background loop</li>
</ul>
<p>else:</p>
<p>每十秒：</p>
<ul>
<li>if(过去十秒磁盘 IO 操作 &lt; 200) &ndash;&gt;  刷新 innodb_io_capacity 个脏页到磁盘</li>
<li>合并 5% * innodb_io_capacity 个插入缓冲</li>
<li>将日志缓冲刷新到磁盘</li>
<li>删除无用的 Undo 页(每次最多innodb_purge_batch_size【默认20页】)</li>
<li>是否有超过 innodb_max_dirty_pages_pct 比例的脏页 &ndash;&gt; 刷新 innodb_io_capacity 个，否则 10% * innodb_io_capacity 个脏页到磁盘</li>
</ul>
<p>background loop：</p>
<ul>
<li>删除无用的 Undo 页</li>
<li>合并 innodb_io_capacity 个插入缓冲</li>
<li>不空闲则跳回主循环</li>
<li>不断刷新 innodb_io_capacity 个页直到符合条件</li>
</ul>


<h3 class="relative group">4.关键特性 
    <div id="4%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#4%E5%85%B3%E9%94%AE%E7%89%B9%E6%80%A7" aria-label="锚点">#</a>
    </span>        
    
</h3>


<h4 class="relative group">4.1 插入缓冲 
    <div id="41-%E6%8F%92%E5%85%A5%E7%BC%93%E5%86%B2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#41-%E6%8F%92%E5%85%A5%E7%BC%93%E5%86%B2" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>对于非唯一的二级索引，会使用插入缓冲来解决离散插入时低效的问题。</p>
<ul>
<li>非唯一：插入缓冲时，不可能去判断插入记录的唯一性，这样又有了离散读取的情况</li>
<li>主键索引：已经是顺序插入了</li>
</ul>
<p>SHOW ENGINE INNODB STATUS显示：</p>
<ul>
<li>inserts 插入的记录数</li>
<li>merged recs 合并的插入记录数量</li>
<li>merges 合并的次数【实际读取页的数量】
插入缓冲默认最大可以占用 1/2 的缓冲池内存【IBUF_POOL_SIZE_PER_MAX_SIZE控制 1/n】</li>
</ul>


<h4 class="relative group">4.2 修改缓冲 
    <div id="42-%E4%BF%AE%E6%94%B9%E7%BC%93%E5%86%B2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#42-%E4%BF%AE%E6%94%B9%E7%BC%93%E5%86%B2" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>可以视为插入缓冲的升级，可以对DML操作——INSERT\DELETE\UPDATE都进行缓冲，分别是 Insert Buffer\Delete Buffer\Purge Buffer</p>
<ul>
<li>非唯一的辅助索引</li>
</ul>
<p>对一条 Update 的操作可能分为两个步骤：</p>
<ol>
<li>将记录标记为已删除 ————&gt; Delete Buffer</li>
<li>真正删除 ————&gt; Purge Buffer</li>
</ol>
<p>innodb_change_buffering:</p>
<ul>
<li>inserts</li>
<li>deletes</li>
<li>purges</li>
<li>changes &mdash;&gt; 启用 inserts 和 deletes</li>
<li>all【默认】</li>
<li>none</li>
</ul>
<p>innodb_change_buffer_max_size【控制最大使用的内存，默认25%，表示最多使用 25% 缓冲池内存，最大有效值为50】</p>
<p><strong>内部实现</strong>：「B+树，非叶节点存放的是查询的键值」</p>
<p>search key键: space表空间id「4B」 + marker兼容「1B」 + offset页所在偏移量「4B」</p>
<p>一个辅助索引要插入页(space, offset)时，若页不在缓冲池，则构造一个键，查询 B+ 树，插入叶子节点中</p>
<p>页字节点：space + marker + offset + metadata「4B」 + 二级索引记录</p>
<p>metadata:</p>
<ul>
<li>IBUF_REC_OFFSET_COUNT   2B  记录进入缓存的顺序</li>
<li>IBUF_REC_OFFSET_TYPE    1B</li>
<li>IBUF_REC_OFFSET_FLAGS   1B</li>
</ul>
<p><strong>Insert Buffer Bitmap 页</strong>：标记每个辅助索引页的可用空间。每个追踪 16384(16K) 个辅助索引页</p>
<ul>
<li>每个辅助索引页占4bit</li>
<li>IBUF_BITMAP_FREE      2bit  表示可用空间的数量 0-无；1-大于1/32页； 2-大于1/16页； 3-大于1/8页</li>
<li>IBUF_BITMAP_BUFFERED  1bit  1 表示该辅助索引页有记录被缓存在 B+ 树，用于等待后续的合并操作</li>
<li>IBUF_BITMAP_IBUF      1bit  1 表示该页为 B+ 树的索引页</li>
</ul>
<p><strong>合入真正的索引时机</strong>：</p>
<ul>
<li>辅助索引页被读取到缓冲池</li>
<li>Insert Buffer Bitmap 页追踪到该辅助索引页无可用空间 ————&gt; 插入辅助索引记录时检测到插入记录后可用空间  &lt; 1/32 时会强制进行一次合并</li>
<li>主线程 ————&gt; 每十秒进行的。随机选择一个插入缓冲中的页，读取该页的space及之后的页进行merge，若merge的表已经被删除，则可丢弃此缓存数据</li>
</ul>


<h4 class="relative group">4.3 双写 
    <div id="43-%E5%8F%8C%E5%86%99" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#43-%E5%8F%8C%E5%86%99" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>提高数据页的可靠性</p>
<p>包括两部分：</p>
<ul>
<li>内存中的双写缓冲(doublewrite buffer 2MB)</li>
<li>物理磁盘上共享表空间中连续的 128 页(2个区，2MB) 【用于恢复数据】
对缓冲池的脏页进行刷新时，不直接写磁盘，先将脏页复制到内存中的双写缓冲，双写缓冲之后分两次，顺序地写入物理磁盘，之后马上调用fsync函数，确保所有数据已经持久化到物理磁盘。由于双写页是连续的，开销不是很大</li>
</ul>


<h4 class="relative group">4.4 自适应哈希索引 
    <div id="44-%E8%87%AA%E9%80%82%E5%BA%94%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#44-%E8%87%AA%E9%80%82%E5%BA%94%E5%93%88%E5%B8%8C%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>Innodb 监控表上各索引页的查询，若观察到建立哈希索引可以带来速度提升，则会建立哈希索引，AHI(Adaptive Hash Index)是通过缓冲池的B+树构造来的，因此建立的速度很快【不需要对整表构建索引】。Innodb 会自动根据访问的频率和模式自动为某些热点页建立哈希索引</p>
<ul>
<li>页的访问模式必须是一样的 ————&gt; 对于(a, b)索引，有两个模式，where a=xxx 和 where a=xxx and b =xxx。若交替进行，则不会建立 AHI</li>
<li>以该模式访问了100次</li>
<li>页通过该模式访问了 N(页中记录/16) 次</li>
<li>innodb_adaptive_hash_index 控制禁用或启动此特性</li>
</ul>


<h4 class="relative group">4.5 异步IO 
    <div id="45-%E5%BC%82%E6%AD%A5io" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#45-%E5%BC%82%E6%AD%A5io" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>AIO：发出一个IO请求后立即发出下一个IO请求，全部请求发送完毕后，等待所有IO对完成</p>
<ul>
<li>可以进行IO合并，如需要访问页的(space, page_no)为 (8, 6) (8,7) 会被合并为(8, 6)开始读取 32KB 的页</li>
<li>innodb_use_native_aio 控制是否启用 Native AIO(内核级别的支持)</li>
<li>Innodb中，read ahead方式的读取【预读】、脏页的刷新 都是由AIO完成的</li>
</ul>


<h4 class="relative group">4.6 刷新临接页 
    <div id="46-%E5%88%B7%E6%96%B0%E4%B8%B4%E6%8E%A5%E9%A1%B5" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#46-%E5%88%B7%E6%96%B0%E4%B8%B4%E6%8E%A5%E9%A1%B5" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>刷新脏页时，若同一个区有其他脏页，一起进行刷新</p>
<ul>
<li>innodb_flush_neighbors 控制是否启用。对于机械硬盘建议启用，固态硬盘建议关闭</li>
</ul>


<h3 class="relative group">5. 启动、关闭和恢复 
    <div id="5-%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%AD%E5%92%8C%E6%81%A2%E5%A4%8D" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#5-%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%AD%E5%92%8C%E6%81%A2%E5%A4%8D" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>关闭参数 innodb_fast_shutdown</p>
<ul>
<li>0 关闭时完成所有的full purge和merge insert buffer，并将所有的脏页刷新回磁盘。Innodb升级时，必须设为0</li>
<li>1 默认值，只刷新脏页回磁盘</li>
<li>2 上述操作都不做，将日志都写入日志文件。这样不会有任何事务的丢失，下次启动时，会进行恢复操作</li>
</ul>
<p>恢复参数 innodb_force_recovery</p>
<ul>
<li>0 默认值，需要恢复时，进行所有的恢复操作，当不能进行有效的恢复时，如数据页损坏，MySQL数据库可能宕机，将错误写入错误日志</li>
<li>1 忽略检查到的损坏页</li>
<li>2 阻止主线程的运行</li>
<li>3 不进行事务回滚</li>
<li>4 不进行插入缓冲的合并</li>
<li>5 不查看 Undo log，将未提交的事务视为已提交</li>
<li>6 不进行前滚
设置大于 0 后，不能进行insert、update、delete这些 DML 操作，可select、create、drop操作</li>
</ul>


<h3 class="relative group">6. 表 
    <div id="6-%E8%A1%A8" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#6-%E8%A1%A8" aria-label="锚点">#</a>
    </span>        
    
</h3>
<ul>
<li>InnoDB 会选择第一个定义的非空的唯一索引作为主键</li>
<li>否则自动创建一个 6B 的指针作为主键</li>
</ul>


<h4 class="relative group">6.1 逻辑存储结构 
    <div id="61-%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#61-%E9%80%BB%E8%BE%91%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>表空间由段(segment)、区(extent)、页(page)组成</p>
<p>默认情况下，有一个共享表空间 ibdata1，所有的数据都存放到这个表空间内</p>
<ul>
<li>innodb_file_per_table 开启则每张表的数据都可以单独放到一个表空间内。每张表的表空间存放的只是数据、索引、插入缓冲Bitmap页</li>
<li>回滚信息、插入缓冲索引页、系统事务信息、双写缓冲还是存放在共享表空间内</li>
</ul>
<p>段：数据段、索引段、回滚段</p>
<p>区：连续页组成的空间，在任何情况下每个区的大小都为 1MB【64页】。</p>
<p>为了保证页中连续性，一般一次从磁盘申请4～5个区。</p>
<ul>
<li>启用 innodb_file_per_table 后，创建的表默认大小是 96KB。
<blockquote>
<p>每个段开始时，先用 32 个页大小的碎片页来存放数据，使用完后才是 64 连续页的申请</p>
</blockquote>
</li>
</ul>
<p>页：默认大小 16KB。innodb_page_size可以设置为 4K\8K\16K。类型有：数据页、undo页、系统页、事务数据页、插入缓冲位图页、插入缓冲空闲列表页、未压缩的二进制大对象页、压缩的二进制大对象页</p>
<p>行：每个页最多存放 16KB/2 - 200 = 7992行记录</p>


<h4 class="relative group">6.2 行记录格式 
    <div id="62-%E8%A1%8C%E8%AE%B0%E5%BD%95%E6%A0%BC%E5%BC%8F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#62-%E8%A1%8C%E8%AE%B0%E5%BD%95%E6%A0%BC%E5%BC%8F" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>Compact 行记录格式：</p>
<ul>
<li>MySQL 5.0引入</li>
<li>变长字段列表。 ——————逆序放置，若列长度小于 255B，每项占一个字节，否则两个字节</li>
<li>NULL标志位。最少1B ————记录是否有 NULL，有则用 1 表示。06「0000 0110」表示第2和3列数据为 NULL</li>
<li>记录头信息。5B ——————是否被删除、是否预先被定义的最小记录、记录含有的记录数、索引堆中该条记录的排序记录、记录的类型「普通/B+树/Infimun/Supremum/保留」、页中下一条记录的相对位置</li>
<li>RowID。6B ————隐藏的主键</li>
<li>事务ID。6B</li>
<li>回滚指针。7B</li>
<li>列1~n数据（无NULL值）</li>
</ul>
<p>Redundant 行记录格式：5.0之前的格式，不做了解</p>
<p>行溢出时（表字段总长度超过8098时「每个页至少应该可以存放2条数据，否则B+树失去意义」），存放768个前缀字节，后面是偏移量指向行溢出页</p>
<p>新的记录格式 Barracuda「含Compressed、Dynamic」使用完全行溢出方式。数据页中只存放20个字节的指针，实际的数据都存放到偏移页中。</p>
<p>对于 Char 类型在多字节字符集类型的存储，被明确视为 VarChar 来存储，对于未能占满的还是填充 0x20。</p>


<h4 class="relative group">6.3 数据页结构 
    <div id="63-%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#63-%E6%95%B0%E6%8D%AE%E9%A1%B5%E7%BB%93%E6%9E%84" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>InnoDB数据页组成部分：
文件头(38B)、页头(56B)、Infimun 和 Supremum Records、行记录(User Records)、空闲空间、页目录、文件结尾信息(8B)。固定大小的存放了Checksum、所在B+树的层数等信息。</p>
<p>Infimun 和 Supremum Records 中间夹着【逻辑上，物理上这两个时连续的】行记录数据，分别是比任何主键都小、都大的值</p>
<p>Free Space 是一个链表结构，一条记录被删除后，此空间会被加入到空闲链表</p>
<p>Page Directory 存放记录的相对位置，有指向一个个记录槽的指针，一个槽可能包含多条记录</p>
<p>File Trailer 检测页是否已经完整地写入磁盘</p>


<h4 class="relative group">6.4 约束 
    <div id="64-%E7%BA%A6%E6%9D%9F" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#64-%E7%BA%A6%E6%9D%9F" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>约束是逻辑概念，保证数据的完整性。索引是一个数据结构，有逻辑上概念，也代表物理存错的方式</p>
<p>约束默认不会报错而是警告「设置SQL模式为STRICT_TRANS_TABLES才会报错」</p>
<ul>
<li>主键约束————默认名称PRIMARY</li>
<li>唯一约束————默认名称为列名</li>
<li>非空约束————name NOT NULL</li>
<li>枚举约束、集合约束————sex ENUM(&lsquo;male&rsquo;, &lsquo;female&rsquo;)、set SET</li>
<li>外键约束————保证参照完整性。MySQL本身不支持，InnoDB完整支持 FOREIGN KEY (parent_id) REFERENCES 父表(id)
<ul>
<li>CASCADE 父表删除、更新时，字表也需要同步</li>
<li>SET NULL 子表设置为NULL</li>
<li>NO ACTION 抛出错误</li>
<li>RESTRICT 没有指定 ON DELETE 或 ON UPDATE 时的默认设置，抛出错误「在MySQL中一样」</li>
</ul>
</li>
</ul>


<h3 class="relative group">7. 索引 
    <div id="7-%E7%B4%A2%E5%BC%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#7-%E7%B4%A2%E5%BC%95" aria-label="锚点">#</a>
    </span>        
    
</h3>
<ul>
<li>离散读的数据多时，优化器会选主键索引</li>
</ul>


<h4 class="relative group">7.1 MRR优化 5.6开始 
    <div id="71-mrr%E4%BC%98%E5%8C%96-56%E5%BC%80%E5%A7%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#71-mrr%E4%BC%98%E5%8C%96-56%E5%BC%80%E5%A7%8B" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>Using MRR;</p>
<p>Multi-Range Read：目的减少磁盘的随机访问，将随机访问转化为较为顺序的数据访问</p>
<ul>
<li>将查询到的辅助索引键值放到一个缓存，缓存的数据是根据辅助索引键值排序的</li>
<li>将缓存中的键值按 RowId 排序</li>
<li>根据 RowId 的顺序访问实际的数据文件</li>
</ul>


<h4 class="relative group">7.2 ICP优化 5.6开始 
    <div id="72-icp%E4%BC%98%E5%8C%96-56%E5%BC%80%E5%A7%8B" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#72-icp%E4%BC%98%E5%8C%96-56%E5%BC%80%E5%A7%8B" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>Using index condition;</p>
<p>Index Condition Pushdown：取出索引的同时，判断是否可以进行 WHERE 条件的过滤，也就是将 WHERE 条件部分过滤放到了存储引擎层。某些查询下，可以大大减少上层 SQL 层对记录的索取。</p>
<p>假设有一个表 employees，包含 id、name 和 salary 列，并且在 salary 列上有索引</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-SQL" data-lang="SQL"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">employees</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">salary</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50000</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>在没有索引下推的情况下，数据库将首先访问所有 employees 表的行，并在访问每一行后检查 salary 是否大于 50000。</p>
<p>而在使用索引下推的情况下，数据库会使用 salary 列的索引来快速找到所有 salary 大于 50000 的记录。只有符合条件的行才会被读取，显著减少了需要访问的行数</p>


<h4 class="relative group">7.3 全文检索 
    <div id="73-%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#73-%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>倒排索引两种形式：</p>
<ul>
<li>inverted file index ： {单词, 单词所在文档ID}</li>
<li>full inverted index ： {单词, (单词所在文档ID, 文档中具体位置)}
InnoDB 1.2.x 开始支持倒排索引，是第二种形式</li>
</ul>


<h3 class="relative group">8. 锁 
    <div id="8-%E9%94%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#8-%E9%94%81" aria-label="锚点">#</a>
    </span>        
    
</h3>
<p>InnoDB 行级锁：</p>
<ul>
<li>共享锁 S Lock 读锁</li>
<li>拍他锁 X Lock 写锁</li>
<li>意向锁 I Lock 表级别锁</li>
</ul>
<p>锁兼容性「下面的锁都是表级别锁，意向锁不和记录锁冲突」：</p>
<table>
<thead>
<tr>
<th style="text-align:center"></th>
<th style="text-align:center">IS</th>
<th style="text-align:center">IX</th>
<th style="text-align:center">S</th>
<th style="text-align:center">X</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">IS</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">IX</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✅</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">X</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SHOW</span><span class="w"> </span><span class="n">ENGINE</span><span class="w"> </span><span class="n">INNODB</span><span class="w"> </span><span class="n">STATUS</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 也可以查看当前锁请求的信息
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 5.x 版本
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">innodb_lock_waits</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">information_schema</span><span class="p">.</span><span class="n">innodb_locks</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 8.0 版本
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">data_locks</span><span class="err">\</span><span class="k">G</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 查看锁信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">performance_schema</span><span class="p">.</span><span class="n">data_lock_waits</span><span class="err">\</span><span class="k">G</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 查看等待锁
</span></span></span></code></pre></div>

<h4 class="relative group">8.1 一致性非锁定读 
    <div id="81-%E4%B8%80%E8%87%B4%E6%80%A7%E9%9D%9E%E9%94%81%E5%AE%9A%E8%AF%BB" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#81-%E4%B8%80%E8%87%B4%E6%80%A7%E9%9D%9E%E9%94%81%E5%AE%9A%E8%AF%BB" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>MVCC 读取被锁定的数据时，不会等待行上锁的释放，而是读取行的一个快照数据</p>
<ul>
<li>在读已提交级别下，总是读取被锁定行的最新一份快照，下面的案例中，会话A从7开始会读取到不到数据。</li>
<li>在可重复读级别下，总时读取事务开始时的行数据版本，下面的案例中，始终会读取到1的数据</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">会话A</th>
<th style="text-align:center">会话B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">BEGIN;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">SELECT * FROM user WHERE id = 1;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center">BEGIN;</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center">UPDATE user SET id = 3 WHERE id = 1;</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">SELECT * FROM user WHERE id = 1;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center"></td>
<td style="text-align:center">COMMIT;</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center">SELECT * FROM user WHERE id = 1;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">COMMIT;</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>


<h4 class="relative group">8.2 一致性锁定读 
    <div id="82-%E4%B8%80%E8%87%B4%E6%80%A7%E9%94%81%E5%AE%9A%E8%AF%BB" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#82-%E4%B8%80%E8%87%B4%E6%80%A7%E9%94%81%E5%AE%9A%E8%AF%BB" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>某些情况下，用户需要显式地对数据库读取操作加锁保证数据逻辑的一致性。</p>
<ul>
<li>SELECT &hellip; FOR UPDATE           对读取的行加 X 锁</li>
<li>SELECt &hellip; LOCK IN SHARE MODE   对读取的行加 S 锁</li>
</ul>
<p>必须在一个事务中，事务提交时，锁会被释放，使用上面的语句务必加上<code>BEGIN</code>\<code>START TRANSACTION</code>\<code>SET AUTOCOMM = 0</code>。</p>


<h4 class="relative group">8.3 自增与锁 
    <div id="83-%E8%87%AA%E5%A2%9E%E4%B8%8E%E9%94%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#83-%E8%87%AA%E5%A2%9E%E4%B8%8E%E9%94%81" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>当对含有自增长的计数器的表插入时，计数器会被初始化，执行如下语句来得到计数器的值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">select</span><span class="w"> </span><span class="k">max</span><span class="p">(</span><span class="n">auto_inc_col</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">update</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 加1赋予自增列「AUTO-INC Locking」
</span></span></span></code></pre></div><p>这种锁是一种特殊的表锁，不是在一个事务完成后释放，而是在完成SQL后立即释放。这样会影响一个事务中大数据量插入的性能。5.1.22 开始，提供一种轻量级互斥量的自增实现机制。</p>
<p>插入类型：</p>
<ol>
<li>insert-like    所有的插入语句                  INSERT\REPLACE\INSERT&hellip;SELECT\REPLACE&hellip;SELECT\LOAD DATA</li>
<li>simple inserts 能在插入前就确定插入行数的语句    INSERT\REPLACE「不包括 INSERT &hellip; ON DUPLICATE KEY UPDATE」</li>
<li>bulk inserts   插入前不能确定插入行树的语句      INSERT&hellip;SELECT\REPLACE&hellip;SELECT\LOAD DATA</li>
<li>mixed-mode inserts 插入有一部分是自增，一部分是确定的；也可以指 INSERT &hellip; ON DUPLICATE KEY UPDATE 此类 SQL</li>
</ol>
<p>innodb_autoinc_lock_mode 控制自增长模式，默认 1</p>
<ul>
<li>0   表锁的 AUTO-INC Locking 方式</li>
<li>1   对 simple 会使用互斥量，对 bulk 使用 AUTO-INC Locking。若不考虑回滚操作，增长还是连续的</li>
<li>2   对所有 insert-like 都是通过互斥量。并发插入时，自增的值可能不是连续的。语句基础复制「记录执行的SQL，在从数据库执行这些SQL」下，会出问题。使用此模式务必使用 row 格式复制</li>
</ul>
<p>自增列必须是索引，且必须是索引的第一列，否则抛出异常。</p>


<h4 class="relative group">8.4 锁算法 
    <div id="84-%E9%94%81%E7%AE%97%E6%B3%95" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#84-%E9%94%81%E7%AE%97%E6%B3%95" aria-label="锚点">#</a>
    </span>        
    
</h4>
<ul>
<li>记录锁 Record Lock    锁住记录</li>
<li>间隙锁 Gap Lock       锁住一个范围，不含记录本身</li>
<li>邻间锁 Next-Key Lock  锁住相邻的索引值左开右闭区间。列是唯一索引情况下，会降级为记录锁。InnoDB 会对辅助索引的下一个键值加间隙锁「防止幻读」</li>
</ul>
<p>可以使用邻间锁机制在应用层实现唯一性检查：select * from table where col = xxx lock in share mode;「加锁防止其他事务插入」 即使查询的值不在，锁定的也是一个范围，如果没有返回任何值，新插入的值就是唯一的。</p>
<p>问题：</p>
<ol>
<li>脏读       读未提交时，可以读取到未被提交事务更新的数据，从节点不需要特别精确返回值时可以设置为此级别</li>
<li>幻读       不可重复读，读取到了「事务开始之后其他事务」已经提交的数据。InnoDB 用邻间锁避免不可重复读</li>
<li>丢失更新    一个事务的更新会被另一个事务的更新覆盖。任何隔离级别下都不会发生。因为都会给行记录加锁。</li>
<li>逻辑意义上的数据丢失</li>
</ol>
<p>假设现在两个事务，一个事务花了 4 元，一个事务花了 50 元，这时，由于提交事务的时机不同，先提交的事务修改被覆盖掉：</p>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">会话A</th>
<th style="text-align:center">会话B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">BEGIN;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">SELECT * FROM user WHERE id = 1;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center">BEGIN;</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center">SELECT * FROM user WHERE id = 1;</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">UPDATE user SET money = a - 4 WHERE id = 1;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center"></td>
<td style="text-align:center">UPDATE user SET money = a - 50 WHERE id = 1;</td>
</tr>
<tr>
<td style="text-align:center">7</td>
<td style="text-align:center"></td>
<td style="text-align:center">COMMIT;</td>
</tr>
<tr>
<td style="text-align:center">8</td>
<td style="text-align:center">COMMIT;</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>要避免丢失更新，需要让事务在这种情况下的操作变为串行化：给上面两个 select 都加上排他锁「FOR UPDATE」</p>


<h4 class="relative group">8.5 阻塞 
    <div id="85-%E9%98%BB%E5%A1%9E" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#85-%E9%98%BB%E5%A1%9E" aria-label="锚点">#</a>
    </span>        
    
</h4>
<ul>
<li>innodb_lock_wait_timeout 控制等待时间，默认 50 秒</li>
<li>innodb_rollback_on_timeout 是否在超时时进行回滚，<strong>默认 OFF</strong>，不会回滚大部分的错误异常，但是死锁除外</li>
</ul>


<h4 class="relative group">8.6 死锁 
    <div id="86-%E6%AD%BB%E9%94%81" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#86-%E6%AD%BB%E9%94%81" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>使用等待图检测死锁。wait-for graph「图中有回路则存在死锁」：</p>
<ul>
<li>锁信息链表</li>
<li>事务等待链表
InnoDB 1.2 之前，都是采用递归实现，1.2 开始，优化为非递归实现

    <figure>
      <img
        class="my-0 rounded-md"
        loading="lazy"
        srcset="
        /img/MySQL-8_hu1bdea17d62de5cd4080742c9cb65920d_105643_330x0_resize_q75_box.jpeg 330w,
        /img/MySQL-8_hu1bdea17d62de5cd4080742c9cb65920d_105643_660x0_resize_q75_box.jpeg 660w,
        /img/MySQL-8_hu1bdea17d62de5cd4080742c9cb65920d_105643_1024x0_resize_q75_box.jpeg 1024w,
        /img/MySQL-8_hu1bdea17d62de5cd4080742c9cb65920d_105643_1320x0_resize_q75_box.jpeg 2x"
        src="/img/MySQL-8_hu1bdea17d62de5cd4080742c9cb65920d_105643_660x0_resize_q75_box.jpeg"
        alt=""
      />
      
    </figure>

死锁的示例1：一个事务先获取 A 的锁，再获取 B 的锁；另一个事务反之</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">会话A</th>
<th style="text-align:center">会话B</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">BEGIN;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">SELECT * FROM user WHERE id = 1 FOR UPDATE;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center"></td>
<td style="text-align:center">BEGIN;</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center">SELECT * FROM user WHERE id = 2 FOR UPDATE;</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">SELECT * FROM user WHERE id = 2 FOR UPDATE;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center"></td>
<td style="text-align:center">SELECT * FROM user WHERE id = 1 FOR UPDATE;</td>
</tr>
</tbody>
</table>
<p>之后会话 B 会抛出死锁异常，并进行回滚，A 获取资源。</p>
<p>死锁示例2: 事务 A 持有待插入的下一个记录的 X 锁，但是等待队列中存在一个 S 锁请求</p>
<p>主键 id，表中有 1 2 4 5</p>
<table>
<thead>
<tr>
<th style="text-align:center">时间</th>
<th style="text-align:center">会话A</th>
<th style="text-align:center">会话B</th>
<th style="text-align:center">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1</td>
<td style="text-align:center">BEGIN;</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center"></td>
<td style="text-align:center">BEGIN;</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">3</td>
<td style="text-align:center">SELECT * FROM user WHERE id = 4 FOR UPDATE;</td>
<td style="text-align:center"></td>
<td style="text-align:center">获取记录 4 X锁</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center"></td>
<td style="text-align:center">SELECT * FROM user WHERE id &lt;= 4 LOCK IN SHARE MODE;</td>
<td style="text-align:center">获取 1, 2 等待 4 S锁</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">INSERT INTO user VALUES(3);</td>
<td style="text-align:center"></td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">6</td>
<td style="text-align:center"></td>
<td style="text-align:center">获得锁</td>
<td style="text-align:center"></td>
</tr>
</tbody>
</table>
<p>若时间 5 插入成功，则 B 还需要获取 3 的锁，这里选择了死锁，回滚 undo log 大的事务</p>


<h4 class="relative group">8.7 锁升级「没有锁升级」 
    <div id="87-%E9%94%81%E5%8D%87%E7%BA%A7%E6%B2%A1%E6%9C%89%E9%94%81%E5%8D%87%E7%BA%A7" class="anchor"></div>
    
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#87-%E9%94%81%E5%8D%87%E7%BA%A7%E6%B2%A1%E6%9C%89%E9%94%81%E5%8D%87%E7%BA%A7" aria-label="锚点">#</a>
    </span>        
    
</h4>
<p>InnoDB 不是根据每个记录来产生行锁的，而是根据每个事务访问的每个页对锁进行管理，采用的是位图的方式。因此不管一个事务锁住页的一个记录还是多个记录，开销都是一致的。</p>

        </div>
        
        

        
        
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;title=MySQL%e5%8e%9f%e7%90%86"
      title="分享到 LinkedIn"
      aria-label="分享到 LinkedIn"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;text=MySQL%e5%8e%9f%e7%90%86"
      title="分享到 Twitter"
      aria-label="分享到 Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://bsky.app/intent/compose?text=MySQL%e5%8e%9f%e7%90%86&#43;https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256,232.562c-21.183,-41.196 -78.868,-117.97 -132.503,-155.834c-51.378,-36.272 -70.978,-29.987 -83.828,-24.181c-14.872,6.72 -17.577,29.554 -17.577,42.988c0,13.433 7.365,110.138 12.169,126.281c15.873,53.336 72.376,71.358 124.413,65.574c2.66,-0.395 5.357,-0.759 8.089,-1.097c-2.68,0.429 -5.379,0.796 -8.089,1.097c-76.259,11.294 -143.984,39.085 -55.158,137.972c97.708,101.165 133.908,-21.692 152.484,-83.983c18.576,62.291 39.972,180.718 150.734,83.983c83.174,-83.983 22.851,-126.674 -53.408,-137.969c-2.71,-0.302 -5.409,-0.667 -8.089,-1.096c2.732,0.337 5.429,0.702 8.089,1.096c52.037,5.785 108.54,-12.239 124.413,-65.574c4.804,-16.142 12.169,-112.847 12.169,-126.281c-0,-13.434 -2.705,-36.267 -17.577,-42.988c-12.85,-5.806 -32.45,-12.09 -83.829,24.181c-53.634,37.864 -111.319,114.635 -132.502,155.831Z"/></svg>
  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://reddit.com/submit/?url=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;resubmit=true&amp;title=MySQL%e5%8e%9f%e7%90%86"
      title="提交到 Reddit"
      aria-label="提交到 Reddit"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://api.whatsapp.com/send?text=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;resubmit=true&amp;title=MySQL%e5%8e%9f%e7%90%86"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://t.me/share/url?url=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;resubmit=true&amp;title=MySQL%e5%8e%9f%e7%90%86"
      title=""
      aria-label=""
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://pinterest.com/pin/create/bookmarklet/?url=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;description=MySQL%e5%8e%9f%e7%90%86"
      title="钉到 Pinterest"
      aria-label="钉到 Pinterest"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.facebook.com/sharer/sharer.php?u=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;quote=MySQL%e5%8e%9f%e7%90%86"
      title="分享到 Facebook"
      aria-label="分享到 Facebook"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=https://TCmatj.github.io/docs/mysql/mysql%E5%8E%9F%E7%90%86/&amp;subject=MySQL%e5%8e%9f%e7%90%86"
      title="通过电子邮件发送"
      aria-label="通过电子邮件发送"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>


        


  
      </div>
     
      
      
        
        
          
          
        
      <script>
        var oid = "views_docs\/MySQL\/MySQL原理\/index.md"
        var oid_likes = "likes_docs\/MySQL\/MySQL原理\/index.md"
      </script>
      
      
      
      <script type="text/javascript" src="/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js" integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q&#43;oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/docs/python/python/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Python入门</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/docs/mysql/mysql%E8%AF%AD%E6%B3%95/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >MySQL语法</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="0001-01-01 00:00:00 &#43;0000 UTC">0001-01-01</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="返回顶部" title="返回顶部">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
    <nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
        <li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
          <a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href="/tags/"
            title="">
            
            标签
          </a>
        </li>
        
      </ul>
    </nav>
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      &copy;
      2024
      TCmatj
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> 强力驱动
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js" integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh&#43;sCQ0E53ghYrxgYqw&#43;0GCRyIEpA=="></script>
  
  
  <a rel="me" href="https://masto.ai/@blowfish"></a>
  
</footer>
<div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://TCmatj.github.io/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="搜索"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="关闭 (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

<script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js"
  data-id="nunocoracao" data-description="Support me on Buy me a coffee!" data-message=""
  data-color="#FFDD00" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

</html>
